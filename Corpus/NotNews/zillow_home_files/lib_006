YUI.add("z-jsonp",function(c){var b=c.namespace("Z");function a(d,f,e){f=c.mix(((c.Lang.isFunction(f))?{on:{success:f}}:f||{}),this._defaultConfig);
f.attributes=f.attributes||{};f.attributes._zjsonpid=this._zjsonpid=c.stamp(f.attributes,true);a.superclass.constructor.call(this,d,f);
}c.extend(a,c.JSONPRequest,{_defaultConfig:{async:true,timeout:30000},setProxy:function(d){this._proxy=d;
}});a.prototype.send=function(){var e=a.superclass.send.apply(this,arguments),d=c.Get._queue,f,h,g;if(d&&d.length){f=d[d.length-1];
if(f&&f.transaction&&f.transaction.options&&f.transaction.options.attributes&&f.transaction.options.attributes._zjsonpid===this._zjsonpid){h=f.transaction;
d.pop();}}if(c.Get._pending&&c.Get._pending.transaction&&c.Get._pending.transaction.options&&c.Get._pending.transaction.options.attributes&&c.Get._pending.transaction.options.attributes._zjsonpid===this._zjsonpid){h=c.Get._pending.transaction;
g=true;}if(h.options){h.options._onFinish=null;}if(g&&c.Lang.isFunction(c.Get._onTransactionFinish)){c.Get._onTransactionFinish();
}return e;};b.JSONPRequest=a;b.jsonp=function(d,f){var e=new b.JSONPRequest(d,f);return e.send.apply(e,c.Array(arguments,2,true));
};},"1.0.0",{requires:["jsonp"]});
YUI.add("z-search-autocomplete",function(g){var a="AutoComplete",e="getRegionByPrefix?prefix={query}&json&callback={callback}",b="?centroid=POINT({lon} {lat})&prefix={query}&callback={callback}&json",d="recentSearches",c,f=g.namespace("Z");
f[a]=g.Base.create("AutoComplete",g.Base,[f.ManagedBase,f.EventHandleManager],{_config:null,_recentSearchAutocompleteSource:null,_addressAutocompleteSource:null,_regionAutocompleteSource:null,_recentSearchAC:null,_regionSearchAC:null,_addressSearchAC:null,_ACList:null,_inputNode:null,_scrollHandle:null,_configDefaults:{showCurrentLocation:false,showRecentSearches:true,showAddressAutocomplete:false,showRegionAutocomplete:true,inputNodeSelector:"#citystatezip",minQueryLength:3,maxResults:5,resultListLocator:"names",resultHighlighter:"phraseMatch",render:true},initializer:function(h){var j,i;
if(h.ac_results_url&&h.region_autocomplete_source_url===undefined){h.region_autocomplete_source_url=h.ac_results_url;
}this._config=g.merge(this._configDefaults,h);this._inputNode=g.one(h.inputNodeSelector);this._inputNode.ancestor().addClass("yui3-skin-sam");
if(this._config.showRecentSearches||this._config.showCurrentLocation){this._setupRecentSearchAutoComplete(this._config);
}if(this._config.showAddressAutocomplete){this._setupAddressAutocomplete(this._config);}if(this._config.showRegionAutocomplete){this._setupRegionAutocomplete(this._config);
}this._ACList=[this._recentSearchAC,this._regionSearchAC,this._addressSearchAC];if(this._regionSearchAC&&this._addressSearchAC){this._regionSearchAC.on("results",this._onRegionACResults,this);
}if(this._config.hideOnScroll){this.scrollHandle=g.on("scroll",g.bind(this._hideAllACLists,this));this.addHandle(g.on("listView:listViewTearDown",g.bind(this._detachScrollHandle,this)));
}this.addHandle(g.on("windowresize",g.bind(this._windowResized,this)));if(this._config.isMobileOrSimpleSearchBar){for(var k in this._ACList){if(this._ACList[k]){i=this._ACList[k].get("boundingBox");
i.setStyle("zIndex",99).setStyle("textAlign","left");}}}g.Global.publish("autoComplete:initialized",{broadcast:2});
g.fire("autoComplete:initialized");},destructor:function(){if(this._scrollHandle){this._scrollHandle.detach();
}for(var h in this._ACList){if(this._ACList[h]){this._ACList[h].destroy();}}this.removeHandles();},setACWidth:function(){var h=this._inputNode.get("offsetWidth");
for(var i in this._ACList){if(this._ACList[i]){this._ACList[i].get("boundingBox").set("offsetWidth",h);
}}},setACStyle:function(h,i){for(var j in this._ACList){if(this._ACList[j]){this._ACList[j].get("boundingBox").setStyle(h,i);
}}},getRecentSearchAC:function(){return this._recentSearchAC;},getRegionAC:function(){return this._regionSearchAC;
},getAddressAC:function(){return this._addressSearchAC;},_hasLocalStorage:g.cached(function(){try{var h="test";
localStorage.setItem(h,h);localStorage.removeItem(h);return true;}catch(i){return false;}}),_setupRecentSearchAutoComplete:function(k){var j=[],h;
if(k.showCurrentLocation){var n="CURRENT LOCATION";j.push(n);}if(k.showRecentSearches&&this._hasLocalStorage()){if(localStorage.getItem(d)){h=JSON.parse(localStorage.getItem(d));
}if(h){for(var l=(h.length-1);l>=0;l--){j.push(h[l]);}}}this._recentSearchAutocompleteSource=j;var m={inputNode:k.inputNodeSelector,maxResults:k.maxResults,minQueryLength:0,resultFormatter:g.bind(this._postFormatCurrentLocation,this),resultHighlighter:k.resultHighlighter,source:j,render:true,enableCache:false};
this._recentSearchAC=new g.AutoComplete(m);this._recentSearchAC.after("select",function(i){if(!this._recentSearchAC.get("disabled")){k.afterSelect(i);
this._recentSearchAC.reset("value");}},this);this._inputNode.on("valuechange",g.bind(function(){if(this._inputNode.get("value").length>=k.minQueryLength){this._recentSearchAC.set("source",[]);
}else{this._recentSearchAC.set("source",j);}},this));this._inputNode.on("focus",g.bind(function(){if(this._inputNode.get("value").length<k.minQueryLength){this._recentSearchAC.sendRequest();
}},this));},_setupAddressAutocomplete:function(i){var k=null;var j=b;if(!i.centroid.Latitude){i.centroid.Latitude="";
i.centroid.Longitude="";}this._addressAutocompleteSource=new f.JSONPRequest(i.address_autocomplete_source_url+j,{allowCache:true,format:function(m,n,o,p,q){return g.Lang.sub(m,{callback:n,query:encodeURIComponent(g.Lang.trim(o).toLowerCase()),lat:i.centroid.Latitude,lon:i.centroid.Longitude});
}});k=/\b[0-9a-f]{32}\b/i.exec(g.config.vstatic.base);var l="zillowSearchAutoCompleteAddress"+(k?("_"+k[0]):"");
this._addressAutocompleteSource.setProxy(l);var h={inputNode:i.inputNodeSelector,maxResults:i.maxResults,minQueryLength:i.minQueryLength,resultFormatter:g.bind(this._postFormatAddress,this),resultListLocator:i.resultListLocator,resultHighlighter:i.resultHighlighter,render:true,source:i.showRegionAutocomplete?[]:this._addressAutocompleteSource};
this._addressSearchAC=new g.AutoComplete(h);this._addressSearchAC.after("select",function(o){var n=this._addressSearchAC.get("inputNode");
var m=n.get("value");m=m.replace(/(;)\1+/g," ");m=m.replace(/;/g," ");n.set("value",m);n.blur();i.afterSelect(o);
},this);},_setupRegionAutocomplete:function(i){var k=e;var j=null;if(i.isMobileOrSimpleSearchBar){this._setBoxStyle();
}var h={inputNode:i.inputNodeSelector,maxResults:i.maxResults,minQueryLength:i.minQueryLength,resultFormatter:g.bind(this._postFormatAddress,this),resultListLocator:i.resultListLocator,resultHighlighter:i.resultHighlighter,render:true,queryDelay:100,source:new f.JSONPRequest(i.region_autocomplete_source_url+k,{allowCache:true,format:function(m,n,o){return g.Lang.sub(m,{callback:n,query:encodeURIComponent(g.Lang.trim(o).toLowerCase()),});
}})};j=/\b[0-9a-f]{32}\b/i.exec(g.config.vstatic.base);var l="zillowSearchAutoComplete"+(j?("_"+j[0]):"");
h.source.setProxy(l);this._regionAutocompleteSource=h.source;this._regionSearchAC=new g.AutoComplete(h);
this._regionSearchAC.after("select",function(m){i.afterSelect(m);},this);if(i.isMobileOrSimpleSearchBar){this._inputNode.on("focus",g.bind(function(){if(this._inputNode.get("value").length>=c){this._regionSearchAC.sendRequest();
}},this));}return i;},_setBoxStyle:function(){var h=g.all(".yui3-aclist-content");h.each(function(i){i.setStyles({"box-shadow":"none"});
});},_postFormatAddress:function(l,i){var k=g.one("#citystatezip");var j;var h=false;if(k){j=k.get("offsetWidth");
h=j<=500;}return g.Array.map(i,function(m){var n=m.raw,o;n=n.replace(/(;)\1*/g," ");if(h){o=n.substring(0,j/10);
if(n.length>(j/10)){o=o+"...";}return o;}return n;});},_postFormatRegion:function(i,h){return g.Array.map(h,function(j){return j.raw;
});},_postFormatCurrentLocation:function(j,h){var i=g.Array.map(h,function(k){return k.raw;});if(this._config.showCurrentLocation){i[0]="<div class=zsg-currentlocation >CURRENT LOCATION</div>";
}return i;},_windowResized:function(){this.setACWidth();},_onRegionACResults:function(h){if(h.results.length>0){this._addressSearchAC.set("source",[]);
}else{this._addressSearchAC.set("source",this._addressAutocompleteSource);this._addressSearchAC.sendRequest();
}},_hideAllACLists:function(){for(var h in this._ACList){if(this._ACList[h]){this._ACList[h].hide();}}},_detachScrollHandle:function(){if(this._scrollHandle){this._scrollHandle.detach();
}}});},"3.3.0",{requires:["base-build","z-jsonp","autocomplete-base","autocomplete-highlighters","autocomplete-list","event-resize","z-managed-base","z-event-handle-manager"]});

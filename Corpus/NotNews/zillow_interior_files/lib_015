YUI.add("map-for-rent-property-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");
function a(e){e.dotColor={color:b.SpriteMap.Colors.propertyPurple};e.diminishedEnabled=true;e.miniBubbleType=b.MiniBubbleType.Property;
e.subType=e.subType||6;a.superclass.constructor.call(this,e);}b.ForRentPropertyMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickProperty,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-premarket-property-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");
function a(e){e.miniBubbleType=b.MiniBubbleType.Property;e.dotColor={color:b.SpriteMap.Colors.propertyBlue};
e.diminishedEnabled=true;a.superclass.constructor.call(this,e);}b.PreMarketPropertyMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickProperty,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-generic-property-marker",function(b){var a=b.namespace("Z");var d=b.namespace("Z.Images");
function c(e){if(!e.favorite&&!e.priority){e.zoomedLabelStyle=a.PropertyDotState.LabelStyles.Only;e.labelStyle=a.PropertyDotState.LabelStyles.Only;
}e.diminishedEnabled=true;e.dotColor={color:a.SpriteMap.Colors.propertyGrey};e.miniBubbleType=a.MiniBubbleType.Property;
e.subType=e.subType||0;c.superclass.constructor.call(this,e);}a.GenericPropertyMarker=b.extend(c,a.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",b.bind(this._clickProperty,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("z-properties-result-mgr",function(d){var c=d.namespace("Z"),a="PropertiesResultMgr",b=c.BaseResultMgr;
c[a]=d.Base.create("propertiesResultMgr",b,[],{PropertyDisplayType:b.STATUS_TYPE,OverlayType:b.OVERLAY_TYPE,_getResultObj:function(k,i,j){var v=k[0],p=k[1],m=k[2],s=k[3],l=k[4],f=k[5],g=k[6],t=k[7],o=false,u=false,n;
if(v&&j[v]&&l===j[v].getSubType()){var r=j[v];delete j[v];return r;}if(i==="favorites"){o=true;}if(f===this.OverlayType.Heart){u=true;
}if(i==="nearbyProperties"){g=0;}if(t){n=this._getMiniBubbleData(s,t);}s=String(s);var h=null;var e={mapManager:this._mapManager,miniBubbleData:t?n:null,propertyId:v,latLong:c.LatLong.createFromMillionths(p,m),labelText:s,favorite:o,priority:u,diminished:g,pageSource:"search",hotelCalifornia:this._hotelCalifornia};
var q=this.PropertyDisplayType;switch(l){case q.ComingSoon:e.subType=l;h=new c.ForSalePropertyMarker(e);
break;case q.SpecialOffer:case q.OpenHouse:case q.ForSale:h=new c.ForSalePropertyMarker(e);break;case q.ForRent:h=new c.ForRentPropertyMarker(e);
break;case q.RecentlySold:h=new c.SoldPropertyMarker(e);break;case q.MakeMeMove:case q.PremarketForeclosure:case q.Preforeclosure:e.subType=l;
h=new c.PreMarketPropertyMarker(e);break;case q.Favorite:case q.Builder:case q.NotApplicable:default:e.subType=l;
h=new c.GenericPropertyMarker(e);break;}return h;},_getMiniBubbleData:function(g,e){var f={datasize:e.length,label:g,title:e[0],image:e[5],bed:e[1],bath:e[2],sqft:e[3],buildingname:null,isPropertyTypeVacantLand:e[4],lot:e[6],flexData:e[7]};
return f;},},{NS:"propertiesResultMgr",ATTRS:{resultType:{value:["favorites","properties","nearbyProperties"]},isMarker:{value:false},}});
},"1.0.0",{requires:["z-base-result-mgr","map-sold-property-marker","map-for-sale-property-marker","map-for-rent-property-marker","map-premarket-property-marker","map-generic-property-marker"]});

YUI.add("map-generic-building-marker",function(b){var a=b.namespace("Z");var d=b.namespace("Z.Images");
function c(e){e.miniBubbleType=a.MiniBubbleType.Building;e.subType=e.subType||0;if(!e.favorite){e.zoomedLabelStyle=a.PropertyDotState.LabelStyles.Only;
e.labelStyle=a.PropertyDotState.LabelStyles.Only;}c.superclass.constructor.call(this,e);}a.GenericBuildingMarker=b.extend(c,a.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",b.bind(this._clickBuilding,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-premarket-building-marker",function(c){var a=c.namespace("Z");var d=c.namespace("Z.Images");
function b(e){e.miniBubbleType=a.MiniBubbleType.Building;e.dotColor={color:a.SpriteMap.Colors.propertyBlue};
b.superclass.constructor.call(this,e);}a.PreMarketBuildingMarker=c.extend(b,a.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickBuilding,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-recently-sold-building-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");
function a(e){e.miniBubbleType=b.MiniBubbleType.Building;e.subType=e.subType||3;e.dotColor={color:b.SpriteMap.Colors.propertyYellow};
a.superclass.constructor.call(this,e);}b.RecentlySoldBuildingMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickBuilding,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-for-rent-building-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");
function a(e){e.subType=e.subType||6;e.miniBubbleType=b.MiniBubbleType.Building;e.dotColor={color:b.SpriteMap.Colors.propertyPurple};
a.superclass.constructor.call(this,e);}b.ForRentBuildingMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickBuilding,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("map-for-sale-building-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");
function a(e){e.miniBubbleType=b.MiniBubbleType.Building;e.subType=e.subType||1;e.dotColor={color:b.SpriteMap.Colors.propertyRed};
a.superclass.constructor.call(this,e);}b.ForSaleBuildingMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickBuilding,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("z-buildings-result-mgr",function(d){var c=d.namespace("Z"),a="BuildingsResultMgr",b=c.BaseResultMgr;
c[a]=d.Base.create("buildingsResultMgr",b,[],{PropertyDisplayType:b.STATUS_TYPE,OverlayType:b.OVERLAY_TYPE,_getResultObj:function(u,i,l){var o=u[0],e=u[1],q=u[2],t=u[3],k=["BUILDING",o,e].join("_"),n,h,p,m,s;
m=Number(q);q=String(q);var r=l[k];if(k&&r&&t===r.getSubType()&&q===r.getLabelText()){delete l[k];return r;
}if(i==="nearbyBuildings"){h=this._getNearByMiniBubbleData(null,u);}else{h=this._getMiniBubbleData(null,u);
}if(m>9){s="9+";}else{s=q;}q+=" units";var j=null;var g={mapManager:this._mapManager,miniBubbleData:h,propertyId:k,latLong:c.LatLong.createFromMillionths(o,e),labelText:q,overText:s,pageSource:"search",largeDot:m>=10,hotelCalifornia:this._hotelCalifornia};
var f=this.PropertyDisplayType;switch(t){case f.SpecialOffer:case f.OpenHouse:case f.ComingSoon:case f.ForSale:j=new c.ForSaleBuildingMarker(g);
break;case f.ForRent:j=new c.ForRentBuildingMarker(g);break;case f.RecentlySold:j=new c.RecentlySoldBuildingMarker(g);
break;case f.MakeMeMove:case f.PremarketForeclosure:case f.Preforeclosure:j=new c.PreMarketBuildingMarker(g);
break;case f.Favorite:case f.Builder:case f.NotApplicable:default:j=new c.GenericBuildingMarker(g);break;
}return j;},_getMiniBubbleData:function(g,e){var h=e[4];if(h&&h.length){var f={datasize:e.length,image:h[1],matchingPropertyCount:e[2],priceRange:h[0],buildingName:h[2],bed:h[3],bath:h[4],sqft:h[5]};
return f;}},_getNearByMiniBubbleData:function(g,e){var h=e[4];var f={datasize:e.length,image:h[1],matchingPropertyCount:e[2],priceRange:h[0],buildingName:h[2],bed:h[3],bath:h[4],sqft:h[5]};
return f;}},{NS:"buildingsResultMgr",ATTRS:{resultType:{value:["buildings","nearbyBuildings"]}}});},"1.0.0",{requires:["z-base-result-mgr","map-generic-building-marker","map-premarket-building-marker","map-recently-sold-building-marker","map-for-rent-building-marker","map-for-sale-building-marker"]});

YUI.add("map-new-community-marker",function(c){var b=c.namespace("Z");var d=c.namespace("Z.Images");function a(e){e.miniBubbleType=b.MiniBubbleType.Community;
e.subType=e.subType||1;if(e.labelText){e.zoomedLabelText=e.labelText+"\tSee new home plans";e.zoomedLabelStyle=b.PropertyDotState.LabelStyles.DoubleBelow;
}else{e.zoomedLabelText="See new home plans";e.zoomedLabelStyle=b.PropertyDotState.LabelStyles.SingleBelow;
}e.zoomBreak=13;e.dotColor={color:b.SpriteMap.Colors.propertyRed};if(e.count&&e.count>0){if(e.count>9){e.overText="9+";
e.largeDot=true;}else{e.overText=String(e.count);e.largeDot=false;}e.labelText=e.count+" new home"+(e.count>1?"s":"");
e.labelStyle=b.PropertyDotState.LabelStyles.SingleBelow;}a.superclass.constructor.call(this,e);}b.NewCommunityMarker=c.extend(a,b.StandardPropertyMarker,{initializer:function(e){this.on("SpriteMap:gesturemoveend",c.bind(this._clickCommunity,this));
}});},"3.3.0",{requires:["map-standard-property-marker"]});
YUI.add("z-communities-result-mgr",function(d){var c=d.namespace("Z"),a="CommunitiesResultMgr",b=c.BaseResultMgr;
c[a]=d.Base.create("communitiesResultMgr",c.BaseResultMgr,[],{_getResultObj:function(n){var i=n[0],k=n[1],e=n[2],l=n[3],j=n[4],m=n[5],g;
l=String(l);if(m){g={datasize:3,image:m[1],matchingPropertyCount:j,title:l,priceRange:m[0]};}var h=null;
var f={mapManager:this._mapManager,miniBubbleData:m?g:null,propertyId:i,latLong:c.LatLong.createFromMillionths(k,e),labelText:l,count:j,pageSource:"search"};
return new c.NewCommunityMarker(f);}},{NS:"communitiesResultMgr",ATTRS:{resultType:{value:"communities"}}});
},"1.0.0",{requires:["z-base-result-mgr","map-new-community-marker"]});
YUI.add("z-regions-result-mgr",function(f){var e=f.namespace("Z"),a="RegionsResultMgr",b=e.BaseResultMgr,c=b.ICON_TYPE,d=b.STATUS_TYPE,g=b.MAP_ITEM_TYPE;
e[a]=f.Base.create("regionsResultMgr",e.BaseResultMgr,[],{_getResultObj:function(r){var p,i=r[0],n=r[1],h=r[2],o=r[5],k=r[3],m=r[6]===1,l=this.get("mapItemType"),q=d.NotApplicable,j;
if(k){j="\n"+k+(k==1?" home":" homes");}o=String(o+j);return{getId:function(){return this.id;},id:i,longitude:h,latitude:n,itemType:l,getLabelData:function(){return this.labelData;
},labelData:o,statusType:q,customData:{isChild:m,count:k}};}},{NS:"regionsResultMgr",ATTRS:{resultType:{value:"regions"},isMarker:{value:false},mapItemType:{value:g.Region}}});
},"1.0.0",{requires:["z-base-result-mgr"]});
YUI.add("z-map-bounding-rect",function(c){var b=c.namespace("Z"),a="BoundingRect";b[a]=function(d,f,e,g){c.log("BoundingRect is deprecated. Use Y.Z.LatLngBounds instead.");
if(!b.LatLong.validateLongitude(d)||!b.LatLong.validateLatitude(f)||!b.LatLong.validateLongitude(e)||!b.LatLong.validateLatitude(g)){throw new Error("Invalid bounding rect.");
}this.west=d;this.south=f;this.east=e;this.north=g;};b[a].prototype={getWest:function(){return this.west;
},getSouth:function(){return this.south;},getEast:function(){return this.east;},getNorth:function(){return this.north;
},calculateArea:function(){return(this.east-this.west)*(this.north-this.south);},getCenter:function(){var e=Math.round((b.VETiles.LongitudeToPixelX(this.east,18)+b.VETiles.LongitudeToPixelX(this.west,18))/2);
var d=Math.round((b.VETiles.LatitudeToPixelY(this.south,18)+b.VETiles.LatitudeToPixelY(this.north,18))/2);
var f=b.VETiles.PixelYToLatitude(d,18);var g=b.VETiles.PixelXToLongitude(e,18);return new b.LatLong.createFromMillionths(f,g);
}};b[a].createFromDegrees=function(d,f,e,g){return new b.BoundingRect(b.LatLong.degreesToMillionths(d),b.LatLong.degreesToMillionths(f),b.LatLong.degreesToMillionths(e),b.LatLong.degreesToMillionths(g));
};b[a].createFromMillionths=function(d,f,e,g){return new b.BoundingRect(d,f,e,g);};b[a].calculateIntersection=function(h,g){var d=Math.max(h.getWest(),g.getWest());
var f=Math.min(h.getEast(),g.getEast());var i=Math.min(h.getNorth(),g.getNorth());var e=Math.max(h.getSouth(),g.getSouth());
if(d>f||e>i){return null;}return b.BoundingRect.createFromMillionths(d,e,f,i);};b[a].isIntersected=function(e,d){return(e.getWest()>d.getEast()||d.getWest()>e.getEast()||e.getSouth()>d.getNorth()||d.getSouth()>e.getNorth())?false:true;
};b[a].equals=function(e,d){if(e==null&&d==null){return true;}else{if(e==null||d==null){return false;
}}return(e.getWest()===d.getWest()&&e.getSouth()===d.getSouth()&&e.getEast()===d.getEast()&&e.getNorth()===d.getNorth());
};b[a].isValid=function(d){return(d&&d.calculateArea()>0);};b[a].toString=function(d){if(d){return"RECT(w:"+d.getWest()+" s: "+d.getSouth()+" e:"+d.getEast()+" n:"+d.getNorth()+")";
}return"null";};b[a].containsLatLong=function(d,e){if(d&&e){return e.getLatitude()>=d.getSouth()&&e.getLatitude()<=d.getNorth()&&e.getLongitude()>=d.getWest()&&e.getLongitude()<=d.getEast();
}return false;};c.config.win[a]=b[a];},"3.5.0",{requires:["z-map-lat-lon","z-map-vetiles"]});
YUI.add("zutils",function(g){g.namespace("Z");var d=g.UA.webkit,c=(d&&d<420)?function(h){while((/(-[a-z])/i).exec(h)){h=h.replace(RegExp.$1,RegExp.$1.substr(1).toUpperCase());
}return h;}:function(h){return h.replace(/-([a-z])/gi,function(j,i){return i.toUpperCase();});};function a(h){return h.substring(0,1).toUpperCase()+h.substring(1);
}function e(h){return h.replace(/([a-z])([A-Z])/g,"$1 $2");}function b(h,i){var j=c(i.replace(h,""));
return a(j);}function f(i,k,m){var h=[],n=g.Lang.isFunction,j=g.Z[i],l=g.namespace(k);g.each(m.replace(/\s+/g,"").split(","),function(p){var o=l[j(p)];
if(n(o)){h.push(o);}});return h;}g.mix(g.Z,{capCase:g.cached(a),capSpace:g.cached(e),moduleToClass:g.cached(g.bind(b,null,/^(zillow|z)/)),pluginToClass:g.cached(g.bind(b,null,/^(zillow|z)|\-plugin/g)),moduleListToArray:g.bind(f,null,"moduleToClass","Z"),pluginListToArray:g.bind(f,null,"pluginToClass","Z.Plugin")});
},"3.1.1",{requires:["yui-base"]});
YUI.add("z-map-geo-polygon",function(d){var c=d.namespace("Z");function b(f){if(!(f instanceof Array)||f.length<3){throw new Error("Invalid ring.");
}this._coordinates=f;}b.createFromCoordinates=function(f){return new b(f);};b.toString=function(f){var g="(";
if(f&&(f.getCoordinates() instanceof Array)){g+=f.getCoordinates().join(" ");}g+=")";return g;};b.prototype={getCoordinates:function(){return this._coordinates;
},toString:function(){return b.toString(this);}};function a(g,f){if(!(g instanceof b)||(f!=null&&!(f instanceof Array))){throw new Error("Invalid polygon.");
}this._shell=g;this._holes=f;}a.createFromShellCoordinates=function(f){var g=b.createFromCoordinates(f);
if(g){return new a(g,null);}return null;};a.toString=function(g){var h="(";if(g){h+="shell="+g.getShell();
var f=g.getHoles();if((f instanceof Array)&&f.length>0){h+="holes="+f;}}h+=")";return h;};a.prototype={getShell:function(){return this._shell;
},getHoles:function(){return this._holes;},toString:function(){return a.toString(this);}};function e(f){if(!(f instanceof Array)||f.length===0||!(f[0] instanceof a)){throw new Error("Invalid MultiPolygon");
}this._polygons=f;}e.createFromPolygonList=function(f){if(f&&f.length>0){return new e(f);}return null;
};e.toString=function(f){return""+f.getPolygons();};e.serializeToClipPolygon=function(l){var h=[];var g=l.getPolygons();
for(var k=0;k<g.length;k++){var f=[];var n=g[k].getShell().getCoordinates();for(var j=0;j<n.length;j++){f.push(n[j].getDegreesLatitude()+","+n[j].getDegreesLongitude());
}f.push(n[0].getDegreesLatitude()+","+n[0].getDegreesLongitude());if(f.length>0){h.push(f.join("|"));
}}var m="";if(h.length>0){m=h.join(":");}return m;};e.prototype={getPolygons:function(){return this._polygons;
},toString:function(){return e.toString(this);},serializeToClipPolygon:function(){return e.serializeToClipPolygon(this);
}};c.GeoRing=b;c.GeoPolygon=a;c.GeoMultiPolygon=e;},"3.5.0");
YUI.add("zillow-current-selection",function(e){var d=e.namespace("Z");function a(h,g){a.superclass.constructor.apply(this);
this.selectionName=h;this.boundingRect=g;}e.extend(a,e.Base,{getSelectionName:function(){return this.selectionName;
},getBoundingRect:function(){return this.boundingRect;},getSelectionType:function(){return this.selectionType;
},equals:function(g){throw new Error("SelectionBase.equals must be overridden");}},{NAME:"SelectionBase",equals:function(h,g){if(h===g){return true;
}if(h==null||g==null){return false;}if(h.getSelectionType()!=g.getSelectionType()){return false;}return h.selectionName==g.selectionName&&d.LatLngBounds.equals(h.boundingRect,g.boundingRect);
}});function b(g){b.superclass.constructor.call(this,g.selectionName,g.boundingRect);this.selectionType=e.Z.SelectionType.Region;
this.regionURLString=g.regionURLString;this.regionType=g.regionType;this.regionId=g.regionId;}d.RegionSelection=e.extend(b,a,{getRegionURLString:function(){return this.regionURLString;
},getRegionType:function(){return this.regionType;},getRegionId:function(){return this.regionId;},equals:function(g){if(!a.equals(this,g)){return false;
}return this.regionURLString==g.regionURLString&&this.regionType==g.regionType&&this.regionId==g.regionId;
}},{NAME:"RegionSelection",isRegionSelection:function(g){return g!=null&&g.getSelectionType&&g.getSelectionType()===e.Z.SelectionType.Region;
},createFromJson:function(h){if(h.boundingRect){var g=h.boundingRect.sw,i=h.boundingRect.ne;h.boundingRect=new d.LatLngBounds(d.LatLong.createFromMillionths(g.lat,g.lon),d.LatLong.createFromMillionths(i.lat,i.lon));
}return new d.RegionSelection(h);}});function f(g){f.superclass.constructor.call(this,g.selectionName,g.boundingRect);
this.selectionType=e.Z.SelectionType.CustomRegion;this.customRegionId=g.customRegionId;this.customGeometry=g.customGeometry;
}d.CustomRegionSelection=e.extend(f,a,{getCustomGeometry:function(){return this.customGeometry;},getCustomRegionId:function(){return this.customRegionId;
},setCustomRegionId:function(g){this.customRegionId=g;},equals:function(g){return f.equals(this,g);}},{NAME:"CustomRegionSelection",equals:function(h,g){return a.equals(h,g)&&h.customGeometry===g.customGeometry&&h.customRegionId===g.customRegionId;
},isCustomRegionSelection:function(g){return g!=null&&g.getSelectionType&&g.getSelectionType()===e.Z.SelectionType.CustomRegion;
},createFromGeoMultiPolygon:function(h,g){var p=null;for(var q=0;q<h.getPolygons().length;q++){var r=h.getPolygons()[q].getShell().getCoordinates();
if(r&&r.length>0){var n=r[0],j=n.getMillionthsLongitude(),k=n.getMillionthsLatitude(),s=n.getMillionthsLongitude(),o=n.getMillionthsLatitude();
for(var l=1;l<r.length;l++){n=r[l];j=Math.min(j,n.getMillionthsLongitude());k=Math.min(k,n.getMillionthsLatitude());
s=Math.max(s,n.getMillionthsLongitude());o=Math.max(o,n.getMillionthsLatitude());}var m=new d.LatLngBounds(d.LatLong.createFromMillionths(k,j),d.LatLong.createFromMillionths(o,s));
if(p==null){p=m;}else{p=p.union(m);}}}return new d.CustomRegionSelection({customGeometry:h,boundingRect:p,customRegionId:g});
},createFromSelectionObjectJson:function(i){if(i.boundingRect){var g=i.boundingRect.sw,k=i.boundingRect.ne;
i.boundingRect=new d.LatLngBounds(d.LatLong.createFromMillionths(g.lat,g.lon),d.LatLong.createFromMillionths(k.lat,k.lon));
}var m=i.customGeometry;try{var h=m;var l=[];e.Array.map(h._polygons,function(o){var p=[];var n=null;
e.Array.map(o._shell._coordinates,function(q){p.push(new d.LatLong(q[1],q[0]));});if(o._holes){n=[];e.Array.map(o._holes,function(r){var q=[];
e.Array.map(r,function(s){q.push(new d.LatLong(s[1],s[0]));});n.push(new d.GeoRing(q));});}l.push(new d.GeoPolygon(new d.GeoRing(p),n));
});m=new d.GeoMultiPolygon(l);}catch(j){e.log("Failed to create GeoMultiPolygon from string:"+m,"error","CustomRegionSelection");
return null;}return d.CustomRegionSelection.createFromGeoMultiPolygon(m,i.customRegionId);}});function c(g){c.superclass.constructor.call(this,g);
this.selectionType=e.Z.SelectionType.SavedSearch;this.enrollmentId=g.enrollmentId;}d.SavedSearchSelection=e.extend(c,f,{getEnrollmentId:function(){return this.enrollmentId;
},equals:function(g){return f.equals(this,g)&&this.enrollmentId===g.enrollmentId;}},{NAME:"SavedSearchSelection",isSavedSearchSelection:function(g){return g!=null&&g.getSelectionType&&g.getSelectionType()===e.Z.SelectionType.SavedSearch;
},createFromJson:function(h){if(h.boundingRect){var g=h.boundingRect.sw,i=h.boundingRect.ne;h.boundingRect=new d.LatLngBounds(d.LatLong.createFromMillionths(g.lat,g.lon),d.LatLong.createFromMillionths(i.lat,i.lon));
}return new d.SavedSearchSelection(h);}});d.SelectionType={Region:1,SavedSearch:2,CustomRegion:3};},"3.3.0",{requires:["base-base","z-map-geo-polygon","z-map-lat-lon","z-map-lat-lng-bounds"]});

YUI.add("zillow-selection-manager",function(d){var c=d.namespace("Z");c.SelectionRequest=d.Base.create("SelectionRequest",d.Base,[],{initializer:function(){this.requestActive=false;
},destructor:function(){if(this.connection){this.connection.abort();}},_createRequestUrl:function(){return this.get("url")+"?regionId="+this.get("regionId");
},sendRequest:function(){var e=this._createRequestUrl(this.regionId);if(e){this.connection=d.io(e,{on:{success:this.success,failure:this.failure},timeout:this.get("timeout"),context:this});
this.requestActive=true;}},success:function(j,i){if(this.requestActive){if(i.responseText&&i.responseText.length>0){try{var h=d.JSON.parse(i.responseText),f=null;
if(h){f=c.RegionSelection.createFromJson(h);}c.SelectionManager.onGetRegionSelectionResponse(f,this.get("clickLatLong"));
}catch(g){d.log("selection json failed","error","SelectionRequest");d.log(i.responseText,"debug","SelectionRequest");
}}}this.requestActive=false;},failure:function(f,e){this.requestActive=false;},cancelRequest:function(){if(this.connection){this.requestActive=false;
if(this.connection.isInProgress()){this.connection.abort();}}}},{ATTRS:{regionId:{},clickLatLong:{},timeout:{readOnly:true,value:60000},url:{readOnly:true,value:"/search/GetRegionSelection.htm"}}});
var a=null;var b=null;c.SelectionManager={requestSelectionChange:function(g,f){var e=SearchMain.getPageState().getCurrentSelection();
if((c.RegionSelection.isRegionSelection(e)&&e.getRegionId()===g&&a===null)||(g===a)){return;}if(b){b.cancelRequest();
b=null;}a=g;b=new c.SelectionRequest({regionId:g,clickLatLong:f});b.sendRequest();},clearSelection:function(){SearchMain.onRegionSelectionResponse(null,null);
},onGetRegionSelectionResponse:function(g,f){if(c.RegionSelection.isRegionSelection(g)&&g.getRegionId()===a){a=null;
b=null;var e=SearchMain.getPageState().getCurrentSelection();SearchMain.onRegionSelectionResponse(g,f,e);
}},onGetRegionSelectionFailure:function(e){if(e.get("regionId")===a){b=null;a=null;}}};},"3.3.0",{requires:["map-sprite-util","io-base","base-build","zillow-current-selection","json-parse"]});

YUI.add("map-base-tile",function(c){var a=c.namespace("Z");function b(h,f,g,e,d,i){b.superclass.constructor.apply(this);
this.row=h;this.column=f;this.zoom=g;this.width=e;this.height=d;this.ratio=(i>1)?i:1;this.layerContainer=undefined;
this.left=undefined;this.top=undefined;this.contextWrappers={};}a.BaseTile=c.extend(b,c.Base,{getRow:function(){return this.row;
},getColumn:function(){return this.column;},getZoom:function(){return this.zoom;},getWidth:function(){return this.width;
},getHeight:function(){return this.height;},getRatio:function(){return this.ratio;},hitDetect:function(d,e){return null;
},getLeft:function(){return this.left;},getTop:function(){return this.top;},getLayerContainer:function(){return this.layerContainer;
},destructor:function(){for(var e in this.contextWrappers){var d=this.contextWrappers[e];if(d){d.remove();
}}this.contextWrappers={};},reposition:function(i,h,g,d){for(var f in this.contextWrappers){var e=this.contextWrappers[f];
if(e){e.reposition(i,h,g,d);}}},pauseDraw:function(){},resumeDraw:function(){},getContext:function(d){return this.contextWrappers[d];
},setContext:function(e,d){this.contextWrappers[e]=d;return d;},destroyContext:function(e){var d=this.contextWrappers[e];
if(d){d.remove();}delete this.contextWrappers[e];},initialize:function(d,f,e){this.layerContainer=d;this.left=f;
this.top=e;}},{NAME:"BaseTile"});},"3.3.0",{requires:["base-base"]});
YUI.add("map-sprite-tile",function(f){f.namespace("Z.SpriteMap.Util");var e=f.Z,a=e.SpriteMap,c=e.SpriteMap.Util;
var d=0;function b(o,j,n,i,l,h,m,g,k){b.superclass.constructor.call(this,o,j,n,h,m,g);this._nodes={};
this._zNodes=[];this._redrawTimerId=null;this._redrawLayer=f.bind(this._redrawLayer,this);this._layer=k;
this.baseZIndex=i;this._drawingPaused=false;this._drawOnResume=false;}a.Tile=f.extend(b,e.BaseTile,{_drawNodes:function(l,h,n,k){l.beginDraw();
var g=-n;var m=-k;if(l){for(var j=0;j<h.length;j++){h[j].drawTree(l,g,m);}}l.endDraw();},_clearRect:function(g,h){if(h){h.clearRect(0,0,Math.round(g.getWidth()*g.getRatio()),Math.round(g.getHeight()*g.getRatio()));
}},hitDetect:function(n,m,g){var h=null;var p=n+(this.getColumn()*this.getWidth());var o=m+(this.getRow()*this.getHeight());
var j=this._getSortedNodes();for(var l=j.length-1;l>=0;--l){var k=j[l];if(k.hitDetect(p,o,g)){h=k;break;
}}this._layer.hitDetectResult(h,g);return h;},setDirty:function(){if(this._redrawTimerId===null){this._redrawTimerId=window.setTimeout(this._redrawLayer,1);
}},pauseDraw:function(){this._drawingPaused=true;},resumeDraw:function(){this._drawingPaused=false;if(this._drawOnResume){this._redraw();
}this._drawOnResume=false;},dirtyNode:function(g){this._layer.addNodes(g);},reposition:function(j,i,h,g){},activate:function(g,h){},deactivate:function(g){},drawOnBaseLayer:function(g){},clearBaseLayer:function(){},drawSelectedRegion:function(g){},activateMultiple:function(g){},drawNow:function(){if(this._redrawTimerId){window.clearTimeout(this._redrawTimerId);
this._redraw();}},_redrawLayer:function(){this._redraw();},_redraw:function(){this._redrawTimerId=null;
if(!this._drawingPaused){if(this.layerContainer){var h=this._getContext();this._clearRect(this,h);this._drawNodes(h,this._getSortedNodes(),(this.column*this.getWidth()),(this.row*this.getHeight()));
}d--;if(d===0){var g=f.config.win.ClientProfiler;if(g){g.profile("important Finish of first sprite map draw");
}d=-10000;}}else{this._drawOnResume=true;}},_getSortedNodes:function(){return this._zNodes;},removeTile:function(i,g,h){b.superclass.removeTile.call(this,i,g,h);
},destructor:function(){this._zNodes=[];for(var g in this._nodes){this._nodes[g].removeTileParent(this);
}this._nodes={};if(this._redrawTimerId){window.clearTimeout(this._redrawTimerId);this._redrawTimerId=null;
}},removeNodes:function(g){if(!f.Lang.isArray(g)){g=[g];}for(var h=0;h<g.length;++h){var j=g[h];if(this._nodes[j.nodeId]){j.removeTileParent(this);
delete this._nodes[g[h].nodeId];this.setDirty();}}for(h=this._zNodes.length-1;h>=0;--h){if(!this._nodes[this._zNodes[h].nodeId]){this._zNodes.splice(h,1);
}}},removeAllNodes:function(){this._zNodes=[];for(var g in this._nodes){this._nodes[g].removeTileParent(this);
}this._nodes={};},addNodes:function(g){if(!f.Lang.isArray(g)){g=[g];}else{g.sort(function(l,i){return l._zIndex-i._zIndex;
});}var j=0;for(var h=0;h<g.length;++h){var k=g[h];k.addTileParent(this);this._nodes[k.nodeId]=k;while(j<this._zNodes.length&&this._zNodes[j]._zIndex<=k._zIndex){j++;
}this._zNodes.splice(j,0,k);}this.setDirty();},_getContext:function(){var g=this.getContext(this.baseZIndex);
if(g===undefined){g=this.setContext(this.baseZIndex,this.getLayerContainer().createTileContext(this,this.baseZIndex,undefined));
}return g;},initialize:function(g,i,h){b.superclass.initialize.call(this,g,i,h);}},{NAME:"SpriteTile"});
},"3.3.0",{requires:["map-sprite-node","map-base-tile","map-sprite-util"]});
YUI.add("map-tile-wrapper",function(c){var b=c.namespace("Z");function a(f,d){this.impl=d;this.tileLayer=f;
var e=this;d.onLoadCallback=function(){f.onTileLoad(e);};}a.prototype=(function(){return{getRow:function(){return this.impl.getRow();
},getColumn:function(){return this.impl.getColumn();},getZoom:function(){return this.impl.getZoom();},getWidth:function(){return this.impl.getWidth();
},getHeight:function(){return this.impl.getHeight();},hitDetect:function(d,e){return this.impl.hitDetect(d,e);
},initialize:function(e,d){return this.impl.initialize(this.tileLayer.getLayerContainer(),e,d);},reposition:function(g,f,e,d){if(this.impl.reposition){this.impl.reposition(g,f,e,d);
}},destroy:function(){this.impl.destroy();},activate:function(d,e){if(this.impl.activate){this.impl.activate(d,e);
}},deactivate:function(d){if(this.impl.deactivate){this.impl.deactivate(d);}},drawOnBaseLayer:function(d){if(this.impl.drawOnBaseLayer){this.impl.drawOnBaseLayer(d);
}},clearBaseLayer:function(){if(this.impl.clearBaseLayer){this.impl.clearBaseLayer();}},drawSelectedRegion:function(d){if(this.impl.drawSelectedRegion){this.impl.drawSelectedRegion(d);
}},activateMultiple:function(d){if(this.impl.activateMultiple){this.impl.activateMultiple(d);}}};})();
b.TileWrapper=a;},"3.3.0",{requires:["yui-base"]});
YUI.add("base-tile-layer-impl",function(d){var c=d.namespace("Z");function b(e,g,f){return e+"_"+g+"_"+f;
}function a(){a.superclass.constructor.apply(this,arguments);this.tileLayer=undefined;this.tiles={};this.transitionTiles=[];
this._clearQueue=new d.AsyncQueue();}c.BaseTileLayerImpl=d.extend(a,d.Base,{getMapLayer:function(){return this.tileLayer;
},setMapLayer:function(e){this.tileLayer=e;},getTileWidth:function(){throw new Error("BaseTileLayerImpl.getTileWidth must be overridden");
},getTileHeight:function(){throw new Error("BaseTileLayerImpl.getTileHeight must be overridden");},getTile:function(g,e,f){return this.tiles[b(g,e,f)];
},bumpTransition:function(){this._clearQueue.pause();for(var e in this.tiles){this.transitionTiles.push(this.tiles[e]);
}this.tiles={};this._clearQueue.add({fn:this._clearTileGroup,context:this,timeout:10,until:d.bind(function(){return this.transitionTiles.length===0;
},this)});},getCurrentTiles:function(){return this.tiles;},getTransitionTiles:function(){return this.transitionTiles;
},removeTile:function(i,f,h){var e=false;var j=b(i,f,h);var g=this.tiles[j];if(g){g.destroy();delete this.tiles[j];
e=true;}return e;},insertTile:function(g,e,f){throw new Error("BaseTileLayerImpl.insertTile must be overridden");
},pauseDraw:function(){if(this.tiles){for(var f in this.tiles){var e=this.tiles[f];if(e&&e.pauseDraw){e.pauseDraw();
}}}},resumeDraw:function(){if(this.tiles){for(var f in this.tiles){var e=this.tiles[f];if(e&&e.resumeDraw){e.resumeDraw();
}}}},clearLayer:function(){if(this.tiles){for(var f in this.tiles){var e=this.tiles[f];this.removeTile(e.getRow(),e.getColumn(),e.getZoom());
}}},_clearTileGroup:function(){var e=10;for(var g=0;g<e;++g){var f=this.transitionTiles.pop();if(f){f.destroy();
}else{break;}}},clearTransitionTiles:function(){this._clearQueue.run();},destroyLayer:function(){this.clearLayer();
}},{NAME:"BaseTileLayerImpl",createTileId:b});},"3.3.0",{requires:["base-base","async-queue"]});
YUI.add("map-sprite-layer",function(g){g.namespace("Z.SpriteMap.Util");var f=g.Z,a=f.SpriteMap,c=a.Util;
var e=new c.Debug("SpriteLayer.js");var d=c.emptyFunction;var b=c.isNullOrUndefined;function h(i){h.superclass.constructor.apply(this);
this.pixelRatio=i||1;this.nodes={};this._reloadTimerID=null;this._hoveringNode=null;this._panningPaused=false;
}a.Layer=g.extend(h,f.BaseTileLayerImpl,{getTileWidth:function(){return this.tileLayer.getMapProjection().TILEWIDTH;
},getTileHeight:function(){return this.tileLayer.getMapProjection().TILEHEIGHT;},_getZoom:function(){var i=this._mapManager.getZillowMap();
if(i){return i.getZoomLevel();}e.assert(i,"Zoom queried before map initialization compelted");return 15;
},hitDetectResult:function(k,j){if(this._hoveringNode!==k){var i=this._hoveringNode;this._hoveringNode=null;
if(i){i.fire("SpriteMap:MouseOut",{nextHoverTarget:k});}if(k){k.fire("SpriteMap:MouseOver",{previousHoverTarget:i});
}this._hoveringNode=k;}},connectMapManager:function(i){this._mapManager=i;},removeTile:function(n,k,l){var m=this.tileLayer.getMapProjection();
var j=k*m.TILEWIDTH;var i=n*m.TILEHEIGHT;this.fire("SpriteLayer:removedTile",{row:n,column:k,zoom:l,width:m.TILEWIDTH,height:m.TILEHEIGHT,pixelY:i,pixelX:j,longitude:m.PixelXToLongitude(j,l),latitude:m.PixelYToLatitude(i,l),id:f.BaseTileLayerImpl.createTileId(n,k,l)});
return h.superclass.removeTile.call(this,n,k,l);},insertTile:function(r,k,q){if(this.getTile(r,k,q)===undefined){var i=f.BaseTileLayerImpl.createTileId(r,k,q);
var s=this.tileLayer.getZIndex();var j=this.tileLayer.getMapProjection();var o=new a.Tile(r,k,q,s,s+1,j.TILEWIDTH,j.TILEHEIGHT,this.pixelRatio,this);
var n=new f.TileWrapper(this.tileLayer,o);this.tiles[i]=o;this._queueReAddAllImages();var m=k*j.TILEWIDTH;
var l=r*j.TILEHEIGHT;this.fire("SpriteLayer:newTile",{row:r,column:k,zoom:q,width:j.TILEWIDTH,height:j.TILEHEIGHT,pixelY:l,pixelX:m,longitude:j.PixelXToLongitude(m,q),latitude:j.PixelYToLatitude(l,q),id:f.BaseTileLayerImpl.createTileId(r,k,q)});
return n;}return null;},getCurrentTileConfig:function(){var m=[];var n=this.tileLayer.getMapProjection();
for(var k in this.tiles){var l=this.tiles[k];var j=l.column*n.TILEWIDTH;var i=l.row*n.TILEHEIGHT;m.push({row:l.row,column:l.column,zoom:l.zoom,width:n.TILEWIDTH,height:n.TILEHEIGHT,pixelY:i,pixelX:j,longitude:n.PixelXToLongitude(j,l.zoom),latitude:n.PixelYToLatitude(i,l.zoom),id:f.BaseTileLayerImpl.createTileId(l.row,l.column,l.zoom)});
}return m;},changeImageryType:function(i){},getNumZLevels:function(){return 2;},pausePanning:function(){e.assert(!this._panningPaused,"Double pan pause attempt.  Does not support pause ref count.");
this._panningPaused=true;this._mapManager.pausePanning();},resumePanning:function(){e.assert(this._panningPaused,"Double pan resume attempt.  Does not support pause ref count.");
this._panningPaused=false;this._mapManager.resumePanning();},removeNodes:function(j,l){e.assert(!b(j),"Expected node or nodes to remove");
if(!g.Lang.isArray(j)){j=[j];}for(var k=0;k<j.length;++k){var m=j[k];if(!l&&this._hoveringNode===m){this.hitDetectResult(null,null);
}m.removeSelfFromAllParents();delete this.nodes[m.nodeId];}},removeAllNodes:function(){this.hitDetectResult(null,null);
for(var j in this.tiles){this.tiles[j].removeAllNodes();}for(var i in this.nodes){this.nodes[i].removeSelfFromAllParents();
}this.nodes={};},addNodes:function(E,G){e.assert(!b(E),"Expected node or nodes to remove");if(!g.Lang.isArray(E)){E=[E];
}var j=this.getTileWidth();var s=this.getTileHeight();var k=this._getZoom();var x=this._mapManager.getZillowMap().getBoundingRect();
var l=this.longLatToXY(x.getNorthEast());var t=this.longLatToXY(x.getSouthWest());var B=Math.ceil(l.x/j)+1;
var w=Math.floor(l.y/s)-1;var p=Math.floor(t.x/j)-1;var y=Math.ceil(t.y/s)+1;var u=f.BaseTileLayerImpl.createTileId;
for(var H=0;H<E.length;H++){var D=E[H];if(this.nodes[D.nodeId]&&G){continue;}if(this.nodes[D.nodeId]){this.removeNodes(D,true);
}D.attachToLayer(this);var v=D.getPixelBounds(),m=Math.max(p,Math.floor(v.left/j)),C=Math.min(B,Math.max(m,Math.floor((v.right-1)/j))),o=Math.max(w,Math.floor(v.top/s)),F=Math.min(y,Math.max(o,Math.floor((v.bottom-1)/s)));
var q=this._getZoom();e.assert(C-m<100,"Node is excessivly wide");e.assert(F-o<100,"Node is excessivly tall");
for(var A=o;A<=F;A++){for(var I=m;I<=C;I++){var J=this.tiles[u(A,I,q)];if(J){J.addNodes(D);}}}this.nodes[D.nodeId]=D;
}},_queueReAddAllImages:function(){if(this._reloadTimerID===null){this._reloadTimerID=window.setTimeout(g.bind(function(){this._reloadTimerID=null;
var j=[];for(var i in this.nodes){j.push(this.nodes[i]);}if(j.length>0){this.removeAllNodes();this.addNodes(j);
}},this),1);}},drawNow:function(){for(var i in this.tiles){this.tiles[i].drawNow();}},clearLayer:function(){h.superclass.clearLayer.call(this);
this._queueReAddAllImages();},destroyLayer:function(){this.nodes={};},longLatToXY:function(j){var i=this.tileLayer.getMapProjection();
var k=this._getZoom();return{x:i.LongitudeToPixelX(j.longitude,k),y:i.LatitudeToPixelY(j.latitude,k)};
}},{NAME:"SpriteLayer"});},"3.3.0",{requires:["map-sprite-tile","map-tile-wrapper","base-tile-layer-impl","map-sprite-util"]});

YUI.add("z-msg-view",function(c){var b=c.namespace("Z"),a="MsgView";b[a]=c.Base.create("msgView",c.Base,[],{_handles:null,_modelUpdateHandle:null,_content:null,initializer:function(){this._handles=[];
this.publish("show",{emitFacade:true,defaultFn:this._onMsgShow});this.publish("hide",{emitFacade:true,defaultFn:this._onMsgHide});
this.publish("showEnd",{emitFacade:true,defaultFn:this._onMsgShowEnd});this.publish("hideEnd",{emitFacade:true,defaultFn:this._onMsgHideEnd});
var d=this.get("container");if(d){this._handles.push(this.get("container").delegate("click",this._onCloseClick,this.get("closeBtnSelector"),this));
}this._initializeModelUpdateHandle();this.after("modelChange",function(){this.render();this._initializeModelUpdateHandle();
},this);},_initializeModelUpdateHandle:function(){var d=this.get("model");if(d){if(this._modelUpdateHandle&&this._modelUpdateHandle.detach){this._modelUpdateHandle.detach();
}this._modelUpdateHandle=d.on("change",function(f){this.render();if(f.src!=="alreadyForcingShow"&&this.get("autoUpdateVisibility")){if(this._getAutoVisibility()){this.fire("show");
}else{this.fire("hide");}}},this);}},_getAutoVisibility:function(){return !!this._content;},destructor:function(){this.get("container").empty();
c.Array.each(this._handles,function(d){if(d&&d.detach){d.detach();}});if(this._modelUpdateHandle&&this._modelUpdateHandle.detach){this._modelUpdateHandle.detach();
}},render:function(){var d=this.get("model"),e=this.get("template"),f,g={};if(d&&e){c.Object.each(d.toJSON(),function(i,h){g[h]=i||"";
},this);f=c.Lang.sub(this.get("template"),g);this._content=f;this.get("contentTarget").setHTML(f);}else{if(!d){c.log("Error! Attempted to render view without a model!","error",a);
}if(!e){c.log("Error! Attempted to render view without a template!","error",a);}}return this;},_showMsg:function(){var d=this.get("container"),e=this.get("hideClass");
d.removeClass(e);},_hideMsg:function(h){var d=this.get("container"),g=this.get("hideClass"),f;if(d){d.addClass(g);
}if(h){f=this.get("contentTarget");this._content=null;var e=this.get("model");if(e){e.reset();}f.empty();
}},_onMsgShow:function(f){c.log("Showing Message View: "+this.get("msgType"),"debug",a);var d=this.get("showDuration");
this._showMsg();if(d){c.later(d,this,function(){this.fire("showEnd");});}else{this.fire("showEnd");}},_onMsgHide:function(f){c.log("Hiding Message View: "+this.get("msgType"),"debug",a);
var d=this.get("hideDuration"),g=f.doEmpty||this.get("doEmptyOnHide");this._hideMsg(g);if(d){c.later(d,this,function(){this.fire("hideEnd");
});}else{this.fire("hideEnd");}},_onMsgShowEnd:function(f){var d=this.get("delayHideDuration");if(d){c.later(d,this,function(){this.fire("hide");
});}},_onMsgHideEnd:function(d){},_onCloseClick:function(d){this._hideMsg(d.doEmpty);},_setContentTarget:function(e){var d=this.get("container");
if(e&&d){return d.one(e);}return d;},_getContentTarget:function(d){return d||this.get("container");}},{ATTRS:{container:{setter:c.one},model:{},template:{},msgType:{required:true},contentTarget:{setter:"_setContentTarget",getter:"_getContentTarget"},hideClass:{value:"hide"},doEmptyOnHide:{value:false},showDuration:{value:0},hideDuration:{value:0},delayHideDuration:{value:0},autoUpdateVisibility:{value:true},autoHide:{value:true},closeBtnSelector:{value:".close"}}});
},"1.0.0",{requires:["base"]});
YUI.add("z-plugin-msg-mgr",function(e){var d=e.namespace("Z"),a="MsgMgr",f=e.Object,b=e.Lang,c=e.Array;
e.namespace("Z.Plugin")[a]=e.Base.create("msgMgr",e.Plugin.Base,[d.EventHandleManager],{_msgViews:null,_msgModels:null,initializer:function(g){this._msgViews=this._msgViews||{};
this._msgModels=this._msgModels||{};this.addHandle(this.onHostEvent("msg:show",this._onHostMsgShow,this));
this.addHandle(this.onHostEvent("msg:hide",this._onHostMsgHide,this));this.addHandle(this.onHostEvent("msg:update",this._onHostMsgUpdate,this));
},destructor:function(){this.removeHandles();this._unsetMsgs();this._msgViews=null;this._msgModels=null;
},getMsgByType:function(g){if(this._msgViews[g]&&this._msgModels[g]){return{view:this._msgViews[g],model:this._msgModels[g]};
}else{return undefined;}},_fireShowMsg:function(g){var h=this._msgViews[g];this._fireHideMsgs(g);if(h){h.fire("show");
}},_fireHideMsg:function(g){var h=this._msgViews[g];if(h){h.fire("hide");}},_updateMsgModelAttrs:function(i,k,g){var h=this._msgModels[i],j=this._msgViews[i];
if(h){h.setAttrs(k,{src:g===true?"alreadyForcingShow":null});}if(g){j.fire("show");}},_fireHideMsgs:function(i,h){var g;
f.each(this._msgViews,function(j){g=j.get("msgType");if(h||(j.get("autoHide")&&g!==i)){this._fireHideMsg(g);
}},this);},_unsetMsgs:function(){var g;f.each(this._msgViews,function(h){g=h.get("msgType");this._unsetMsgView(g);
this._unsetMsgModel(g);},this);},_unsetMsgView:function(g){var h=this._msgViews[g];if(h&&h.destroy){h.destroy();
}delete this._msgViews[g];},_unsetMsgModel:function(h){var g=this._msgModels[h];if(g&&g.destroy){g.destroy();
}delete this._msgModels[h];},_setMsgs:function(h){var g;var i;if(!h){this._unsetMsgs();}else{if(b.isString(h)){this._unsetMsgView(h);
return this._msgViews;}else{if(!b.isArray(h)){h=[h];}}}c.each(h,function(j){if(j&&e.Lang.isFunction(j.get)){g=j.get("msgType");
i=j.get("model");if(g&&i){this._msgViews=this._msgViews||{};this._msgModels=this._msgModels||{};this._msgViews[g]=j;
this._msgModels[g]=j.get("model");}else{e.log("Error! Illegal view argument passed to _setMsgs!","error",a);
return e.Attribute.INVALID_VALUE;}}else{e.log("Error! Invalid view argument passed to _setMsgs!","error",a);
return e.Attribute.INVALID_VALUE;}},this);return this._msgViews;},_onHostMsgShow:function(g){this._fireShowMsg(g.msgType);
},_onHostMsgHide:function(i){var g=i.msgType,h=i.hideAll;if(h){this._fireHideMsgs(null,true);}else{this._fireHideMsg(g);
}},_onHostMsgUpdate:function(g){this._updateMsgModelAttrs(g.msgType,g.updateAttrs,g.show);}},{NS:"msgMgr",ATTRS:{msgs:{lazyAdd:false,setter:"_setMsgs"}}});
},"1.0.0",{requires:["base","plugin","z-event-handle-manager"]});
YUI.add("zillow-search-main-map",function(d){var c=d.namespace("Z"),a=d.config.win.ClientProfiler||{profile:function(){}};
function b(e){b.superclass.constructor.apply(this,arguments);}c.SearchMainMap=d.extend(b,d.Base,{initializer:function(e){this._mapState=e.mapState;
this._selection=e.selection;this._mapAddons=e.mapAddons;this._useCustomTiles=e.useCustomTiles;this._customRoadURL=e.customRoadURL;
this._customAerialURL=e.customAerialURL;this._resultMgrList=e.resultMgrList;this._displayState=e.displayState;
this._mapRollupThreshold=e.mapRollupThreshold;this._disambigMsgView=e.disambigMsgView;this._searchLayoutMgr=e.searchLayoutMgr;
this._schoolsConfig=e.schoolsConfig;this._mapLoaded=false;this._schoolsAddon=null;this._mapDisplayDivSelector="#map-parent-container";
this._mapManager=null;this._spriteLayer=null;this._markerSprites=[];this._markersVisible=true;this._neverSentDrawStartBefore=true;
this._eventHandlers=[];this._initializeMap();this._initializeManagers();this._hookListeners();this._initMapMsgMgr();
this._eventHandlers.push(d.on("priorityUiReady",this._onSearchPriorityReady,this));},destructor:function(){var e=0;
for(e=0;e<this._eventHandlers.length;++e){this._eventHandlers[e].detach();}this._eventHandlers=[];if(this._mapManager){this._mapManager.destroy();
this._mapManager=null;}if(this._hoverInfoLayer){this._hoverInfoLayer.destroy();this._hoverInfoLayer=null;
}if(this._bubbleManager){this._bubbleManager.destroy();this._bubbleManager=null;}if(this._miniBubbleManager){this._miniBubbleManager.destroy();
this._miniBubbleManager=null;}},reinitializeMap:function(e){this._mapManager.requestMapModeTypeChange(e.getMapState().getMapModeType());
this._mapManager.reinitializeMap(e.getMapState(),e.getCurrentSelection());c.SearchMain.applyRegionSelection(e.getCurrentSelection());
},_onSearchPriorityReady:function(){if(d&&d.config&&d.config.commuteEnabled&&d.config.canvas&&this._mapManager){var e=function(i){d.use("zillow-favorite-locations",d.bind(function(){this._favoriteLocations=new c.FavoriteLocations({mapManager:this._mapManager,layoutMgr:this._searchLayoutMgr,startEnabled:i});
},this));};try{var g=new c.Storage();var h=g.getData("FavoriteLocations");if(d.Lang.isString(h)){h=JSON.parse(h);
}if(h&&h.locationsEnabled){e.call(this,true);return;}}catch(f){d.log("Failed to load stored favorite location data","error");
d.log(f.message||f,"error");}this._mapManager.initializeLocationControl();this._mapManager.once("locationEnable:click",d.bind(e,this,true));
}if(this._schoolsConfig.enabled){d.use("z-schools-map-addon",d.bind(function(){this._schoolsAddon=new d.Z.SchoolsMapAddon({mapManager:this._mapManager,boundaryManager:c.SearchMain.getBoundaryManager(),addonPanelNode:d.one("#searchMap-map-wrapper .school-filter-view-container"),initConfig:this._schoolsConfig});
this._schoolsAddon.start();this._mapManager.on("schoolsEnable:click",function(){this._bubbleManager.closeActiveBubble();
this._schoolsAddon.toggleFilterPane();this._schoolsAddon._activate();},this);},this));}},getAddonSearchParams:function(){if(this._schoolsAddon){return this._schoolsAddon.getSearchParams();
}return[];},_initializeMap:function(){d.log("initializeMap");var h=this,g,l,e=!!d.UA.mobile,i=!d.one("#brownout-web-picasso"),k;
if(!this._mapManager){l=this._mapState;g=new c.MapBuilder({mapName:"searchMap",parentContainer:this._mapDisplayDivSelector,boundingRect:l.getBoundingRect(),zoomLevel:l.getZoomLevel(),imageryType:l.getMapModeType(),currentSelection:this._selection,isActivatableFn:c.SearchMapEventHandler.isActivatable,useMapTypeChangeControl:true,usePicassoControl:true});
if(this._useCustomTiles){var j=this._customRoadURL;var f=this._customAerialURL;k=function(n,p,o,m){return c.ImageryTile.createRoadUrl(n,p,o,m,j,f);
};}g.addLayer("ImageryTileLayer",new c.ImageryTileLayer(l.getMapModeType(),k),new c.LayerSettings(c.LayerSettings.LoadTiming.OnDragReleaseDouble,false,c.LayerSettings.ZoomTransform.Scale,c.LayerSettings.LayerType.Tiled));
this._boundaryLayer=new c.SpriteMap.Layer(g.getCanvasPixelRatio());g.addLayer("BoundaryLayer",this._boundaryLayer,new c.LayerSettings(c.LayerSettings.LoadTiming.OnDragRelease,true,c.LayerSettings.ZoomTransform.None,c.LayerSettings.LayerType.Tiled));
this._spriteLayer=new c.SpriteMap.Layer(g.getCanvasPixelRatio());g.addLayer("SpriteLayer",this._spriteLayer,new c.LayerSettings(c.LayerSettings.LoadTiming.OnDragRelease,true,c.LayerSettings.ZoomTransform.None,c.LayerSettings.LayerType.Tiled));
this._hoverLayer=new c.SpriteMap.Layer(g.getCanvasPixelRatio());g.addLayer("HoverLayer",this._hoverLayer,new c.LayerSettings(c.LayerSettings.LoadTiming.OnDragRelease,true,c.LayerSettings.ZoomTransform.None,c.LayerSettings.LayerType.Tiled));
this._mapManager=g.createMapManager();this._boundaryLayer.connectMapManager(this._mapManager);this._spriteLayer.connectMapManager(this._mapManager);
this._hoverLayer.connectMapManager(this._mapManager);this._mapManager.set("usePicassoControl",i);this._mapManager.set("useSchoolsControl",true);
this._mapManager.set("resultMgrList",this._resultMgrList);}},_onMapLoad:function(){this._mapLoaded=true;
if(this._mapAddons.addons.universities.enabled){d.use("z-universities-result-mgr",d.bind(function(){this._university=new c.UniversitiesResultMgr({spriteLayer:this.getSpriteLayer(),list:this._mapAddons.addons.universities.resultMgrConfig.list});
},this));}},_initializeManagers:function(){this._hoverInfoLayer=new c.HoverInfoLayer(this._hoverLayer,this._mapManager);
this._bubbleManager=new c.BubbleManager(this._mapManager);this._miniBubbleManager=new c.MiniBubbleManager(this._mapManager,this._bubbleManager);
},_hookListeners:function(){this._eventHandlers.push(this._mapManager.on("map:load",this._onMapLoad,this),this._mapManager.on("map:panStart",this._onMapPanStart,this),this._mapManager.on("map:boundsChange",this._onMapPan,this),this._mapManager.on("map:resize",this._onMapPan,this),this._mapManager.on("map:zoomChange",this._onMapZoomChanged,this),this._mapManager.on("mapControl:click",this._onMapControlClicked,this));
},_onMapPanStart:function(){this._resultMgrList.cancelRequest();d.Z.SearchMain.clearPendingSearch();},getMapManager:function(){return this._mapManager;
},getSpriteLayer:function(){return this._spriteLayer;},getHoverInfoLayer:function(){return this._hoverInfoLayer;
},getBubbleManager:function(){return this._bubbleManager;},getMiniBubbleManager:function(){return this._miniBubbleManager;
},_showMapDiv:function(){d.one(this._mapDisplayDivSelector).show();},_showMap:function(){d.log("_showMap","debug","SearchMainMap");
this._showMapDiv();if(!this._mapManager.isShowing()){this._mapManager.showMap();}c.PhotoExperience.init();
},setInitialMapState:function(i){var g=i.getDisplayState().getDisplayMode(),h=i.getBubbleDataObject(),l=i.getDisplayState().getZpid(),e;
c.SearchMain.setLoadedPageStateInMapMode(true);e=i.getMapState().getMapModeType();if(e===null||e==c.MapConstants.MapModeType.Map){if(this._mapManager.getMapState()){if(this._mapManager.getCurrentMapMode()){e=this._mapManager.getCurrentMapMode();
}else{var j=this._mapManager.getMapState().getZoomLevel();var k=16;if(j>k){e=c.MapConstants.MapModeType.Hybrid;
}else{e=c.MapConstants.MapModeType.Street;}}}else{e=c.MapConstants.MapModeType.Hybrid;}}this._mapManager.requestMapModeTypeChange(e);
this._showMap();var f=l||(h&&h.zpid);if(f){c.SearchMain.setInitialZpid(f);}if(h){c.SearchMain.setInitialBubble(h,i.obj.minibubble);
}if(this._mapLoaded){c.SearchMain.doSearch(true,true);}},_onMapPan:function(g){var f=g.bounds,h=g.zoom;
if(c.BoundingRect.isValid(f)){d.log("MAP PAN!");this._mapManager.fire("msg:update",{msgType:"disambigMsg",updateAttrs:{disambigContent:""}});
if(this._bubbleManager.isBubbleInRectangle(f)){this._bubbleManager.onMapViewChanged(f,h);}else{this._bubbleManager.closeActiveBubble();
}}},_onMapZoomChanged:function(g){var f=g.bounds,h=g.zoom;d.log("MAP ZOOM!");if(this._bubbleManager.isBubbleInRectangle(f)){this._bubbleManager.onMapViewChanged(f,h);
}else{this._bubbleManager.closeActiveBubble();}if(this._miniBubbleManager){this._miniBubbleManager.showCachedBubble(true);
}},_onMapControlClicked:function(f){this._bubbleManager.closeActiveBubble();},_initMapMsgMgr:function(){var e=[];
e.push(new c.MsgView({model:new d.Model({content:""}),template:"{content}",msgType:"rollupMsg",container:"#map-rollup-info-message",contentTarget:".map-info-message-container",autoHide:false}));
e.push(this._disambigMsgView);this._mapManager.plug(c.Plugin.MsgMgr,{msgs:e});},updateLayout:function(g){if(!this._mapManager){return;
}var f=d.one("#content");this._mapManager.resize(f.get("offsetWidth"),f.get("offsetHeight"));},_getMapMsgObject:function(h){var j={},i=this._mapRollupThreshold,e=this._mapManager.msgMgr.getMsgByType("rollupMsg"),f=e.view.get("contentTarget"),g;
j.msgType="rollupMsg";if(h==c.MapConstants.MapResultsMode.ShowingChildRollups){g=f.getHTML().replace("Only showing","Over").replace("Zoom in, or use filters to narrow your search","To see all homes, pick a region, zoom in, or use filters");
}else{if((h==c.MapConstants.MapResultsMode.OverrideChildRollups||h==c.MapConstants.MapResultsMode.Default)&&c.FilterManager.getBinCounts()&&c.FilterManager.getBinCounts().getTotalResultCount()>i){g=f.getHTML().replace("Over","Only showing").replace("To see all homes, pick a region, zoom in, or use filters","Zoom in, or use filters to narrow your search");
}}if(g){j.content=g;}return j;},_updateMapMessaging:function(e){var f;if(this._mapManager){f=this._getMapMsgObject(e);
if(f.content){this._mapManager.fire("msg:update",{msgType:f.msgType,updateAttrs:{content:f.content},show:true});
}else{this._mapManager.fire("msg:hide",{msgType:f.msgType});}}},updateResultMode:function(e){this._updateMapMessaging(e);
if(this._mapManager){this._mapManager.getMapState().setMapResultsMode(e);}},updateMarkerVisability:function(e){if(e==this._markersVisible){return;
}this._mapManager.selection.setSelectedItem();if(e){this._mapManager.findMapLayer("SpriteLayer").addNodes(this._markerSprites);
}else{this._mapManager.findMapLayer("SpriteLayer").removeNodes(this._markerSprites);}this._markersVisible=e;
},updateMarkers:function(e){this._markerSprites=[];},updateMarkersProgress:function(f){if(this._neverSentDrawStartBefore){a.profile("Start of first map draw");
this._neverSentDrawStartBefore=false;}for(var e=0;e<f.length;++e){if(f[e] instanceof c.SpriteMap.Node){this._markerSprites.push(f[e]);
}}},updateMarkersComplete:function(){if(this._mapManager&&this._markersVisible){var e=this._mapManager.findMapLayer("SpriteLayer");
e.addNodes(this._markerSprites,true);}},_updateLayerVisibility:function(e,g){var f=this._mapManager.findLayer(e);
if(f){if(g===false){f.hideLayer();}else{f.showLayer();}}},updateSearchInfoMessage:function(e,f){if(this._mapManager){var g={};
if(d.Lang.isString(e)){g.disambigContent=e;}if(d.Lang.isString(f)){g.keywordContent=f;}this._mapManager.fire("msg:update",{msgType:"disambigMsg",updateAttrs:g});
}}});},"3.3.0",{optional:["z-map-builder","map-hover-info-layer","zillow-canvas-map-manager","map-imagery-metadata","zillow-bubble-manager","map-mini-bubble","z-search-map-event-handler","zillow-page-state","zillow-current-selection","z-schools-result-mgr","z-universities-result-mgr"],requires:["z-msg-view","z-plugin-msg-mgr","map-sprite-node","map-sprite-layer","model"]});

YUI.add("zsg-notification-bar-dismiss",function(b){var c="zsg-notification-bar",a="[class^="+c+"]";b.namespace("ZSG").NotificationBarDismiss={_handles:[],init:function(){var d=this;
if(this._handles.length>0){return;}b.all(a).each(function(e){d._handles.push(e.delegate("click",d._onCloseClick,".zsg-notification-bar-close",d));
});},detach:function(){if(this._handles.length>0){this._handles.length=0;}},_onCloseClick:function(f){var d=b.one(f.currentTarget).ancestor("[class^="+c+"]");
f.preventDefault();this._removeNotification(d);},_removeNotification:function(d){if(d){d.remove(true);
}}};},"3.11.0",{requires:["node-event-delegate"]});
YUI.add("zillow-search-main-list",function(h){var g=h.namespace("Z");function d(i){d.superclass.constructor.apply(this,arguments);
}var c="debug",b="info",f="warn",e="error",a="SearchMainList";g.SearchMainList=h.extend(d,h.Base,{initializer:function(i){this._listContainerNode=i.listNode;
this._map=i.map;this._mapState=i.mapState;this._hotelCaliforniaApp=i.hotelCaliforniaApp;this._resultMgrList=i.resultMgrList;
this._mapResultCountDisplayed=false;this._mrcmDiv="#map-result-count-message";this._bubbleDataList={};
this._mustacheCss="";this._homeInfoJsonData={};this._homeInfoTemplateOutput={};this._currentZpid=null;
this._staticMap=null;this._listContainerNode.delegate("click",this._onPropertyListingClick,".property-listing",this);
if(this._map){this._listContainerNode.delegate("mouseenter",this._onPropertyListingMouseEnter,".property-listing",this);
this._listContainerNode.delegate("mouseleave",this._onPropertyListingMouseLeave,".property-listing",this);
}this._publishedEvents=[];this._eventHandlers=[];this._publishedEvents.push(h.publish("searchMain:showListLoadingMessage"),h.publish("searchMain:hideListLoadingMessage"));
this._hookMapListScroll();this._eventHandlers.push([h.Global.on("favoriteManager:updateNoteSuccess",this._onUpdateNote,this)]);
h.on("priorityUiReady",this._onSearchPriorityReady,this);},_onSearchPriorityReady:function(){if(h.config.instantHDP){h.use(["z-tmpl-hdp-hdp-address-summary","z-tmpl-hdp-hdp-summary-defork","z-tmpl-hdp-photo-info-defork","z-tmpl-hdp-photo-thumbnails","z-tmpl-hdp-photo-info","z-tmpl-hdp-photo-carousel","z-tmpl-hdp-homeSummary","z-tmpl-hdp-propertyAddress","handlebars-base","handlebars-compiler"],h.bind(this._registerPartials,this));
}var j=h.StyleSheet("terseList_fav_icons");j.set(".terse-list-card-actions .image-control",{backgroundImage:"url(/static/images/hearts_Sprite.png)"});
var i=h.one("#list-results");if(i&&i.hasChildNodes()){this.highlightActiveListing();}},_registerPartials:function(){h.Handlebars.registerPartial("hdp-photo-info",h.Z.Template["hdp-photo-info"]);
h.Handlebars.registerPartial("hdp-photo-info-defork",h.Z.Template["hdp-photo-info-defork"]);h.Handlebars.registerPartial("hdp-photo-carousel",h.Z.Template["hdp-photo-carousel"]);
h.Handlebars.registerPartial("hdp-photo-thumbnails",h.Z.Template["hdp-photo-thumbnails"]);h.Handlebars.registerPartial("hdp-propertyAddress",h.Z.Template["hdp-propertyAddress"]);
h.Handlebars.registerPartial("hdp-homeSummary",h.Z.Template["hdp-homeSummary"]);},setJsonData:function(k){var j,l;
if(k&&(k.length)){if(k.length>1){for(j=0;j<k.length;j++){if(k[j].zpid){l=k[j].zpid;this._bubbleDataList[l]=k[j];
this._homeInfoJsonData[l]=k[j];}}}this._setMustacheCss(k[0]);}},_setMustacheCss:function(i){this._mustacheCss=i.ComboStyleSheet;
},getMustacheCss:function(){return this._mustacheCss;},setCurrentZpid:function(i){this._currentZpid=i;
},populateHdpTemplate:function(j){var i;if(this._currentZpid){if(this._homeInfoJsonData[this._currentZpid]){if(h.config.searchAppMode=="dejavu"){i=h.Z.Template["hdp-hdp-summary-defork"];
}else{i=h.Z.Template["hdp-hdp-address-summary"];}this._setSearchAppMode((h.config.searchAppMode==="dejavu"),(h.config.searchAppMode==="hotelCalifornia"),(h.config.searchAppMode==="slidingSearchColumn"));
this._setDynamicHomeJson(this._homeInfoJsonData[this._currentZpid].hotelCaliforniaBucketOn,h.config.searchAppMode,this._homeInfoJsonData[this._currentZpid].isSinglePhoto);
this._homeInfoTemplateOutput[this._currentZpid]=i(this._homeInfoJsonData[this._currentZpid]);}}else{h.log("No valid zpid in node","debug","SearchMainList");
}},_setSearchAppMode:function(l,k,i,j){this._homeInfoJsonData[this._currentZpid].dejavu=l;this._homeInfoJsonData[this._currentZpid].hotelCalifornia=k;
this._homeInfoJsonData[this._currentZpid].slidingSearchColumn=i;if(this._homeInfoJsonData[this._currentZpid].homeSummary){this._homeInfoJsonData[this._currentZpid].homeSummary.dejavu=l;
this._homeInfoJsonData[this._currentZpid].homeSummary.hotelCalifornia=k;this._homeInfoJsonData[this._currentZpid].homeSummary.slidingSearchColumn=i;
}},_setDynamicHomeJson:function(l,k,j){var i;if(l&&(k==="dejavu")){i=this._homeInfoJsonData[this._currentZpid].tabCount;
if(this._homeInfoJsonData[this._currentZpid].hasImages){this._homeInfoJsonData[this._currentZpid].tabCount=4;
}else{this._homeInfoJsonData[this._currentZpid].tabCount=3;}this._homeInfoJsonData[this._currentZpid].Search_link="View larger map";
}if(l&&(k==="slidingSearchColumn")){i=this._homeInfoJsonData[this._currentZpid].tabCount;if(this._homeInfoJsonData[this._currentZpid].hasImages){this._homeInfoJsonData[this._currentZpid].tabCount=4;
}else{this._homeInfoJsonData[this._currentZpid].tabCount=3;}this._homeInfoJsonData[this._currentZpid].Search_link="View larger map";
}this._homeInfoJsonData[this._currentZpid].showDejaVuThumbnails=false;this._homeInfoJsonData[this._currentZpid].homeSummary.hasBedBathSqft=true;
},getHomeFactsTemplateData:function(){if(this._currentZpid){return this._homeInfoTemplateOutput[this._currentZpid];
}else{return null;}},getIsFSBA:function(){if(this._currentZpid&&this._homeInfoJsonData[this._currentZpid]){return this._homeInfoJsonData[this._currentZpid].isFSBA;
}else{return false;}},getIsInstantHDPFeatureOn:function(){return this._homeInfoJsonData[this._currentZpid].isInstantHDPFeatureOn;
},hasImages:function(){if(this._currentZpid){return this._homeInfoJsonData[this._currentZpid].ImageId;
}else{return null;}},destructor:function(){var j;for(j=0;j<this._publishedEvents.length;++j){this._publishedEvents[j].detachAll();
}this._publishedEvents=[];for(j=0;j<this._eventHandlers.length;++j){this._eventHandlers[j].detachAll();
}this._eventHandlers=[];if(this._staticMap){this._staticMap.destroy();this._staticMap=null;}},_onPropertyListingClick:function(o){var l,i,k=o.target.ancestor("div",true),n=o.target.ancestor("article",true),q=o.target.ancestor("table",true),r=h.Z.SearchMain.getSearchPageGACategory(),m="zsg-tooltip-launch",j=false,s,p=false;
h.config.isMapPropertyClick=false;if(o.target.hasClass("z-expand-async-link")||o.target.hasClass("z-contract-link")){return;
}if(o.target.ancestor(".list-card-actions",true)){return;}s=o.target.ancestor("a.edit-note, form",true!==null);
if(s){this._handleEditNote(o,n);}else{if(this._hotelCaliforniaApp){p=this._resultListHotelCaliforniaPropertyChange(o,{cacheData:true});
this._resultListMiniBubblePopper(o.currentTarget,{cacheData:true});o.target.addClass("viewed");h.fire("mapList:saveScroll");
}}if(!s&&!p&&o.target.ancestor("a",true)===null&&!o.target.hasClass(m)){l=o.target.ancestor(".building-unit-row",true,".property-listing")||o.target.ancestor(".grouped-result",true,".property-listing");
if(l){i=l.one(".hdp-link");}if(!i){i=o.currentTarget.one(".bdp-link")||o.currentTarget.one(".hdp-link");
}if(i){i.simulate("click");j=true;}}if(!s&&!j&&this._hotelCaliforniaApp){h.Z.Analytics.trackEvent({category:r,action:"HDP Click",label:this._hotelCaliforniaApp.get("isThreeColumnMode")?"Magic Carpet":"Map List"});
}if(h.config.instantHDP){this.setCurrentZpid(o.currentTarget.get("id").split("_").pop());if(this.getIsFSBA()){h.config.isFSBA=true;
}else{h.config.isFSBA=false;}this.populateHdpTemplate();}},_onUpdateNote:function(p,k){var n,i,m,o,j,l;
n=h.one("#list-results #search-results article#zpid_"+p);if(!n){h.log("No article found for zpid "+p,f,a);
return;}i=n.one(".property-favorite-data");if(!i){return;}m=i.one(".note");o=i.one("textarea");j=i.one("a.edit-note");
l=i.one(".delete-note");k=h.Lang.trim(k);j.set("text",k?"Edit note":"Add note");j.setAttribute("data-za-action",k?"Edit Note":"Add Note");
this._hideFavoriteNoteForm(i,function(){m.setHTML(k?'"'+k+'"':k);o.set("value",k);if(k){l.show();}else{l.hide();
}});},_handleEditNote:function(l,k){var n,i,j,m;j=l.target.ancestor(".property-favorite-data");if(l.target===j.one("a.edit-note")){j.one("a.edit-note").addClass("transparent");
j.one("form").transition({maxHeight:"125px"},function(){var p=j.one("textarea"),o=p.get("value");p.focus();
p.set("value","");p.set("value",o);});}else{if(l.target.test("a.delete-note, button.save-note")){if(!k){h.log("Favorite node is not found",f,a);
return;}n=k.getAttribute("id").substr(5);m=j.one("textarea");if(l.target.test("button.save-note")){i=h.Lang.trim(m.get("value"));
}else{i="";}h.Global.fire("favoriteManager:updateNote",{zpid:n,note:i});}}},_hideFavoriteNoteForm:function(i,j){i.one("a.edit-note").removeClass("transparent");
i.one("form").transition({maxHeight:0},j);},_onPropertyListingMouseEnter:function(i){this._resultListMiniBubblePopper(i.currentTarget);
},_onPropertyListingMouseLeave:function(j){var i=this._map?this._map.getMapManager():null;if(i){i.selection.setHoveredItem();
}},_resultListHotelCaliforniaPropertyChange:function(o,k){var j=false;try{var m=o.currentTarget.one(".routable"),n=o.target.hasClass("yui3-tooltip-trigger")||o.target.get("tagName")==="A"||o.target.ancestor("a")||o.target.ancestor(".grouped-result",true,".property-listing")||o.target.ancestor(".builder-community",true,".property-listing"),i;
if(!n&&m){i=m.get("href");h.log("resultListHotelCaliforniaPropertyChange "+i,b,a);j=this._hotelCaliforniaApp.navigate(i);
}}catch(l){h.log("error in resultListHotelCaliforniaPropertyChange: "+l.message,e,a);}return j;},_resultListMiniBubblePopper:function(i,p){var k,q,l=null,m,r=false,n=this._map?this._map.getMapManager():null;
if(!n){return;}try{if(p&&p.cacheData){r=p.cacheData;}k=this._getBubbleDataFromNode(i);q=i.one(".minibubble");
if(q){m=q.get("hiddenBlock");if(m){l=h.JSON.parse(m);}}k.zpid=k.zpid.replace("-terse","");var j={propertyId:k.zpid,latitude:Number(k.latitude),longitude:Number(k.longitude),type:l.miniBubbleType,data:l};
if(r){n.selection.setSelectedItem(k.zpid,"propertyMarker",{miniBubble:j,loc:{longitude:k.longitude,latitude:k.latitude}});
}else{n.selection.setHoveredItem(k.zpid,"propertyMarker",{miniBubble:j,loc:{longitude:k.longitude,latitude:k.latitude}});
}}catch(o){h.log("error in resultListMiniBubblePopper: "+o.message,e,a);}},openSelectedPropertyMiniBubble:function(){var i=this._listContainerNode.one(".selected-listing .property-listing");
this._resultListMiniBubblePopper(i);},_getBubbleDataFromNode:function(i){var j={};j.zpid=i.get("id").split("_").pop();
j.type=i.getAttribute("statusType");j.latitude=i.getAttribute("latitude");j.longitude=i.getAttribute("longitude");
j.building=i.hasClass("property-listing-building")?true:false;return j;},showMapResultCountMessage:function(){var i=h.one(this._mrcmDiv);
if(i){i.show();}this._mapResultCountDisplayed=true;},hideMapResultCountMessage:function(){var i=h.one(this._mrcmDiv);
if(i){i.hide();}this._mapResultCountDisplayed=false;},showListLoadingMessage:function(){h.all("#inner-list-container").addClass("list-loading");
h.fire("searchMain:showListLoadingMessage");},hideListLoadingMessage:function(){h.all("#inner-list-container.list-loading").removeClass("list-loading");
h.fire("searchMain:hideListLoadingMessage");},updateSearchInfoMessage:function(i,j){if(this._staticMap){var k={};
if(h.Lang.isString(i)){k.disambigContent=i;}if(h.Lang.isString(j)){k.keywordContent=j;}this._staticMap.fire("msg:update",{msgType:"disambigMsg",updateAttrs:k});
}},_hookMapListScroll:function(){this._eventHandlers.push(h.on("mapList:saveScroll",this._onMapListScroll,this),h.on("mapList:restoreScroll",this._onMapListScroll,this));
},_onMapListScroll:function(i){if(i){i.url=g.SearchMain.getPageLink();}},highlightActiveListing:function(){var k=g.SearchMain.getResurrectionPageState().getDisplayState().getZpid(),n=g.SearchMain.getResurrectionPageState().getEnrollmentId();
var p="#list-results article#zpid_"+k,q=100,o;if(!n||!k){return;}var m=h.one("#terse-search-results");
if(m&&m.getStyle("display")!=="none"){p+="-terse";}o=this._listContainerNode.one(p);if(!o){return;}o.addClass("active-listing");
var i=h.one("#list-container-column");var j=0;var l=o;while(i.contains(l)){j+=l.get("offsetTop");l=l.get("offsetParent");
}j-=q;i.set("scrollTop",j);}});},"3.3.0",{optional:["z-tmpl-hdp-hdp-address-summary","z-tmpl-hdp-hdp-summary-defork","z-tmpl-hdp-photo-info-defork","z-tmpl-hdp-photo-thumbnails","z-tmpl-hdp-photo-info","z-tmpl-hdp-photo-carousel","z-tmpl-hdp-homeSummary","z-tmpl-hdp-propertyAddress","handlebars-base","handlebars-compiler"],requires:["z-msg-view","z-plugin-msg-mgr","zsg-notification-bar-dismiss","stylesheet"]});

YUI.add("map-state",function(c){var b=c.namespace("Z");function a(d){if(d.zoomLevel){d.zoomLevel=Number(d.zoomLevel);
}this.boundingRect=d.boundingRect;this.zoomLevel=d.zoomLevel;this.orientation=d.orientation;this.mapModeType=d.mapModeType;
this.selectionBoundingRect=d.selectionBoundingRect;this.mapResultsMode=d.mapResultsMode;}a.prototype={getBoundingRect:function(){return this.boundingRect;
},getZoomLevel:function(){return this.zoomLevel;},getOrientation:function(){return this.orientation;},getMapModeType:function(){return this.mapModeType;
},getSelectionBoundingRect:function(){return this.selectionBoundingRect;},getMapResultsMode:function(){return this.mapResultsMode;
},setBoundingRect:function(d){this.boundingRect=d;},setZoomLevel:function(d){this.zoomLevel=((d!=null)?Number(d):null);
},setOrientation:function(d){this.orientation=d;},setMapModeType:function(d){this.mapModeType=d;},setSelectionBoundingRect:function(d){this.selectionBoundingRect=d;
},setMapResultsMode:function(d){this.mapResultsMode=d;}};a.toString=function(d){if(d){var e="";e+="rect:"+b.LatLngBounds.toString(d.getBoundingRect());
e+=" z:"+(d.getZoomLevel()?d.getZoomLevel():"null");e+=" mode:"+(d.getMapModeType()?d.getMapModeType():"null");
e+=" o:"+(d.getOrientation()?d.getOrientation():"null");e+=" resultsMode:"+(d.getMapResultsMode()?d.getMapResultsMode():"null");
return e;}return"null";};a.createBlankMapState=function(){return new a({mapResultsMode:b.MapConstants.MapResultsMode.Default});
};a.createMapState=function(f,i,e,h,d,g){return new a({boundingRect:f,zoomLevel:i,orientation:e,mapModeType:h,selectionBoundingRect:d,mapResultsMode:g});
};a.createMapStateFromJson=function(e){var f,d;if(e.boundingRect){d=e.boundingRect.sw;f=e.boundingRect.ne;
e.boundingRect=new b.LatLngBounds(b.LatLong.createFromDegrees(d.lat,d.lon),b.LatLong.createFromDegrees(f.lat,f.lon));
}if(e.selectionBoundingRect){d=e.selectionBoundingRect.sw;f=e.selectionBoundingRect.ne;e.selectionBoundingRect=new b.LatLngBounds(b.LatLong.createFromDegrees(d.lat,d.lon),b.LatLong.createFromDegrees(f.lat,f.lon));
}e.orientation=c.Object.getValue(b,e.orientation.split("."));e.mapModeType=c.Object.getValue(b,e.mapModeType.split("."));
e.mapResultsMode=c.Object.getValue(b,e.mapResultsMode.split("."));return new a(e);};a.calculateZoomForBounds=function(m,t,p){if(m&&t&&p){var j=b.VETiles,l=j.LongitudeToPixelX,g=j.LatitudeToPixelY,f=function(A,x,w){var y=l(A,w),z=l(x,w);
return Math.round(y)-Math.round(z);},q=function(z,x,w){var y=g(z,w),A=g(x,w);return Math.round(A)-Math.round(y);
};var k=t.getNorthEast(),r=t.getSouthWest(),e=f(k.getMillionthsLongitude(),r.getMillionthsLongitude(),p),i=q(k.getMillionthsLatitude(),r.getMillionthsLatitude(),p);
var d=m.getNorthEast(),v=d.getMillionthsLatitude(),u=d.getMillionthsLongitude(),h=m.getSouthWest(),s=h.getMillionthsLatitude(),o=h.getMillionthsLongitude(),n=18;
while((n>3&&f(u,o,n)>e)||q(v,s,n)>i){n--;}return n;}return null;};b.MapState=a;},"3.3.0",{requires:["z-map-constants","z-map-vetiles","z-map-lat-lon","z-map-lat-lng-bounds"]});

YUI.add("iterable-bubble-result",function(e){function c(i,h){var g="";if(h){g='<div class="map-bubble_iterable">'+i+"</div>";
}else{g='<tr><td colspan="5">'+i+"</td></tr>";}return g;}function b(h){try{if(h){var g=e.Node.create("<div/>");
g.setHTML(h);if(g){var i=g.all("a.mc-map-view");if(i){i.each(function(l){var k=l.getAttribute("href");
if(k.indexOf("?view=map")===-1){l.setAttribute("href",k+"?view=map");}});}}return g.getHTML();}}catch(j){e.log("error appending view=map","error",j);
}return h;}function d(g){this.zpid=g.zpid;this.html=b(g.html);this.detailPageUrl=g.url;this.isIterable=false;
}d.prototype={getZpid:function(){return this.zpid;},getHTML:function(){return this.html;},getDetailPageUrl:function(){return this.detailPageUrl;
},setHTML:function(g){this.html=b(g);},setIsIterable:function(g){this.isIterable=g;}};d.LOADING_RESULT=new d(-1,c("Loading more properties...",this.isIterable),null);
d.LOADING_RESULT_FAILED=new d(-1,c("Loading results failed.",this.isIterable),null);d.NO_MATCHES=new d(-1,c("No matching results.",this.isIterable),null);
function a(g){this.pageNumber=g.pageNum;this.pageSize=g.pageSize;this.resultCount=g.resultCt;this.resultList=null;
if(g.resultList){this.resultList=[];e.Array.each(g.resultList,function(h){if(h){try{this.resultList.push(new d(h));
}catch(i){e.log("Unable to create IterableBubbleResult","warn","IterableBubbleResultsPage");}}},this);
}}a.prototype={getPageNumber:function(){return this.pageNumber;},getPageSize:function(){return this.pageSize;
},getResultList:function(){return this.resultList;},getResultCount:function(){return this.resultCount;
}};var f=e.namespace("Z");f.IterableBubbleResult=d;f.IterableBubbleResultsPage=a;},"3.3.0",{});
YUI.add("building-bubble",function(d){var a="BuildingBubbleRequest",g="IterableBuildingPageRequest",j="warn",c=d.namespace("Z"),b=5,e=10;
function i(l){this.mapBubbleObject=undefined;this.latLong=c.LatLong.createFromDegrees(l.lat,l.lon);this.resultCount=l.ct;
this.bubbleHTML=l.html;this.parameterized=l.parameterized;if(l.bubbleType=="iterable"){this.pageSize=e;
this.isIterable=true;}else{this.pageSize=b;this.isIterable=false;}this.loadedPages={};if(l.firstPage){try{this.loadedPages[1]=new c.IterableBubbleResultsPage(l.firstPage);
}catch(m){d.log("Unable to create IterableBubbleResultsPage",j,"BuildingBubble");}}this.requestedPages={};
this.currentResultIndex=0;this.initialPageLoad=true;}i.prototype={getMapBubbleObject:function(){return this.mapBubbleObject;
},setMapBubbleObject:function(l){this.mapBubbleObject=l;},getLocation:function(){return this.latLong;
},getPageSize:function(){return this.pageSize;},getResultCount:function(){return this.resultCount;},setResultCount:function(l){this.resultCount=l;
},getResultsPage:function(l){return this.loadedPages[l];},getLatitude:function(){return this.latLong.getMillionthsLatitude();
},getLongitude:function(){return this.latLong.getMillionthsLongitude();},requestPage:function(l){if(typeof this.loadedPages[l]==="undefined"&&typeof this.requestedPages[l]==="undefined"){this.requestedPages[l]=true;
var m=new h(this,l,this.parameterized,this.pageSize,this.isIterable);m.submitRequest();}},onPageLoad:function(l,n){delete this.requestedPages[l];
this.loadedPages[l]=n;this.setDisplayResult();if(!this.getResultCount()){var m=0;if(n){m=n.getResultCount();
}this.setResultCount(m);if(m===0){this.setBubbleResult(c.IterableBubbleResult.NO_MATCHES);}this.updateResultCount();
}},onPageLoadFailure:function(l){delete this.requestedPages[l];},draw:function(l,m){this.mapBubbleObject.displayContents(this.bubbleHTML,l,m);
this.setDisplayResult();},setBubbleResult:function(n,o){var l,m;n.setIsIterable(this.isIterable);if(this.isIterable){l=this.mapBubbleObject.getContentDivElement();
m=l.one("#result-number");if(m){m.setContent(this.currentResultIndex+1);}o=l.one("#building-bubble-contents");
if(o){o.setContent(n.getHTML());}if(o.one("#property-special-offer")){o.ancestor(".search-result").addClass("has-offer");
d.one("#building-bubble-beak").addClass("has-offer");}else{o.ancestor(".search-result").removeClass("has-offer");
d.one("#building-bubble-beak").removeClass("has-offer");}}else{if(!o){l=this.mapBubbleObject.getContentDivElement();
o=l.one("#building-bubble-contents");}if(o){o.setContent(n.getHTML());}}this.mapBubbleObject.refresh();
this.mapBubbleObject.updatePosition(undefined,undefined);},updateResultCount:function(){var l=this.mapBubbleObject.getContentDivElement().one("#result-count");
if(l){l.setContent(this.resultCount||"");}},onClickNext:function(m,l){if(this.resultCount&&this.currentResultIndex<this.resultCount-1){this.currentResultIndex++;
this.setDisplayResult();}if(!this.resultCount||this.currentResultIndex>=this.resultCount-1){l.replaceClass("on","off");
}if(this.currentResultIndex>=1){m.replaceClass("off","on");}},onClickPrev:function(m,l){if(this.currentResultIndex>0){this.currentResultIndex--;
this.setDisplayResult();m.replaceClass("off","on");}if(this.currentResultIndex<=0){m.replaceClass("on","off");
}if(this.currentResultIndex<this.resultCount-1){l.replaceClass("off","on");}},setDisplayResult:function(){var m=Math.floor(this.currentResultIndex/this.pageSize)+1,q=this.getResultsPage(m),p,l="";
p=c.IterableBubbleResult.LOADING_RESULT;if(q===undefined){this.requestPage(m);}else{if(this.resultCount===null){this.resultCount=15;
}for(var o=this.currentResultIndex;o<this.resultCount&&o<this.pageSize;o++){if(q.getResultList()[o]){l+=q.getResultList()[o].getHTML();
this.currentResultIndex++;}}if(l){var r=q.getResultList()[this.currentResultIndex-1];r.setHTML(l);p=r;
}else{p=c.IterableBubbleResult.LOADING_RESULT_FAILED;}}if(!this.initialPageLoad){var n=this.mapBubbleObject.getContentDivElement().one("#more-building-bubble-contents");
this.setBubbleResult(p,n);}else{this.setBubbleResult(p);}}};function h(p,m,n,l,o){this.buildingBubble=p;
this.pageNumber=m;this.parameterized=n;this.timeout=10000;this.pageSize=l;this.isIterable=o;}h.prototype={submitRequest:function(){var l=this.createRequestUrl();
if(l){d.io(l,{on:this,context:this,timeout:this.timeout});}},createRequestUrl:function(){var m;var l=this.isIterable?"1":"0";
if(this.parameterized===true&&d.Z.FilterManager){var n=c.FilterManager.getUserFilterState();m="/search/bubble/GetBuildingBubblePage.htm?"+n.toUrlString()+"&";
}else{m="/search/bubble/GetSimpleBuildingBubblePage.htm?";}m+="p="+this.pageNumber;m+="&lat="+this.buildingBubble.getLocation().getMillionthsLatitude();
m+="&lon="+this.buildingBubble.getLocation().getMillionthsLongitude();m+="&ps="+this.pageSize;m+="&iter="+l;
return m;},success:function(p,n){var l=this._parse(n);if(!l){this.buildingBubble.onPageLoadFailure(this.pageNumber);
return;}var m=this._generatePage(l);this.buildingBubble.onPageLoad(this.pageNumber,m);},failure:function(m,l){this.buildingBubble.onPageLoadFailure(this.pageNumber);
},_parse:function(l){try{return d.JSON.parse(l.responseText);}catch(m){d.log("Cannot parse json response",j,g);
}return null;},_generatePage:function(l){if(l){try{return new c.IterableBubbleResultsPage(l);}catch(m){d.log("Cannot generate page from config",j,g);
}}return null;}};function f(o,n,m){var l;if(o){l="/search/bubble/GetBuildingBubble.htm?"+o.toUrlString()+"&";
}else{l="/search/bubble/GetSimpleBuildingBubble.htm?";}l+="lat="+n;l+="&lon="+m;return l;}function k(m,o,p,n,l){this.bubbleManager=m;
this.requestId=o;this.latitude=p;this.longitude=n;this.parameterized=l;this.timeout=10000;}k.prototype={submitRequest:function(){var l;
if(this.parameterized===true&&c.FilterManager){l=c.FilterManager.getUserFilterState();}d.io(f(l,this.latitude,this.longitude),{on:this,context:this,timeout:this.timeout});
},success:function(p,n){var m=this._parse(n),l;if(!m){return;}l=this._generateBubble(m);this.bubbleManager.onBuildingBubbleLoad(l,c.LatLong.createFromMillionths(this.latitude,this.longitude));
},failure:function(m,l){},_parse:function(l){try{return d.JSON.parse(l.responseText);}catch(m){d.log("Cannot parse json response",j,a);
}return null;},_generateBubble:function(l){if(l){try{return new i(l);}catch(m){d.log("Cannot generate bubble from config",j,a);
}}return null;}};c.BuildingBubbleRequest=k;c.BuildingBubble=i;},"3.3.0",{optional:["zillow-filter-manager"],requires:["node-base","event-base","io-base","iterable-bubble-result","z-map-lat-lon","json-parse"]});

YUI.add("z-plugin-comm-bubble",function(c){var a="CommBubble",b="debug";c.namespace("Z.Plugin")[a]=c.Base.create("commBubble",c.Plugin.Base,[],{initializer:function(){c.log("initializer",b,a);
this._prepareUI();this._attachHandlers();this._repositionBeak();},destructor:function(){c.log("destructor",b,a);
},_prepareUI:function(){var d=this.get("host"),f=d.all(this.get("listSelector")),e=d.one(this.get("linkContainerSelector"));
if(f.size()<=this.get("listSize")&&e){e.addClass("hide");}else{for(var g=3;g<f.size();g++){f.item(g).addClass("hide");
}}},_attachHandlers:function(){var d=this.get("host");d.delegate("click",this._onSeeAll,this.get("linkSelector"),this);
},_onSeeAll:function(){var d=this.get("host"),f=d.all(this.get("listSelector")),e=d.one(this.get("linkContainerSelector"));
f.removeClass("hide");if(e){e.addClass("hide");}},_repositionBeak:function(){var d=c.one(this.get("bubbleSelector")),e=d.get("offsetHeight"),f=c.one(this.get("beakSelector"));
if(!f.hasClass("map-bubble_below")){f.setStyle("top",(e-1)+"px");}}},{NS:"commBubble",ATTRS:{listSelector:{value:".plan"},linkContainerSelector:{value:"#more-community-bubble-contents"},linkSelector:{value:"#more-community-bubble-contents .more-plans"},listSize:{value:3},bubbleSelector:{value:".community-bubble"},beakSelector:{value:".map-bubble-beak"}}});
},"1.0.0",{requires:["plugin","base-build","node-pluginhost"]});
YUI.add("community-bubble",function(f){var h=f.namespace("Z"),d="warn",a="CommunityBubbleRequest";function g(i){this.mapBubbleObject=undefined;
this.regionId=i.regionId;this.regionType=i.regionType;this.latLong=h.LatLong.createFromDegrees(i.lat,i.lon);
this.resultCount=i.ct;this.bubbleHTML=b(i.html);this.initialHTML=b(i.initialHtml);this.fullHTML=b(i.fullHtml);
this.parameterized=i.parameterized;}g.prototype={getMapBubbleObject:function(){return this.mapBubbleObject;
},setMapBubbleObject:function(i){this.mapBubbleObject=i;},getRegionId:function(){return this.regionId;
},getRegionType:function(){return this.regionType;},getLocation:function(){return this.latLong;},getResultCount:function(){return this.resultCount;
},setResultCount:function(i){this.resultCount=i;},getLatitude:function(){return this.latLong.getMillionthsLatitude();
},getLongitude:function(){return this.latLong.getMillionthsLongitude();},draw:function(j,i){this.mapBubbleObject.displayContents(this.bubbleHTML,j,i);
this.setDisplayResult();},setBubbleResult:function(j){j=b(j);var l=this.mapBubbleObject.getContentDivElement().one("#community-bubble-contents");
if(l){l.set("innerHTML",j);var k=100;var i=l.one(".plan");if(i){k=i.get("offsetWidth");}this.mapBubbleObject.setCommunityBubbleWidth(k);
}this.mapBubbleObject.refresh();this.mapBubbleObject.updatePosition(undefined,undefined);},updateResultCount:function(){var j=this.mapBubbleObject.getContentDivElement().one("#community-plan-count");
if(j){var i=f.Lang.isValue(this.resultCount)?this.resultCount:0;j.set("innerHTML",(i+" new home plans"));
}},setDisplayResult:function(){var i=this.initialHTML;this.setBubbleResult(i);},getFullHTML:function(){return this.fullHTML;
},updateFullHTML:function(i){var j=this.mapBubbleObject.getContentDivElement().one("#more-community-bubble-contents");
j.set("innerHTML",b(i));this.mapBubbleObject.refresh();}};function b(j){try{if(j){var i=f.Node.create("<div/>");
i.setHTML(j);if(i){var k=i.all("a.mc-map-view");if(k){k.each(function(n){var m=n.getAttribute("href");
if(m.indexOf("?view=map")===-1){n.setAttribute("href",m+"?view=map");}});}}return i.getHTML();}}catch(l){f.log("error appending view=map","error",l);
}return j;}function e(l,k,j){var i;if(l){i="/search/bubble/GetCommunityBubble.htm?"+l.toUrlString();}else{i="/search/bubble/GetSimpleCommunityBubble.htm?";
}i+="&regionId="+k;i+="&full="+j;return i;}function c(l,m,o,k,j,i,n){this.bubbleManager=l;this.requestId=m;
this.regionId=o;this.clickLatLong=k;this.parameterized=j;this.full=i;this.currentBubble=n;this.timeout=10000;
}c.prototype={submitRequest:function(){var i;if(this.parameterized===true&&typeof h.FilterManager!=="undefined"){i=h.FilterManager.getUserFilterState();
}f.io(e(i,this.regionId,this.full),{on:this,context:this,timeout:this.timeout});},success:function(p,m){var j=this._parse(m),i;
if(!j){return;}i=this._generateBubble(j);if(this.full){this.currentBubble.updateFullHTML(i.getFullHTML());
}else{this.bubbleManager.onCommunityBubbleLoad(i,this.clickLatLong);var n=this.bubbleManager;var k=f.one("#community-bubble-contents-wrapper");
if(k){k.once("scroll",function(o){n.requestFullCommunityBubble(this);},i);}}var l=f.one(".community-bubble");
if(l){l.plug(f.Z.Plugin.CommBubble);}},failure:function(j,i){},_parse:function(i){try{return f.JSON.parse(i.responseText);
}catch(j){f.log("Cannot parse json response",d,a);}return null;},_generateBubble:function(i){if(i){try{return new g(i);
}catch(j){f.log("Cannot generate bubble from config",d,a);}}return null;}};h[a]=c;h.CommunityBubble=g;
},"3.3.0",{optional:["zillow-filter-manager"],requires:["node-base","io-base","z-map-lat-lon","json-parse","z-plugin-comm-bubble"]});

YUI.add("property-bubble",function(e){var a="PropertyBubbleRequest",c="warn",g=e.namespace("Z");function b(h){this.mapBubbleObject=undefined;
this.zpid=h.zpid;this.location=g.LatLong.createFromDegrees(h.lat,h.lon);this.bubbleHTML=h.html;}b.prototype={getMapBubbleObject:function(){return this.mapBubbleObject;
},setMapBubbleObject:function(h){this.mapBubbleObject=h;},getLocation:function(){return this.location;
},draw:function(h,i){this.mapBubbleObject.displayContents(this.bubbleHTML,h,i);},getBubbleType:function(){return g.MapConstants.BubbleType.Property;
},getZpid:function(){return this.zpid;}};function d(m,i,l,j,k){var h="/search/bubble/GetPropertyBubble.htm?zpid="+m+"&type="+i;
if(l&&j){h+="&lat="+g.LatLong.millionthsToDegrees(l)+"&lon="+g.LatLong.millionthsToDegrees(j);}if(k){h+="&seid="+k;
}return h;}function f(i,k,m,h,j,l){this.bubbleManager=i;this.requestId=k;this.zpid=m;this.type=h;this.latLong=j;
this.subscriptionEnrollmentId=l;this.timeout=10000;}f.prototype={submitRequest:function(){var h=d(this.zpid,this.type,this.latLong.getMillionthsLatitude(),this.latLong.getMillionthsLongitude(),this.subscriptionEnrollmentId);
e.io(h,{on:this,context:this,timeout:this.timeout});},success:function(k,j){var i=this._parse(j),h;if(!i){return;
}h=this._generateBubble(i);this.bubbleManager.onPropertyBubbleLoad(h,this.latLong);},failure:function(i,h){},_parse:function(h){try{return e.JSON.parse(h.responseText);
}catch(i){e.log("Cannot parse json response",c,a);}return null;},_generateBubble:function(h){if(h){try{return new b(h);
}catch(i){e.log("Cannot generate bubble from config",c,a);}}return null;}};g[a]=f;g.PropertyBubble=b;
},"3.3.0",{optional:["search-ad-refresh"],requires:["z-map-lat-lon","json-parse"]});
YUI.add("zillow-resurrection-page-state",function(h){var a={PageStateString:"pageStateString",MapState:"mapState",DisplayState:"displayState",DisambigBlock:"disambig",MapStateMessageBlock:"mapStateMessage",Error:"error",MapObject:"mapObject",BubbleDataObject:"bubble",PageNumber:"pageNumber",SessionOrdinal:"sessionOrdinal",FilterStateObject:"filterState",BinCounts:"binCounts",CurrentSelection:"currentSelection",EnrollmentId:"enrollmentId",SortControl:"sortControl"};
var f=h.namespace("Z"),e={prop:f.PropertyBubble,building:f.BuildingBubble,community:f.CommunityBubble};
function g(i){if(i){this.obj=i;this.valid=true;}else{h.log("Failed to build valid ResurrectionPageState","error","ResurrectionPageState");
this.obj={};this.valid=false;}}g.createFromString=function(k){var i;try{i=h.JSON.parse(k);}catch(j){h.log("Failed to parse ResurrectionPageState string","error","ResurrectionPageState");
}return g.createFromJSON(i);};g.createFromJSON=function(k){var l;try{k.mapState=f.MapState.createMapStateFromJson(k.mapState);
k.displayMode=h.Object.getValue(f,k.displayMode.split("."));k.displayState=f.DisplayState.createFromJson(k.displayState);
k.binCounts=f.SearchBinCounts.createFromJson(k.binCounts);if(k.regionSelectionObject){if(k.regionSelectionObject.customRegionId){k.currentSelection=f.CustomRegionSelection.createFromSelectionObjectJson(k.regionSelectionObject);
}else{k.currentSelection=f.RegionSelection.createFromJson(k.regionSelectionObject);}}if(k.bubble){var i=k.bubble;
var j=e[i.type];if(j){k.bubble=new j(i);}}l=k;}catch(m){h.log("Failed to construct ResurrectionPageState from json","error","ResurrectionPageState");
}return new g(l);};g.prototype={isValid:function(){return this.valid;},getPageStateString:function(){return this.obj[a.PageStateString];
},getMapState:function(){return this.obj[a.MapState];},getDisplayState:function(){return this.obj[a.DisplayState];
},getDisambigBlock:function(){return this.obj[a.DisambigBlock];},getMapStateMessageBlock:function(){return this.obj[a.MapStateMessageBlock];
},getError:function(){return this.obj[a.Error];},getMapObject:function(){return this.obj[a.MapObject];
},getBubbleDataObject:function(){return this.obj[a.BubbleDataObject];},getPageNumber:function(){return this.obj[a.PageNumber];
},getSessionOrdinal:function(){return this.obj[a.SessionOrdinal];},getFilterStateObject:function(){return this.obj[a.FilterStateObject];
},getBinCounts:function(){return this.obj[a.BinCounts];},getCurrentSelection:function(){return this.obj[a.CurrentSelection];
},getEnrollmentId:function(){return this.obj[a.EnrollmentId];},getSortControl:function(){return this.obj[a.SortControl];
}};var c=(function(){var i;var k=0;function j(){k++;return k;}return{requestPageState:function(l){if(i&&i.isRequestActive()){i.cancelRequest();
}if(typeof l=="undefined"||l.length===0){window.setTimeout(function(){c.onResurrectionStateLoaded.fireEvent(c.loadInitialPageState(),true);
},1);}else{i=new d(this,j(),l);i.sendRequest();}},createPageStateFromJSON:function(l){return g.createFromJSON(l);
},getCurrentPageState:function(p){var o=a,l=[],m;try{if(p){l[o.PageStateString]=p.getURLString();l[o.MapState]=h.clone(p.getMapState());
l[o.DisplayState]=h.clone(p.getDisplayState());l[o.PageNumber]=p.getPageState().getPageNumber();l[o.SessionOrdinal]=p.getPageState().getSessionOrdinal();
l[o.FilterStateObject]=h.clone(p.getFilterManager().getUserFilterState().toJSONObject());l[o.BinCounts]=p.getFilterManager().getBinCounts();
l[o.CurrentSelection]=h.clone(p.getPageState().getCurrentSelection());l[o.EnrollmentId]=p.getDisplayState().getEnrollmentId();
l[o.SortControl]=h.clone(p.getDisplayState().getSort());m=l;}}catch(n){h.log("Failed to get current ResurrectionPageState ","error","ResurrectionPageState");
}return new g(m);},loadInitialPageState:function(){if(h.one("#resurrection-page-state")){return g.createFromString(h.one("#resurrection-page-state").get("hiddenBlock"));
}},loadInitialSavedSearchSelection:function(){var p=h.one("#saved-search-selection-state");if(p){var n=p.get("hiddenBlock");
try{var m=h.JSON.parse(n);if(m){return h.Z.SavedSearchSelection.createFromJson(m);}}catch(l){h.log("failed to parse json","error","ResurrectionPageStateManager");
h.log(n);}}return null;},onPageStateResponse:function(m){var l=g.createFromString(m);this.onResurrectionStateLoaded.fireEvent(l,false);
},onResurrectionStateLoaded:new f.Subscriber("onResurrectionStateLoaded")};})();function d(i,j,k){this.resurrectionPageStateManager=i;
this.requestId=j;this.pageStateString=k;this.connection=undefined;this.requestActive=false;}d.prototype=(function(){var i="/search/GetPageState.htm";
var j=60000;return{createRequestUrl:function(){return i+"?state="+this.pageStateString;},getRequestId:function(){return this.requestId;
},sendRequest:function(){var k=this.createRequestUrl();if(k){var l=new b(this,j);this.connection=h.io(k,{context:l,on:l});
this.requestActive=true;}},cancelRequest:function(){if(this.connection){this.requestActive=false;if(this.connection.isInProgress()){this.connection.abort();
}}},isRequestActive:function(){return this.requestActive;},handleSuccess:function(k){if(this.requestActive===true){if(k.responseText&&k.responseText.length>0){this.resurrectionPageStateManager.onPageStateResponse(k.responseText);
}else{this.handleFailure(k);}}this.requestActive=false;},handleFailure:function(k){this.requestActive=false;
}};})();function b(i,j){this.request=i;this.timeout=j;}b.prototype={success:function(j,i){this.request.handleSuccess(i);
},failure:function(j,i){this.request.handleFailure(i);}};f.ResurrectionPageStateManager=c;f.ResurrectionPageStateManager.ResurrectionPageStateField=a;
},"3.3.0",{requires:["legacy-subscriber","zillow-current-selection","json-parse","map-state","zillow-display-state","zillow-search-bin-counts","building-bubble","community-bubble","property-bubble"]});

YUI.add("zillow-map-search-history",function(c){var b=c.namespace("Z");function a(){a.superclass.constructor.apply(this,arguments);
}b.MapSearchHistory=c.extend(a,c.Base,{initializer:function(){this._historyManager=null;this._publishedEvents=[];
this._publishedEvents.push(c.publish("searchMain:setupHistoryManager",{emitFacade:true,defaultFn:c.bind(this._setupHistoryManager,this)}),c.publish("searchMain:updateUrl",{emitFacade:true,defaultFn:c.bind(function(f){var d=b.SearchMain.getURLString();
if(this._ignoreUpdateEvent){c.log("updateUrl","debug","SearchMain");this._historyManager.replaceFragment(d);
}else{this._historyManager.saveFragment(d);}this._ignoreUpdateEvent=false;},this)}),c.publish("searchMain:replaceNextUrl",{emitFacade:true,defaultFn:c.bind(function(d){c.log("ignoreNextUrl","debug","SearchMain");
this._ignoreUpdateEvent=true;},this)}),c.publish("searchMain:updateLastFragment",{emitFacade:true,defaultFn:c.bind(function(d){this._historyManager.updateLastFragment();
},this)}));},destructor:function(){var d=0;for(d=0;d<this._publishedEvents.length;++d){this._publishedEvents[d].detachAll();
}this._publishedEvents=[];this._setupHistoryManager({});},_setupHistoryManager:function(d){var f=d.app;
c.log("Setup historyManager","debug","SearchMain");if(this._historyManager){if(this._historyManager.detachLegacyHandler){c.log("Fallback HistoryManager already initialized, cleaning up","debug","SearchMain");
if(!f){c.log("HistoryManager already attached","warn","SearchMain");return;}this._historyManager.detachLegacyHandler();
this._historyManager=null;}else{if(!f){c.log("Reattaching Legacy HistoryManager is unsupported","error","SearchMain");
return;}c.log("Replacing app attribute of HistoryManager","debug","SearchMain");this._historyManager.set("app",f);
}}if(f){c.log("App param passed, using instanced HistoryManager","debug","SearchMain");this._historyManager=new b.HistoryManager({on:{"*:historyMgrNavigate":c.bind(function(g){this.onHistoryNavigation(g.url);
},this)},app:f});}else{c.log("No app param passed, using fallback HistoryManager","debug","SearchMain");
this._historyManager=b.HistoryManager;this._historyManager.initLegacyHandler();this._historyManager.onNavigation.subscribe(c.bind(this.onHistoryNavigation,this));
}},onHistoryNavigation:function(d){if(d&&d!==this._historyManager.initialFragment){b.ResurrectionPageStateManager.requestPageState(d);
}else{b.ResurrectionPageStateManager.requestPageState("");}b.SearchMain.clearRequestState();},getCurrentFragment:function(){return this._historyManager.getCurrentFragment();
},getInitialFragment:function(){return this._historyManager.initialFragment;}});},"3.3.0",{requires:["base-base","zillow-history-manager","zillow-resurrection-page-state"]});

YUI.add("z-storage",function(b){var j=b.Array,k=j.each,m=j.some,i=j.indexOf;function o(){this.initializer();
}var f=o.METADATA_KEY="Z_META_DB",c=o.PREFIX_MODULE="Z_MODULE_",h=o.PREFIX_DATA="Z_DATA_",d=o.TYPE_MODULE="modules",n=o.TYPE_DATA="data",a=o.MAX_SIZE=2000000,l=o.MAX_MODULE_SIZE=75000,g=o.MAX_DATA_SIZE=10000;
b.config.global.storagePerf={};o.prototype={_metadata:null,initializer:function(){this._metadata=new e();
},getModules:function(s){var q=[],t={},p=[],r=[],u;b.log("getModules() modules","debug","z-storage");
b.log(s);k(s,function(v){t[v.key]=v.version;q.push(v.key);});u=this._metadata.getModules(q);k(u,function(v){if(t[v.key]===v.version){p.push({key:v.key,version:v.version,size:v.size,value:localStorage.getItem(c+v.key)});
r.push(v.key);}else{b.log("Module "+v.key+" requested version "+t[v.key]+" but LS has version "+v.version,"debug","z-storage");
}});if(r.length){this._metadata.updateLastAccess(r);}return p;},getData:function(p){return localStorage.getItem(h+p);
},setData:function(r,s,p){var q=s.length;if(s.length>g){throw new Error("data exceeds size limit for LocalStorage.");
}this._purge(a-q);localStorage.setItem(h+r,s);this._metadata.setData(r,s.length,p);},saveModules:function(p){var q=0;
k(p,function(s,r){if(s.key===undefined||s.value===undefined||s.version===undefined){throw new Error("module doesn't have correct parameters.");
}else{if(s.value.length>l){b.log("Module exceeds max size, not storing: "+s.key,"warn","Storage");p.splice(r,1);
}else{q+=s.value.length;}}});this._purge(a-q);k(p,function(s,r){b.log("writing to localStorage: "+c+s.key+", "+s.version,"debug","Storage");
localStorage.setItem(c+s.key,s.value);p[r].size=s.value.length;});this._metadata.setModules(p);},getModuleMap:function(){return this._metadata.getMetadata(d);
},getStats:function(){return{modules:this._metadata._data.modules.length};},_purge:function(r){var q,p;
q=this._metadata.purgeData();k(q,function(s){localStorage.removeItem(h+s);});p=this._metadata.purgeModules(r);
k(p,function(s){localStorage.removeItem(c+s);});}};function e(){this.initializer();}e.prototype={_data:null,initializer:function(){if(!JSON||!JSON.parse){throw new Error("No native JSON support");
}var p=localStorage.getItem(f);this._data={modules:[],data:[],size:0};if(p){this._data=JSON.parse(p);
}},getModules:function(q){var p=this._getItems(d,q),r=[];k(p,function(s){r.push(s.key);});return p;},setModules:function(p,q){this._setItems(d,p);
},setData:function(r,q,p,s){this._setItems(n,[{key:r,size:q,expires:p}],s);},getMetadata:function(p){var q={};
k(this._data[p],function(r){q[r.key]={size:r.size};if(r.version){q[r.key].version=r.version;}});return q;
},removeModules:function(q,p){this._removeItems(d,q,p);},removeData:function(p,q){this._removeItems(n,[p],q);
},_getItems:function(q,p){var s=[],r;if(b.config.debug){r=p.slice(0);}m(this._data[q],function(u){var t=i(p,u.key);
if(t>-1){s.push(u);p.splice(t,1);}return p.length?false:true;});if(b.config.debug){k(r,function(t){if(i(p,t)>-1){b.log("_getItem NOT found: "+t,"debug","StorageMetadata");
}else{b.log("_getItem found: "+t,"debug","StorageMetadata");}});}return s;},_setItems:function(q,p,s){var r=[];
k(p,function(t){r.push(t.key);});this._removeItems(q,r,false);k(p,function(u){try{if(q===d){this._data[q].unshift({key:u.key,size:u.size,version:u.version});
}else{if(q===n){this._data[q].unshift({key:u.key,size:u.size,expires:u.expires});}}}catch(t){throw new Error("Error setting localStorage. Needs properties key, size, and version or expires.");
}},this);if(s!==false){this._data.size=this.getSize();this.save();}},updateLastAccess:function(r,u){var v=false,q=b.config.global,s=q.ClientProfiler,p=q.storagePerf,t=Date.now();
p.updateLastAccessNumber=p.updateLastAccessNumber||1;p.updateLastAccessTime=p.updateLastAccessTime||0;
m(this._data.modules,function(z,y){var x=i(r,z.key),w;if(x>-1){v=true;b.log("Putting "+z.key+" at top of metadata module stack.","debug","StorageMetadata");
w=this._data.modules.splice(y,1);this._data.modules.unshift(w[0]);r.unshift();}return r.length?false:true;
},this);if(v&&u!==false){this._data.size=this.getSize();this.save();}p.updateLastAccessTime+=Date.now()-t;
if(s){s.profile("localStorage updateLastAccessTime: "+p.updateLastAccessTime);b.log("localStorage updateLastAccessTime: "+p.updateLastAccessTime,"debug","z-storage");
}},_removeItems:function(p,r,q){k(r,function(t,s){m(this._data[p],function(u,v){if(t===u.key){this._data[p].splice(v,1);
return true;}},this);},this);if(q!==false){this._data.size=this.getSize();this.save();}},getSize:function(){var p=0;
k(this._data.modules,function(q){p+=q.size;});k(this._data.data,function(q){p+=q.size;});return p;},save:function(){return localStorage.setItem(f,JSON.stringify(this._data));
},purgeModules:function(v,s){var r=this._data.size,u=false,p=[],q,t;while(r>v){t=this._data.modules.length-1;
if(t<0){throw new Error("LocalStorage is full but no modules to purge. Is non-module data taking up all the storage?");
}q=this._data.modules[t];b.log("Purging module"+q.key,"debug","StorageMetadata");this.removeModules([q.key],false);
p.push(q.key);r-=q.size;u=true;}if(u&&s!==false){this._data.size=this.getSize();this.save();}return p;
},purgeData:function(p){var s=false,r=Date.now(),q=[];k(this._data[n],function(t){if(t.expires&&t.expires<r){this.removeData(t.key,false);
q.push(t.key);b.log("Purging data "+t.key,"debug","StorageMetadata");s=true;}},this);if(s&&p!==false){this._data.size=this.getSize();
this.save();}return q;}};b.namespace("Z");b.Z.Storage=o;b.Z.StorageMetadata=e;});
YUI.add("z-node-dataset",function(f){var e=f.Lang,d=e.dasherize=f.cached(function(g){return String(g).replace(/([a-z])([A-Z])/g,function(j,i,h){return i+"-"+h.toLowerCase();
});}),a=e.camelize=f.cached(function(g){return String(g).replace(/-([a-z])/gi,function(i,h){return h.toUpperCase();
});}),c=f.Node.DATASET_SUPPORTED=!!("dataset" in f.config.doc.createElement("div")),b;f.mix(f.Node.ATTRS,{dataset:{getter:function(){return this._getDataset();
}}});b={_getDataset:function(){var l={},k=this._node.attributes,g=k.length,m=0,n=this.DATA_PREFIX,j=n.length,h;
while(m<g){h=k[m].name;if(h.indexOf(n)===0){h=a(h.substr(j));if(!(h in l)){l[h]=this._getDatasetValue(h);
}}m+=1;}return l;},_getDatasetValue:function(i){var g=this.DATA_PREFIX+d(i),h=this._node.attributes,j=h&&h[g]&&h[g].value;
return j;},getDataAttribute:function(g){return this._getDatasetValue(g);},_setDatasetValue:function(h,i){var g=this.DATA_PREFIX+d(h);
if(e.isValue(i)){this.setAttribute(g,i);}else{this.removeAttribute(g);}},setDataAttribute:function(g,h){this._setDatasetValue(g,h);
return this;},setDataAttrs:function(g){if(e.isObject(g)){f.Object.each(g,function(i,h){this._setDatasetValue(h,i);
},this);}return this;}};if(c){f.mix(b,{_getDatasetValue:function(g){return this._node.dataset[a(g)];},_getDataset:function(){return f.merge(this._node.dataset);
}},true);}f.mix(f.Node.prototype,b);f.NodeList.importMethod(f.Node.prototype,["getDataAttribute","setDataAttribute","setDataAttrs"]);
},"3.4.1",{requires:["node-base"]});
YUI.add("z-plugin-search-mode-switch",function(b){var a="PluginSearchModeSwitch";b.namespace("Z")[a]=b.Base.create("pluginSearchModeSwitch",b.Plugin.Base,[],{_handles:{},initializer:function(){b.log("initializer","debug",a);
var c=this.get("host"),d=this.get("modeSelector");this._handles.local=[];this._handles.local.push(c.delegate("click",this._onModeClick,d,this));
},destructor:function(){b.Array.each(this._handles.local,function(c){c.detach();});this._handles.local=[];
},_updateActiveButton:function(e){var d=this.get("host"),c=this.get("activeClass"),f=this.get("btnClass");
d.all("."+f).removeClass(c);if(e){e.addClass(c);}},_showSearchMode:function(f){var d=window.location.host,e=window.location.protocol,g="",c="Search";
if(b.Z.SearchMain.getIsFavoriteView()){c="Followed Homes";g="&spt=savedhomes";}if(f.hasClass("map-mode")){b.Z.track({category:c,action:"Map-List Toolbar",label:"Map"});
window.location.href=e+"//"+d+"/search/SetSearchPageDisplayMode.htm?sudmt=Map"+g;}else{if(f.hasClass("list-mode")){b.Z.track({category:c,action:"Map-List Toolbar",label:"List"});
window.location.href=e+"//"+d+"/search/SetSearchPageDisplayMode.htm?sudmt=List"+g;}}},_onModeClick:function(f){var d=f.currentTarget,c=this.get("activeClass");
f.preventDefault();if(d.hasClass(c)){return;}this._updateActiveButton(d);this._showSearchMode(d);}},{NS:"searchModeSwitch",ATTRS:{modeSelector:{value:"button"},activeClass:{value:"active"},btnClass:{value:"btn"}}});
},"1.0.0",{requires:["plugin","base-build","node-pluginhost","zillow-link-tracking"]});
YUI.add("z-map-list-side-by-side",function(e){e.namespace("Z");var b="searchUrl",d="searchScrollPos",c="debug",a="MapListSideBySide";
e.Z.MapListSideBySide={sortList:null,modeButton:null,hasLocalStorage:e.cached(function(){try{var f=a;
localStorage.setItem(f,f);localStorage.removeItem(f);return true;}catch(g){return false;}}),sessionId:"",init:function(f){e.publish("mapList:saveScroll",{emitFacade:true,defaultFn:e.bind(this.saveScroll,this)});
e.publish("mapList:restoreScroll",{emitFacade:true,defaultFn:e.bind(this.restoreScroll,this)});e.publish("mapList:restoreScrollIgnoreUrl",{emitFacade:true,defaultFn:e.bind(this.restoreScroll,this,true)});
if(e.config.searchAppMode!=="slidingSearchColumn"){e.fire("mapList:restoreScroll");}e.on("searchMain:showListLoadingMessage",e.bind(this._onListLoadStart,this));
e.on("searchMain:hideListLoadingMessage",e.bind(this._onListLoadFinish,this));e.on("searchMain:layoutUpdate",e.bind(this._onSearchLayoutUpdate,this));
e.once("priorityUiReady",e.bind(this.ensureSortControl,this));this._onListLoadFinish();e.publish("mapListSideBySide:initialized",{fireOnce:true,});
e.fire("mapListSideBySide:initialized");},ensureSortControl:function(){e.use(["z-plugin-search-sort","transition"],e.bind(function(){this.sortList=e.one("#property-sort-control");
if(!this.sortList){return;}e.log("ensureSortControl",c,a);var g=this.sortList;var f=e.one("#property-sort-control-more-btn");
if(f&&g&&f.hasClass("hide")){g.appendChild(f.remove());f.transition({duration:0.6,opacity:1,on:{start:function(){this.setStyle("opacity",0);
this.show();},end:function(){this.setStyle("opacity",1);}}});}if(!this.sortList.hasPlugin("searchSort")){this.sortList.plug(e.Z.PluginSearchSort);
this.sortList.on("searchSort:change",this._onSearchSortChange,this);}},this));},SEARCH_URL:b,SEARCH_SCROLL_POS:d,_saveScroll:function(f){var g=this._listScrollTop();
if(typeof g==="number"){localStorage.setItem(d,g);localStorage.setItem(b,f);}},saveScroll:function(f){if(this.hasLocalStorage()){this._saveScroll(f&&f.url||f);
}},_listScrollTop:function(h){var g="#list-container-column";var f=e.one(g);if(f){if(e.Lang.isValue(h)){return f.set("scrollTop",h);
}else{return f.get("scrollTop");}}},_onSearchSortChange:function(h){if(!this.sortList){this.sortList=e.one("#property-sort-control");
if(!this.sortList){return;}}var g=this.sortList.one('[data-value="mostrecentchange"]'),f,i;SearchMain.setSort(h.value);
SearchMain.resetOldSortField();if(g){g.get("parentNode").remove();i=this.sortList.one('[data-value="featured"]').addClass("btn").get("parentNode");
f=this.sortList.one('[data-value="days"]').addClass("btn").get("parentNode");this.sortList.prepend(f);
this.sortList.prepend(i);}},_onListLoadStart:function(){this._listScrollTop(0);},_onListLoadFinish:function(){},_onSearchLayoutUpdate:function(g){var f=e.one("#showing-unmapped-message");
if(g.currentUserMode==="listOnly"&&f){f.addClass("hide");}},_restoreScroll:function(f,i){var h=parseInt(localStorage.getItem(d),10);
if(e.Lang.isNumber(h)){try{if(i||f===localStorage.getItem(b)){this._listScrollTop(h);}}catch(g){e.log("oops!","error",a);
e.log(g);}}localStorage.removeItem(d);localStorage.removeItem(b);},restoreScroll:function(f,g){if(this.hasLocalStorage()){e.config.win.SearchMain.getMapManagerPromise().then(e.bind(this._restoreScroll,this,f&&f.url,g));
}}};},"3.4.1",{optional:["deferred-iframe","z-plugin-search-sort","transition"],requires:["node-screen","yui-later","yui-throttle","zillow-link-tracking","z-node-dataset","z-plugin-search-mode-switch"]});

YUI.add("zillow-search-main",function(e){var c=e.namespace("Z"),a=e.config.win.ClientProfiler||{profile:function(){}};
function b(){b.superclass.constructor.apply(this,arguments);}e.ZSG.NotificationBarDismiss.init();c.MapAndListSearch=e.extend(b,e.Base,{initializer:function(){this._initMemberVariables();
this._publishEvents();this._hookEventListeners();this._mapSearchHistory=new c.MapSearchHistory();var f=e.one("body.cobranded #cobrand_header iframe");
if(f){e.one("#wrapper").setStyle("top",f.getAttribute("height")+"px");}},destructor:function(){var f;
for(f=0;f<this._publishedEvents.length;++f){this._publishedEvents[f].detachAll();}this._publishedEvents=[];
for(f=0;f<this._eventHandlers.length;++f){this._eventHandlers[f].detach();}this._eventHandlers=[];if(this._map){this._map.destroy();
this._map=null;}if(this._list){this._list.destroy();this._list=null;}if(this._mapSearchHistory){this._mapSearchHistory.destroy();
this._mapSearchHistory=null;}if(this.searchURLFactory){this.searchURLFactory.destory();this.searchURLFactory=null;
}},_handles:null,_initConfig:null,_isResponsiveModeDisabled:true,_hasShownDisambig:false,_maintainSelectionOnFilterChange:false,searchLayoutMgr:null,searchURLFactory:null,isAddonFilterChange:false,_initMemberVariables:function(){this._pageState=c.PageState.createBlankState();
this._displayState=c.DisplayState.createBlankState();this._mapManager=null;this._mapManagerPromise=null;
this._boundaryManager=null;this._bubbleManager=null;this._miniBubbleManager=null;this._hoverInfoLayer=null;
this._resultMgrList=null;this._displayingServerRenderedList=false;this._hasRequestedList=false;this._hasRequestedMap=false;
this._loadedPageStateInMapMode=false;this._isRentalOnlySearch=false;this._oldMixModeSortField=null;this._latestListSearchRectangle=null;
this._listContainerNode=e.one("#list-container");this._searchAnchorNode=e.one("#search-anchor");this._hotelCaliforniaApp=null;
this._handles={};this._initConfig=null;this._isResponsiveModeDisabled=true;this._hasShownDisambig=false;
this._maintainSelectionOnFilterChange=false;this.searchLayoutMgr=null;this.searchURLFactory=null;this.isAddonFilterChange=false;
this._publishedEvents=[];this._eventHandlers=[];},_publishEvents:function(){this._publishedEvents.push(e.Global.publish("searchMapEventHandler:onMapLoad",{broadcast:2,fireOnce:true,emitFacade:true}),e.Global.publish("searchMain:initializePage",{broadcast:2,fireOnce:true,emitFacade:true}),e.publish("searchMapEventHandler:onMapPan",{broadcast:2,emitFacade:true}),e.publish("searchMapEventHandler:onMapZoom",{broadcast:2,emitFacade:true}),e.publish("searchMain:layoutUpdate"),e.Global.publish("mapManager:initialized",{broadcast:2,fireOnce:true,emitFacade:true}),e.publish("searchMain:setListHTML"),e.Global.publish("searchMain:getResultsRequested",{broadcast:2,fireOnce:true,emitFacade:false}),e.publish("searchMain:afterListResultsLoaded"));
},_hookEventListeners:function(){this._eventHandlers.push(e.on("FilterManager:filterStateChanged",this.onFilterStateChanged,this));
},onMapLoad:function(g){var j,f=g.bounds,i=g.zoom,h=e.one("body").hasClass("fav-view");this._boundaryManager=new c.BoundaryManager({regionsEnabled:!h,spriteLayer:this._mapManager.findMapLayer("BoundaryLayer"),hoverLayer:this._mapManager.findMapLayer("HoverLayer"),mapManager:this._mapManager,regionSelection:this._mapManager.currentSelection,resultManager:this._resultMgrList,enablePicasso:true});
this._eventHandlers.push(this._boundaryManager.on("region:click",this.onRegionClick,this));this._pageState.setSearchRectangle(f);
this.doSearch(true,!this._initConfig.renderedBoundingRect);},clearSavedSearchState:function(f){if(this._displayState.getEnrollmentId()){this._displayState.setEnrollmentId(undefined);
this._displayState.setSort(f);e.one(document.body).removeClass("saved-search");c.SearchUIContent.updateSortByListToFeatured(f);
}},clearRequestState:function(){this._hasRequestedList=false;this._hasRequestedMap=false;},hasRequestedMap:function(){return this._hasRequestedMap;
},onFilterStateChanged:function(){this.clearSavedSearchState("featured");this._updateSearchInfoMessage("",undefined);
this._pageState.setPageNumber(1);if(this._mapManager&&!this._maintainSelectionOnFilterChange){this._mapManager.selection.setSelectedItem();
}var f=((e.Z.SearchFilters.ForSale.isChecked()||e.Z.SearchFilters.Premarket.isChecked()||e.Z.SearchFilters.RecentlySold.isChecked())?false:true);
if(!this._isRentalOnlySearch&&f){this._isRentalOnlySearch=true;this._oldMixModeSortField=this._displayState.getSort();
this._displayState.setSort("days");e.fire("searchSort:updateSortUI",{value:"days",featuredText:"Verified Source"});
}else{if(this._isRentalOnlySearch&&!f){this._isRentalOnlySearch=false;this._displayState.setSort(this._oldMixModeSortField);
e.fire("searchSort:updateSortUI",{value:this._oldMixModeSortField,featuredText:"Featured"});}}this.doSearch(true,!this.isAddonFilterChange);
this.isAddonFilterChange=false;},onMapPan:function(h){var g=h.bounds,f=true;if(c.BoundingRect.isValid(g)){this._pageState.setPageNumber(1);
this._pageState.setSearchRectangle(g);var i=e.one(document.activeElement);if(i&&i.test("#search-results input[type=text], #search-results textarea")){f=false;
}this.doSearch(true,f);e.fire("searchMapEventHandler:onMapPan");}},onMapZoomChanged:function(g){var f=g.bounds;
e.log("MAP ZOOM!");this._pageState.setPageNumber(1);this._pageState.setSearchRectangle(f);this.doSearch(true,true);
e.fire("searchMapEventHandler:onMapZoom");},setLoadedPageStateInMapMode:function(f){this._loadedPageStateInMapMode=f;
},doSearch:function(h,g){e.log("doSearch","info","SearchMain");var f=25;this._pendingMapSearch=this._pendingMapSearch||h;
this._pendingListSearch=this._pendingListSearch||g;this._resultMgrList.cancelRequest();if(!this._firstDoSearchComplete){this._doSearchImpl();
this._firstDoSearchComplete=true;}else{this.clearPendingSearch();this._pendingSearch=window.setTimeout(e.bind(this._doSearchImpl,this),f);
}},clearPendingSearch:function(){window.clearTimeout(this._pendingSearch);},_doSearchImpl:function(){window.clearTimeout(this._pendingSearch);
this._pendingSearch=null;var h=this._pendingMapSearch;var g=this._pendingListSearch;this._pendingMapSearch=false;
this._pendingListSearch=false;if(this._hotelCaliforniaApp&&this._hotelCaliforniaApp.get("appName")=="hotelCalifornia"&&this._hotelCaliforniaApp.getActiveView()){g=false;
e.Global.fire("searchListView:needListUpdate");}var f=!!this._firstDoSearchComplete&&((this._hasRequestedList&&!this._loadedPageStateInMapMode)||this._hasRequestedMap);
this.requestResults(h,g);if(h&&g){this._list.hideMapResultCountMessage();this._list.showListLoadingMessage();
this._hasRequestedList=true;this._hasRequestedMap=true;this._latestListSearchRectangle=this._pageState.getSearchRectangle();
}else{if(g){this._list.showListLoadingMessage();this._hasRequestedList=true;this._latestListSearchRectangle=this._pageState.getSearchRectangle();
}else{if(h){this._list.hideMapResultCountMessage();this._hasRequestedMap=true;}}}if(f){e.log("doSearch saving fragment","info","SearchMain");
e.fire("searchMain:updateUrl");}},updateElementEnabledStatus:function(i,h,j){var g;if(!i){return;}if(j){g=i.one(".results-mask");
}var f="disabled";if(h){i.removeClass(f);if(g){g.remove();}}else{i.addClass(f);if(j){if(!g){g=e.Node.create('<div class="results-mask" />');
}i.append(g);}}},onRegionClick:function(i){var k=i.regionId,h=i.clickLatLong;this.clearSavedSearchState("featured");
var g=this._pageState.getCurrentSelection();if(c.RegionSelection.isRegionSelection(g)&&k==g.getRegionId()){var j=this.getMapState().getZoomLevel();
if(j<18&&h){var f=j+1;if(g.getRegionType()==c.SearchConstants.RegionType.County){f=Math.max(f,9);}this._mapManager.setMapCenterAndZoom(h,f);
}}else{c.SelectionManager.requestSelectionChange(k,h);}},calculateMapResizeBounds:function(){return{width:undefined,height:undefined};
},updateLayerVisibility:function(f,g){if(f){if(g===false){f.hideLayer();}else{f.showLayer();}}},changePicassoState:function(f){this.updateElementEnabledStatus(this._listContainerNode,!f,true);
this.updateElementEnabledStatus(this._searchAnchorNode,!f,true);this._map.updateMarkerVisability(!f);
},requestResults:function(m,j){var f=[],g,p=false,l="/search/GetResults.htm",k="GET",i=this._getRequestParams(m,j),n=this._generatePostParams(),h=this.getPageState().getCurrentSelection(),q;
for(var o in i){if(i.hasOwnProperty(o)){g=i[o];if(g){if(p){f.push("&");}else{p=true;}f.push(o+"="+g);
}}}f=l+"?"+f.join("");if(n){k="POST";}else{n={};}this._resultMgrList.setAttrs({url:f,requestMethod:k,zoom:i.zoom,tiling:this._mapManager?this._mapManager.getMapProjection():undefined,mapType:i.disp});
n.isMapSearch=!!m;this._resultMgrList.load(n);e.fire("searchMain:getResultsRequested");},_generatePostParams:function(){var h=null,f=this.getPageState().getCurrentSelection(),g;
if(c.SavedSearchSelection.isSavedSearchSelection(f)||c.CustomRegionSelection.isCustomRegionSelection(f)){h={};
g=f.getCustomGeometry();if(g){h.clipPolygon=g.serializeToClipPolygon();}}return h;},_getRequestParams:function(m,j){m=m&&this._mapManager;
var i=c.FilterManager.getUserFilterState().toUrlObject(),l=this._mapManager.getMapState(),k=this._pageState.getCurrentSelection(),n=this._pageState.getSearchRectangle(),o,p,g;
if(l&&l.getZoomLevel()){p=l.getZoomLevel();i.zoom=p;}if(n){i.rect=n.toJSON().join(",");}i.p=this._pageState.getPageNumber();
if(this._pageState.getPageNumber()>1&&this._pageState.getSessionOrdinal()){i.ordinal=this._pageState.getSessionOrdinal();
}i.sort=this._displayState.getSort();if(this._displayState.getEnrollmentId()){i.sse=this._displayState.getEnrollmentId();
}if(this._displayState.getZpid()){i.zpid=this._displayState.getZpid();}var q="";if(j&&m){if(k&&k.getBoundingRect()&&c.LatLngBounds.isIntersected(k.getBoundingRect(),n)===false&&l&&l.getZoomLevel()<15&&i.spt!=="savedhomes"){q="maplistout";
}else{q="maplist";}}else{if(j){q="list";}else{if(m){q="map";}}}i.search=q;i.disp=this._displayState.getDisplayMode();
if(c.RegionSelection.isRegionSelection(k)){i.rid=k.getRegionId();i.rt=k.getRegionType();}else{if(c.SavedSearchSelection.isSavedSearchSelection(k)||c.CustomRegionSelection.isCustomRegionSelection(k)){var f=k.getCustomRegionId();
if(f&&f!==""){i.crid=f;}var h=k.getBoundingRect();i.selrect=h.toJSON().join(",");}}i.listright=true;i.responsivemode=null;
if(this._map){g=this._map.getAddonSearchParams();}e.Array.each(g,function(r){i[r.type[0]]=r.value;},this);
return i;},_getListModeRequestParams:function(){var h=this.searchLayoutMgr.get("currentListMode"),g=true,f=null;
if(h=="no-list"){f="noList";}else{if(h=="med-list"){f="defaultList";}else{if(h=="full-list"){if(this.searchLayoutMgr.get("currentUserMode")==="listOnly"){f="listOnly";
}else{f="bigList";}}else{}}}return{userMode:f,listRight:g};},getPageState:function(){return this._pageState;
},getBoundaryManager:function(){return this._boundaryManager;},getResurrectionPageState:function(){return c.ResurrectionPageStateManager.getCurrentPageState(c.SearchMain);
},getDisplayState:function(){return this._displayState;},getListRequestParams:function(){return{GET:this._getRequestParams(false,true),POST:this._generatePostParams()};
},updatePageNumber:function(f){if(f>=1&&f<=20){this.getPageState().setPageNumber(f);}},getMapManager:function(){return this._mapManager;
},getMapManagerPromise:function(){if(!this._mapManagerPromise){var f=this;this._mapManagerPromise=new e.Promise(function(h){var g=f.getMapManager();
if(!g){e.Global.once("mapManager:initialized",function(){g=f.getMapManager();if(g){h(g);}},f);}else{h(g);
}});}return this._mapManagerPromise;},getSearchMainList:function(){return this._list;},setRegionsEnabled:function(f){if(this._boundaryManager){this._boundaryManager.setRegionsEnabled(f);
}},loadResurrectionPageState:function(k,j){var f=k.getPageNumber(),h=k.getDisambigBlock(),g=k.getMapStateMessageBlock(),i=k.getSessionOrdinal();
this.initializeToState(k);if(this._mapManager){this._pageState.setSearchRectangle(this._mapManager.getMapState().getBoundingRect());
}else{this._pageState.setSearchRectangle(k.getMapState().getBoundingRect()||this._latestListSearchRectangle);
}if(i){this._pageState.setSessionOrdinal(i);}if(f){this.changePage(f);}this._map.setInitialMapState(k);
if(h||g&&!this._hasShownDisambig){this._hasShownDisambig=true;this._updateSearchInfoMessage(h,g);}},initializePage:function(f){e.log("initializePage","debug","SearchMain");
this._eventHandlers.push(e.on("searchMain:doSearch",e.bind(function(g){this.doSearch(g.mapSearch,g.listSearch);
},this)),e.on("priorityUiReady",this._onSearchPriorityReady,this));this._initConfig=f;if(this._initConfig.mapAddons.activeAddon==="schools"){this._initConfig.mapAddons.addons.schools.active=true;
}if(f.app){this._hotelCaliforniaApp=f.app;}if(this._displayState){this._displayState.setDisplayMode(c.SearchConstants.DisplayMode.Map);
}if(c.ScrollImageLoader){c.ScrollImageLoader.init();}this.searchURLFactory=new c.SearchURLFactory();this._isResponsiveModeDisabled=f.isResponsiveModeDisabled;
this._createLayoutMgr(f.userMode);e.fire("searchMain:setupHistoryManager",{app:f.app});this._attachResurrectionHandle();
this._initResultMgrList();this.requestMap(this._requestPageState,f);this.savedSearchSelection=c.ResurrectionPageStateManager.loadInitialSavedSearchSelection();
c.FilterManager.setRate(f.currentRate);e.Global.fire("searchMain:initializePage");a.profile("search main finished initializing page");
},initializeToState:function(f){e.log("INITIALIZE TO STATE");var h,j,g=new c.MsgView({model:new e.Model({disambigContent:"",keywordContent:""}),template:"{disambigContent}{keywordContent}",msgType:"disambigMsg",container:"#info-message-bar",contentTarget:".message",autoHide:false,});
h=f.getCurrentSelection();if(!h&&this.savedSearchSelection&&this.savedSearchSelection.getEnrollmentId()==f.getEnrollmentId()){h=this.savedSearchSelection;
}this._pageState.setCurrentSelection(h);j=c.FilterState.createFromFilterStateObject(f.getFilterStateObject());
try{c.FilterManager.applyFilterState(j);this._isRentalOnlySearch=(!e.Z.SearchFilters.RecentlySold.isChecked()&&e.Z.SearchFilters.ForRent.isChecked()&&!e.Z.SearchFilters.ForSale.isChecked()&&!e.Z.SearchFilters.Premarket.isChecked());
}catch(i){e.log("error applying filter state: "+i.message,"error");}this._displayState=f.getDisplayState();
this._displayState.setDisplayMode(c.SearchConstants.DisplayMode.Map);if(this._displayState.getEnrollmentId()){e.one(document.body).addClass("saved-search");
}if(!this._map){this._map=new c.SearchMainMap({mapState:f.getMapState(),selection:h,mapRollupThreshold:this._initConfig.mapRollupThreshold,useCustomTiles:!!this._initConfig.roadTileUrls,customRoadURL:this._initConfig.roadTileUrls?this._initConfig.roadTileUrls[0]:null,customAerialURL:this._initConfig.aerialTileUrls?this._initConfig.aerialTileUrls[0]:null,resultMgrList:this._resultMgrList,displayState:this._displayState,disambigMsgView:g,searchLayoutMgr:this.searchLayoutMgr,schoolsConfig:this._initConfig.mapAddons.addons.schools,mapAddons:this._initConfig.mapAddons});
this._mapManager=this._map.getMapManager();this._hoverInfoLayer=this._map.getHoverInfoLayer();this._bubbleManager=this._map.getBubbleManager();
this._miniBubbleManager=this._map.getMiniBubbleManager();this._mapManager.plug(c.SearchMapEventHandler,{bubbleManager:this._bubbleManager,displayState:this._displayState,miniBubbleManager:this._miniBubbleManager,hoverInfoLayer:this._hoverInfoLayer,pageState:this._pageState,resultMgrList:this._resultMgrList,hotelCalifornia:(this._hotelCaliforniaApp!==null),on:{"region:click":e.bind(this.onRegionClick,this)}});
this._eventHandlers.push(this._mapManager.on("map:load",this.onMapLoad,this),this._mapManager.on("map:boundsChange",this.onMapPan,this),this._mapManager.on("map:resize",this.onMapPan,this),this._mapManager.on("map:zoomChange",this.onMapZoomChanged,this),this._mapManager.on("mapAddons:filterChange",this._onMapAddonsFilterChange,this));
e.Global.fire("mapManager:initialized",{mapManager:this._mapManager});this._resultMgrList.set("mapManager",this._mapManager);
this._resultMgrList.set("hotelCalifornia",this._hotelCaliforniaApp);this._resultMgrList.set("bubbleManager",this._bubbleManager);
this._resultMgrList.set("miniBubbleManager",this._miniBubbleManager);this._list=new c.SearchMainList({listNode:this._listContainerNode,map:this._map,hotelCaliforniaApp:this._hotelCaliforniaApp,bubbleManager:this._bubbleManager,miniBubbleManager:this._miniBubbleManager,resultMgrList:this._resultMgrList,});
}else{this._map.reinitializeMap(f);}c.FilterManager.applySearchBinCounts(f.getBinCounts());},requestMap:function(h,g){e.log("REQUEST MAP");
var f=["z-map-builder","map-hover-info-layer","zillow-canvas-map-manager","map-imagery-metadata","zillow-bubble-manager","map-mini-bubble","z-search-map-event-handler","z-map-vetiles","zillow-page-state","zillow-current-selection","map-sprite-layer","map-boundary-manager"];
f.push(e.bind(h,this,g));e.use.apply(e,f);},changePage:function(f){var h;f=Math.round(f);if(f>=1&&f<=20){h=this.getPageState().getPageNumber();
if(h!=f){this.getPageState().setPageNumber(f);if(f==1){this.getPageState().setSessionOrdinal(null);}this.doSearch(false,true);
var g=this._listContainerNode;e.use("anim",function(k){var i=k.one("#list-results-container")||k.one("body");
var m="html";i=g;m="#list-container-column";var j=0,l=i.get("offsetTop")+j;k.one(m).set("scrollTop",l);
window.scroll(0,l);});}}},getSearchPageGACategory:function(){if(this.getIsFavoriteView()){return"Followed Homes";
}else{return"Search";}},updateSortUI:function(f){if(this._displayState.getEnrollmentId()){c.SearchUIContent.updateSortByListToFeatured(f);
this._displayState.setEnrollmentId(undefined);}this._displayState.setSort(f);},resetOldSortField:function(){this._oldMixModeSortField=null;
},setSort:function(g){this.updateSortUI(g);if(this._displayState.getEnrollmentId()){this._displayState.setEnrollmentId(undefined);
}var f=this.getSearchPageGACategory();this.doSearch(this._mapManager,true);c.Analytics.trackEvent({category:f,action:"Sort Homes - "+this._displayState.getSort(),label:"Sort By"});
},setListHTML:function(g,h){e.log("setListHTML","debug","SearchMain");var i=e.one("#list-results"),f;
if(h){g=g.concat(h);}if(i){if(window.html5){f=window.html5.createElement("div");f.innerHTML=g;e.one("#list-results").setContent(f);
}else{e.one("#list-results").setContent(g);}if(c.ScrollImageLoader){c.ScrollImageLoader.reset();}e.ZSG.NotificationBarDismiss.detach();
e.ZSG.NotificationBarDismiss.init();e.fire("searchMain:setListHTML");}else{e.log("listResults not available, firing searchlistview need list update","debug","SearchMain");
e.Global.fire("searchListView:needListUpdate",{});}},setPaginationHTML:function(f){var g=e.one("#search-pagination-wrapper");
if(g){g.setContent(f);}},getMapState:function(){if(this._mapManager){return this._mapManager.getMapState();
}else{return null;}},getPageLink:function(){var f=window.location.protocol+"//"+window.location.host+this.getURLString();
return f;},provideUserLink:function(){var f=this.getPageLink();prompt("You can use the URL below to return to this page",f);
},onCustomSelectionCreation:function(g){var f=this.getMapState();this._pageState.setCurrentSelection(g);
if(g!==null){f.setSelectionBoundingRect(g.getBoundingRect());this.clearSavedSearchState("featured");}else{f.setSelectionBoundingRect(null);
}this._pageState.setPageNumber(1);this.doSearch(true,true);},onRegionSelectionResponse:function(z,j,n){var o=this._mapManager.getMapState(),f=(c.RegionSelection.isRegionSelection(z)&&z.getRegionType()==c.SearchConstants.RegionType.State&&o&&o.getZoomLevel()<=5),u=(f?z:null);
this._selectRegion(u);if(z&&j){var y=z.getBoundingRect();var g=y.getCenter();var x=3;if(o&&o.getBoundingRect()&&o.getZoomLevel()){x=c.MapState.calculateZoomForBounds(y,o.getBoundingRect(),o.getZoomLevel());
}this._updateSearchInfoMessage("",undefined);var k=Math.min(x,14);var v=this._mapManager.getMapState().getZoomLevel();
if(k>v){this._mapManager.setMapCenterAndZoom(g,k);}else{this._mapManager.setMapCenter(j);var r=this._mapManager.getMapState().getBoundingRect();
if(r){var m=c.VETiles.LongitudeToPixelX(r.getSouthWest().getMillionthsLongitude(),v);var l=c.VETiles.LatitudeToPixelY(r.getSouthWest().getMillionthsLatitude(),v);
var p=c.VETiles.LongitudeToPixelX(r.getNorthEast().getMillionthsLongitude(),v);var t=c.VETiles.LatitudeToPixelY(r.getNorthEast().getMillionthsLatitude(),v);
var q=p-m;var w=l-t;var i=c.VETiles.LongitudeToPixelX(j.getMillionthsLongitude(),v);var h=c.VETiles.LatitudeToPixelY(j.getMillionthsLatitude(),v);
m=i-Math.ceil(q/2);l=h+Math.floor(w/2);p=i+Math.floor(q/2);t=h-Math.ceil(w/2);var s=new c.LatLngBounds(c.LatLong.createFromMillionths(c.VETiles.PixelYToLatitude(l,v),c.VETiles.PixelXToLongitude(m,v)),c.LatLong.createFromMillionths(c.VETiles.PixelYToLatitude(t,v),c.VETiles.PixelXToLongitude(p,v)));
this._pageState.setSearchRectangle(s);this._pageState.setPageNumber(1);this.doSearch(true,true);}}c.FilterManager.onRegionSelectionChanged(z);
}else{this._pageState.setPageNumber(1);this.doSearch(true,true);}},applyRegionSelection:function(f){if(this._mapManager){this._selectRegion(f);
if(e.Z.CustomRegionSelection.isCustomRegionSelection(f)&&f.customGeometry&&this._boundaryManager){this._boundaryManager.setCustomGeometry(f.customGeometry);
}this._mapManager.updatePicassoBtn(f?true:false);}},_selectRegion:function(f){this._pageState.setCurrentSelection(f);
if((f!==null)&&(f!==undefined)){this.getMapState().setSelectionBoundingRect(f.getBoundingRect());}else{this.getMapState().setSelectionBoundingRect(null);
}if(this._boundaryManager){this._boundaryManager.changeSelection(f);}},getBubbleManager:function(){return this._bubbleManager;
},getMiniBubbleManager:function(){return this._miniBubbleManager;},getFilterManager:function(){return c.FilterManager;
},constructUrlState:function(){return this.getURLStateObj();},getURLString:function(){var f=this.getURLStateObj().toURL();
return f;},getURLStateObj:function(){var h,f,g={};g.urlState=new c.SearchURLState();g.urlState.setUrlRoot(e.Z.SearchFilters.SearchPageType.getValue());
g.mapState=this.getMapState();g.pageState=this._pageState;g.filterState=c.FilterManager.getUserFilterState();
g.displayState=this._displayState;g.urlParams={};if(this._hotelCaliforniaApp&&this._hotelCaliforniaApp.getActiveViewId()){f=this._hotelCaliforniaApp.getActiveViewId();
g.zpid=f.zpid;g.lat=f.lat;g.lon=f.lon;if(this._hotelCaliforniaApp.isTwoColumnDetailViewOpen){if(this._hotelCaliforniaApp.isTwoColumnDetailViewOpen()){g.urlParams.view="map";
}}}var i=this._map.getAddonSearchParams();if(i.length){g.addOnsState={};g.addOnsState.params=i;}h=this.searchURLFactory.getURLObjectFromStates(g);
return h;},getIsFavoriteView:function(){return e.one("body").hasClass("fav-view");},isCustomSelection:function(){var f=this._pageState.getCurrentSelection();
if(f&&(c.CustomRegionSelection.isCustomRegionSelection(f)||c.SavedSearchSelection.isSavedSearchSelection())){return !!f.getCustomGeometry();
}return false;},setInitialZpid:function(h){if(this._hotelCaliforniaApp){var g=new e.Z.SearchURLState(),f="map";
g.fromURL(e.config.win.location.pathname);if(g.getLocationValue(e.Z.SEO.LocationType.MapRect)!=null){f=null;
}this._hotelCaliforniaApp.showHdp(h,{view:f,isInitialLoad:true});}},setInitialBubble:function(g,h){var f=1024;
if(this._hotelCaliforniaApp&&g instanceof e.Z.PropertyBubble&&g.zpid){if(h){if(this._mapManager){this._mapManager.selection.setSelectedItem(String(h.id),"propertyMarker",{miniBubble:{propertyId:h.id,latitude:h.lat,longitude:h.lng,type:(h.data?h.data.miniBubbleType:h.statusType),data:h.data}});
}}}else{if(window.innerWidth>=f){if(this._mapManager){this._mapManager.selection.setSelectedItem(String(g.zpid),"propertyMarker",{bubbleImpl:g});
}this._maintainSelectionOnFilterChange=true;}else{this._list.openSelectedPropertyMiniBubble();}}},_requestPageState:function(f){e.log("REQUEST PAGE STATE");
var g=this._mapSearchHistory.getCurrentFragment();if(g&&g!==this._mapSearchHistory.getInitialFragment()){c.ResurrectionPageStateManager.requestPageState(g);
this._displayingServerRenderedList=false;}else{if(f&&f.renderedBoundingRect){this._displayingServerRenderedList=true;
this._hasRequestedList=true;this._latestListSearchRectangle=new c.LatLngBounds(c.LatLong.createFromDegrees(f.renderedBoundingRect[1],f.renderedBoundingRect[0]),c.LatLong.createFromDegrees(f.renderedBoundingRect[3],f.renderedBoundingRect[2]));
this._pageState.setSearchRectangle(this._latestListSearchRectangle);}c.ResurrectionPageStateManager.requestPageState("");
}},_attachResurrectionHandle:function(){c.ResurrectionPageStateManager.onResurrectionStateLoaded.subscribe(e.bind(function(g,f){this.loadResurrectionPageState(g,f);
},this));},_updateMapListMsgParent:function(f,i){var g=e.one("#search-messaging-container"),h;if(f>i){h=e.one("#map-container");
if(!h.contains(g)){h.prepend(g);}}else{if(!this._listContainerNode.contains(g)){this._listContainerNode.prepend(g);
}}g.removeClass("hide");},_createListOnlyView:function(f){this._list.showMapResultCountMessage();if(c.ScrollImageLoader){c.ScrollImageLoader.setScrollContainer(null);
}},_createLayoutMgr:function(f){this.searchLayoutMgr=new e.Z.SearchLayoutMgr();this._handles.searchLayoutMgrUpdate=this.searchLayoutMgr.on("searchLayoutMgr:update",this._onSearchLayoutMgrUpdate,this);
},_freezeMap:function(){var f=e.one("#searchMap-map-wrapper");if(f){f.hide();}if(this._mapManager){this._mapManager.selection.setSelectedItem();
}},_thawMap:function(){var f=e.one("#searchMap-map-wrapper");if(f){f.show();}},_initResultMgrList:function(){var f=[c.PropertiesResultMgr,c.BuildingsResultMgr,c.RegionsResultMgr,c.CommunitiesResultMgr,c.ListResultMgr];
this._resultMgrList=new c.ResultMgrList({plugins:f});this._eventHandlers.push(this._resultMgrList.on("failedRequest",this._onResultMgrListFailedRequest,this),this._resultMgrList.after("loaded",this._afterResultMgrListLoaded,this),this._resultMgrList.after("update",this._afterResultMgrListUpdate,this),this._resultMgrList.after("updateProgress",this._afterResultMgrListUpdateProgress,this),this._resultMgrList.after("updateComplete",this._afterResultMgrListUpdateComplete,this),this._resultMgrList.after("listResults:loaded",this._afterListResultsLoaded,this));
},getResultMgrList:function(){return this._resultMgrList;},_onFavoriteAdded:function(g){var f=this._resultMgrList.getMarkerById(g.zpid);
if(f){f.setPriority(true);}},_onFavoriteRemoved:function(g){var f=this._resultMgrList.getMarkerById(g.zpid);
if(f){f.setPriority(false);}},_onResultMgrListFailedRequest:function(f){this._list.hideListLoadingMessage();
},_afterResultMgrListLoaded:function(k){var i=k.results||{},h=this._pageState.getCurrentSelection(),g=i.map||{},j=e.Object.getValue(c,g.mapResultsMode.split(".")),f;
this._updateSearchInfoMessage(undefined,i.mapStateMessage);if(i.sessionOrdinal){this._pageState.setSessionOrdinal(i.sessionOrdinal);
}if(c.CustomRegionSelection.isCustomRegionSelection(h)&&typeof i.tempCustomRegionId==="string"&&i.tempCustomRegionId.length>0){h.setCustomRegionId(i.tempCustomRegionId);
e.fire("searchMain:updateUrl");}if(k.isMapSearch){if(this._map){this._map.updateResultMode(j);}}},_onMapAddonsFilterChange:function(f){if(f.model.lastChange.activeSchools){this.isAddonFilterChange=false;
}else{this.isAddonFilterChange=true;}c.FilterManager.triggerExternalChange();this._maintainSelectionOnFilterChange=false;
},_afterResultMgrListUpdate:function(g){e.log("_afterResultMgrListUpdate","debug","SearchMain");if(this._map){this._map.updateMarkers(g.markers);
}var f=e.one("#map-result-count-message");if(f&&f.get("innerHTML")!==""){this._list.showMapResultCountMessage();
}},_afterResultMgrListUpdateProgress:function(f){e.log("_afterResultMgrListUpdateProgress","debug","SearchMain");
if(this._map){this._map.updateMarkersProgress(f.markers);}},_afterResultMgrListUpdateComplete:function(f){e.log("_afterResultMgrListUpdateComplete","debug","SearchMain");
if(this._map){this._map.updateMarkersComplete(f);}},_afterListResultsLoaded:function(k){e.log("_afterListResultsLoaded","debug","SearchMain");
var g=k.results,i,f,h=e.one("#sort-control-container"),j=e.one("#list-container-column .seo-links");this._list.hideListLoadingMessage();
if(!g){return;}if(e.config.instantHDP&&g.jsonData){this._list.setJsonData(g.jsonData);}f=g.pagination;
i=e.one("#map-result-count-message");if(g.sortControlHTML){e.Z.SearchUIContent.replaceSortControlHTML(g.sortControlHTML);
e.Z.MapListSideBySide.ensureSortControl();}this.setListHTML(g.listHTML||"",g.terseHTML);if(!f||g.numPages<2){f="";
}this.setPaginationHTML(f);var l=g.numFavorites;if(l){e.Global.fire("favoriteManager:savedHomesCountUpdate",l);
}if(this.getIsFavoriteView()){if(l===0||!g.hasFavoriteClaimedProperty){e.fire("trackLink",{category:"Followed Homes",action:"No Favorites",label:"MyHomes"});
}else{e.fire("trackLink",{category:"Followed Homes",action:"Shown Claimed",label:"MyZillow:Followed Homes"});
}}c.FilterManager.applySearchBinCounts(c.SearchBinCounts.createFromJson(g.binCounts));c.SearchUIContent.initializeListGA();
if(i&&i.get("innerHTML")!==""){this._list.showMapResultCountMessage();}this.showSortControlAndSeoFooter(h,j);
if(this.getIsFavoriteView()){if(!g.binCounts.totalResultCount){this.hideSortControlAndSeoFooter(h,j);
}}this.setupZoomOutMessage();this.getSearchMainList().highlightActiveListing();e.fire("searchMain:afterListResultsLoaded");
},showSortControlAndSeoFooter:function(f,g){if(f){f.show();}if(g){g.show();}},hideSortControlAndSeoFooter:function(f,g){if(f){f.hide();
}if(g){g.hide();}},setupZoomOutMessage:function(){var f=e.all(".zoom-out-message");f.each(function(h,g,i){h.detach().on("click",function(k){k.preventDefault();
var j=this.getMapManager();if(j){j.zoomOut();}},this);},this);},_onSearchPriorityReady:function(){this._eventHandlers.push(e.Global.on("favoriteManager:favoriteAdded",this._onFavoriteAdded,this),e.Global.on("favoriteManager:favoriteRemoved",this._onFavoriteRemoved,this));
},_onSearchLayoutMgrUpdate:function(f){e.log("_onSearchLayoutMgrUpdate","debug","SearchMain");e.fire("searchMain:layoutUpdate",f);
if(this._map){this._map.updateLayout(f);}this._updateMapListMsgParent(f.mapWidth,f.listWidth);},_updateSearchInfoMessage:function(f,g){var h=this._map||this._list;
if(h){h.updateSearchInfoMessage(f,g);}}});if(e.config.win.SearchMain){e.log("SearchMain global already exists. zillow-search-main should not have been included multiple times.","error","SearchMain");
}var d=new c.MapAndListSearch();c.SearchMain=d;e.config.win.SearchMain=d;e.namespace("Z.SearchApp").singleton=d;
},"3.3.0",{condition:{name:"zillow-search-main",trigger:"z-search-app",when:"after",test:function(a){return a.config.canvas===false;
}},requires:["zillow-search-url-state","map-sprite-drag","z-search-url-factory","zillow-filter-manager","zillow-history-manager","zillow-page-state","zillow-display-state","zillow-resurrection-display-state-manager","search-constants","zillow-filter-state","zillow-search-bin-counts","zillow-info-message-bar","z-map-lat-lng-bounds","event-resize","base-build","plugin","stylesheet","z-search-layout-mgr","zillow-hidden-block","search-ui-content","z-map-vetiles","z-result-mgr-list","z-list-result-mgr","z-properties-result-mgr","z-buildings-result-mgr","z-communities-result-mgr","z-regions-result-mgr","z-map-bounding-rect","zutils","map-sprite-util","zillow-selection-manager","map-sprite-layer","zillow-search-main-map","zillow-search-main-list","zillow-map-search-history","model","z-storage","z-map-list-side-by-side","zillow-link-tracking","promise"]});

YUI.add("z-search-app",function(b){var a=b.namespace("Z.SearchApp");a.create=function(d){var c=(d.staticConfig.userMode==="listOnly"?true:false),e=new b.Z.SearchPriorityUiReady({getResultsRequested:c,});
if(this.klass){this.instance=new (this.klass)(d);}else{if(this.singleton){this.singleton.initializePage(d.staticConfig);
}}};},"3.5.0",{requires:["z-search-priority-ui-ready","zillow-search-main"]});
YUI.add("z-event-outside",function(a){a.namespace("Z.Event")["defineOutside"]=function(e,d){d=d||(e+"outside");
function b(f,g){return g!==f&&!g.ancestor(function(h){return h===f;});}var c={on:function(h,f,g){var i=a.one("doc");
f.handle=i.on(e,function(j){if(b(h,j.target)){j.currentTarget=h;g.fire(j);}},this);},detach:function(h,f,g){f.handle.detach();
},delegate:function(i,g,h,f){g.handle=a.one("doc").delegate(e,function(j){if(b(i,j.target)){h.fire(j);
}},f,this);}};c.detachDelegate=c.detach;a.Event.define(d,c);};});
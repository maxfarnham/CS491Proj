YUI.add("animation-manager",function(f){var d="debug",c="info",e="warn",a="AnimationManager";var b=f.Base.create("animationManager",f.Base,[f.Z.ManagedBase,f.Z.EventHandleManager],{_fadeAndRemoveCompleteHandler:function(n,m){if(m){if(m.nextListCardHtml){var k=f.one("#search-results");
if(k){var l;if(window.html5){var h=window.html5.createElement("div");h.innerHTML=m.nextListCardHtml;l=h.firstChild;
}else{l=f.Node.create(m.nextListCardHtml);}k.append(l);}}if(m.paginationHtml){if(f.Z.SearchMain){f.Z.SearchMain.setPaginationHTML(m.paginationHtml);
}}var g=m.updateMap,i=m.updateList,j=m.newPage;if(j){if(f.Z.SearchMain){f.Z.SearchMain.updatePageNumber(j);
}}if(g||i){f.fire("searchMain:doSearch",{mapSearch:g,listSearch:i,});}}if(f.Z.FilterManager&&f.Z.FilterManager.removePropertyFromBinCounts){f.Z.FilterManager.removePropertyFromBinCounts(null);
}},resultListRemoveSuccessHandler:function(i,h){var g=f.bind(this._fadeAndRemoveCompleteHandler,this,i,h);
this.fadeAndRemovePropertyFromList("#list-results #zpid_"+i,g);this.fadeAndRemovePropertyFromList("#list-results #zpid_"+i+"-terse",g);
},fadeAndRemovePropertyFromList:function(g,j){try{var h=f.one(g);h.wrap("<div>","</div>");h=h.ancestor();
if(h){h.transition({duration:0.4,easing:"cubic-bezier(0.5,0.1,0.5,0.9)",height:{value:0},opacity:{value:0.2}},function(){this.remove();
if(j){j();}});}}catch(i){f.log("failed fading, "+i.message,"error",a);}}});f.Z.AnimationManager=new b();
},"1.0.0",{optional:["zillow-filter-manager","zillow-search-main"],requires:["base-build","transition","z-managed-base","z-event-handle-manager"]});

YUI.add("favorite-manager",function(e){function p(G){this.zpid=G.zpid;this.typeCode=parseInt(G.typeCode,10);
this.priceTypeCode=parseInt(G.priceTypeCode,10);this.yearBuilt=G.yearBuilt;this.residenceType=G.residenceType;
this.homeReport=G.homeReport;this.propertyAlert=G.propertyAlert;this.currentDivId=G.currentDivId;this.latitude=parseFloat(G.latitude);
this.longitude=parseFloat(G.longitude);this.primaryImageURL=G.primaryImageURL;this.streetAddr=G.streetAddr;
this.nBedrooms=parseInt(G.nBedrooms,10)||0;this.nBathrooms=parseFloat(G.nBathrooms)||0;this.zestimate=parseInt(G.zestimate,10)||0;
this.squareFootage=parseInt(G.squareFootage,10)||0;this.price=parseInt(G.price,10)||0;}p.prototype={constructor:p.prototype.constructor,toString:function(){return"[Favorite "+this.zpid+"]";
},setInnerHTML:function(G){this.innerHTML=G;}};var v={typeCode:{claimed:1,associated:2},priceTypeCode:{forSale:1,mmm:2,recent:3}};
var C="/myzillow/Favorites.htm",o="/myzillow/UpdateFavorites.htm",q="saveNote",z="#add-note-section .add-note-code-header",m=".favorite-note",A="zsg-icon-heart-line",j="zsg-icon-heart-filled",c="sprite-heart-line",k="sprite-heart-filled",d="Followed Homes",a=2;
var r={};e.publish("favoriteManager:setSaved",{emitFacade:true});e.publish("favoriteManager:setRemoved",{emitFacade:true});
e.publish("favoriteManager:updatePropertyAlerts",{emitFacade:true});e.publish("favoriteManager:removeSubscription",{emitFacade:true});
e.publish("favoriteManager:addFavoriteEffects",{emitFacade:false});e.publish("favoriteManager:removeFavoriteEffects",{emitFacade:false});
e.publish("favoriteManager:updateNote",{emitFacade:true});e.publish("favoriteManager:updateNoteSuccess",{emitFacade:true});
e.publish("favoriteManager:savedHomesCountUpdate",{emitFacade:true});function t(J){if(u(J)){var G=e.one("#oneClickSaveFavorite");
if(G&&G.get("value")){var H=e.one("#removeFavoriteButton").getContent();e.one("#oneClickfavoriteButton").setAttribute("class","saved saveFavorite").setContent(H);
}else{var I=e.one("#favoriteButton");if(I){I.addClass("saved").addClass("saveFavorite").setContent('<span id="dropDownSaveFavoriteButton">Saved as <a href="'+C+'">favorite</a></span>');
}}e.fire("favoriteManager:setSaved");}}function s(K){if(u(K)){var H=e.one("#oneClickSaveFavorite"),J=e.one("#favoriteButton");
if(H!=null&&H.get("value")){var I=e.one("#addFavoriteButton").getContent();e.one("#oneClickfavoriteButton").setAttribute("class","saved saveFavorite").setContent(I);
if(e.one("#add-note-menu").hasClass("note-added")){e.one("#add-note-menu").removeClass("note-added");
}e.one("#add-note-menu").hide();e.one("#home-description-fav-note").hide();}else{if(J!=null&&(K=J.getData("zpid"))!=null){J.removeClass("saved");
J.setContent('<a id="dropDownSaveFavoriteButton"></a>');var G=J.one("#dropDownSaveFavoriteButton");G.setHTML("Save as favorite");
G.setAttrs({href:"#","data-fm-zpid":K,"data-fm-callback":"newHomeDetailsSaveFavoriteSuccessHandler"});
G.addClass("fm-save-event");}}e.fire("favoriteManager:setRemoved");}}function u(H){var G=e.one("#oneClickfavoriteButton .save-button");
if(G&&G.hasAttribute("data-fm-zpid")&&(G.getAttribute("data-fm-zpid")==H)){return true;}return false;
}function f(H){var G=e.one("#noteSaved"+H);if(G){G.show().hide("fadeOut",{delay:a});}}function x(H,G){e.log("Ajax request failed",g,"FavoriteManager");
e.log(G);}function y(M,G,J){var I=J.fn,L=J.zpid,H;try{H=e.JSON.parse(G.responseText);}catch(K){e.log("Unexpected response removing favorite "+L+": "+K.message,g,b);
return;}if(H.successCode!=="1"){e.log("Failure removing favorite "+L+": error="+H.successCode,g,b);return;
}if(I){I(L,H.searchUpdates,H.myzUpdates);}e.Global.fire("favoriteManager:favoriteRemoved",{zpid:L});}function n(){var H="Alerts",G="Property Report",I="Save";
if(e.one(".FS")!=null){G="Property Alert";}else{if(e.one(".NFS")!=null){e.Z.Analytics.trackEvent({category:H,action:"Home Report",label:I});
G="Property Alert";}}e.Z.Analytics.trackEvent({category:H,action:G,label:I});}function E(M,G,J){n();var I=J.fn,L=J.zpid,H;
try{H=e.JSON.parse(G.responseText);}catch(K){e.log("Unexpected response adding favorite "+L+": "+K.message,g,b);
return;}switch(H.successCode){case"1":r[L]=true;if(I){I(L);}e.Global.fire("favoriteManager:favoriteAdded",{zpid:L});
e.Global.fire("searchTypeAppMethods:expireMyHomesState");break;case"2":alert("You will need to login / register to add a favorite");
break;case"3":alert("Sorry, we were unable to add a favorite at this time.  Please try again later.");
break;case"4":alert("You have added too many homes.  Please navigate to MyZillow\nand remove some homes in order to add more.");
break;}}function B(M,G,I){var L=I.zpid,J=I.note,H;n();try{H=e.JSON.parse(G.responseText);}catch(K){e.log("Unexpected response updating note for favorite "+L+": "+K.message,g,b);
return;}if(H.successCode!=="1"){e.log("Failure updating note for favorite "+L+": error="+H.successCode,g,b);
return;}e.Global.fire("favoriteManager:updateNoteSuccess",L,J);e.Global.fire("searchTypeAppMethods:expireMyHomesState");
}function F(G,J,O){if(J.responseText.charAt(0)!=="1"){return;}var N=O.zpid,I=!!O.currentlySubscribed,L=O.favoriteArray,K=0,H=L.length,P,M;
for(;K<H;K++){P=L[K];if(P.zpid===N){M=e.one("#"+O.idPrefix+N);M.setAttribute("data-fm-is-subscribed",!I);
if(I){M.set("checked",false);}else{M.set("checked",true);}P.setInnerHTML(e.one("#"+P.currentDivId).getContent());
P.homeReport=!I;e.one("#"+(I?"un":"")+"subscribed"+N).show().hide("fadeOut",{delay:a});break;}}}function w(L,I,K){var J=e.one(m);
if(J){J.set("value","");}e.one("#add-note-menu").show();var G=e.one("#add-note-section h5");if(G){e.log(G);
G.setHTML("Add a note");}var H=e.one("#add-note-code .close");if(H){H.simulate("click");}e.Global.fire("favoriteManager:updateNoteSuccess",K,"");
}var i="debug",h="info",g="warn",l="error",b="FavoriteManager";var D=e.Base.create("favoriteManager",e.Base,[e.Z.ManagedBase,e.Z.EventHandleManager],{numFavorites:0,favoriteArray:[],running:false,SAVED_HOMES_FORMAT_COUNT_THRESHOLD:99,_hotelCaliforniaEnabled:false,_dejaVuEnabled:false,initializer:function(){e.log("initialize",i,b);
this._attachHandlers();e.Global.publish("favoriteManager:favoriteAdded",{emitFacade:true});e.Global.publish("favoriteManager:favoriteRemoved",{emitFacade:true});
e.publish("favoriteManager:addFavoriteProperty",{emitFacade:true});this._dejaVuEnabled=e.config.searchAppMode==="dejavu";
this._hotelCaliforniaEnabled=e.config.searchAppMode==="hotelCalifornia"||e.config.searchAppMode==="slidingSearchColumn";
},_attachHandlers:function(){e.log("_attachHandlers",i,b);var G=e.config.delegateClickSelector||"document",H=e.one(G),I;
if(H){this.addHandle(H.delegate("click",this._onRemoveFavoriteClick,".fm-remove-event",this));this.addHandle(H.delegate("click",this._onAddFavoriteClick,".fm-save-event",this));
this.addHandle(H.delegate("click",this._onPropertyAlertClick,"input.fm-property-alert-event",this));this.addHandle(H.delegate("click",this._onHomeReportClick,"input.fm-home-report-event",this));
this.addHandle(H.delegate("click",this._onRemoveFaveNote,".fm-remove-note",this));this.addHandle(H.delegate("click",this._onSubscribeAllClick,".fm-sub-all",this));
}if(G!=="document"){I=e.one("#wrapper");if(I){this.addHandle(I.delegate("click",this._onAddFavoriteClick,".yui3-lightbox .fm-save-event",this));
this.addHandle(I.delegate("click",this._onRemoveFaveNote,".yui3-lightbox .fm-remove-note",this));}}this.addHandle(e.Global.on("favoriteManager:addFavoriteProperty",this._onAddFavorite,this));
this.addHandle(e.on("favoriteManager:removeSubscription",this.removeSubscription,this));this.addHandle(e.on("favoriteManager:updatePropertyAlerts",this.addSubscription,this));
this.addHandle(e.on("favoriteManager:addFavoriteEffects",this.addFavoriteEffects,this));this.addHandle(e.on("favoriteManager:removeFavoriteEffects",this.removeFavoriteEffects,this));
this.addHandle(e.Global.on("favoriteManager:updateNote",this._onUpdateNote,this));this.addHandle(e.Global.on("favoriteManager:updateNoteSuccess",this._onHomeDetailsSaveNoteSuccess,this));
this.addHandle(e.Global.on("add-note-code:ready",this.resetFormFields,this));this.addHandle(e.Global.on("favoriteManager:savedHomesCountUpdate",this._onSavedCountUpdate,this));
},destructor:function(){e.log("destructor",h,b);this.removeHandles();},freeze:function(){e.log("freeze",h,b);
this.removeHandles();},thaw:function(){e.log("thaw",h,b);this._attachHandlers();},_onAddFavoriteClick:function(G){G.preventDefault();
this._onAddFavorite(G);},_onAddFavorite:function(L){var J;if(L.opener){J=L.opener;}else{if(L.currentTarget){J=L.currentTarget;
}}if(J){var K=J.getData(),H=K["fm-callback"],N=K["fm-redirect"]==="true",M=K["fm-save-note"]==="true",I=K["za-label"],G;
if(I){e.Z.Analytics.trackEvent({category:d,action:"Follow Home",label:I});}if(H=="showAsSaved"){G=e.bind(this[H],this,J);
}else{G=e.bind(this[H],this);}this.addFavorite(K["fm-zpid"],G,null,N,M);}else{e.log("No current target specifiec for addFavorite event",g,b);
}},_onRemoveFavoriteClick:function(L){L.preventDefault();var J;if(L.opener){J=L.opener;}else{if(L.currentTarget){J=L.currentTarget;
}}if(J){var K=J.getData(),H=K["fm-callback"],I=K["za-label"],G;if(I){e.Z.Analytics.trackEvent({category:d,action:"Unfollow Home",label:I});
}if(H){G=e.bind(this[H],this);}this.removeFavorite(K["fm-zpid"],G,H);}else{e.log("No current target specifiec for removeFavorite event",g,b);
}},_onPropertyAlertClick:function(I){I.preventDefault();var H=I.currentTarget.getData(),G=H["fm-is-subscribed"]==="true";
this.updatePropertyAlertEmailSubscription(H["fm-zpid"],G);this._trackAlertSubscriptionChange("Property Alert",G);
},_onHomeReportClick:function(J){J.preventDefault();var I=J.currentTarget.getData(),G=I["fm-is-subscribed"]==="true",H="Home Report";
this.updateHomeReportEmailSubscription(I["fm-zpid"],G);if(I["is-fs-or-mmm"]==="true"){H="Listing Report";
}this._trackAlertSubscriptionChange(H,G);},_onRemoveFaveNote:function(H){H.preventDefault();var G=H.currentTarget.getData();
this.removeHdpFavNoteBlock(G["fm-zpid"]);},_onUpdateNote:function(G){var J=G.zpid,H=G.note;if(!J){e.log("no zpid provided to updateNote",l,b);
return;}e.log("update note for favorite: "+J,i,b);if(!e.Lang.isString(H)){e.log("invalid note value - must provide a string",l,b);
return;}var I={zpid:J,operation:q,note:H,ajax:true};e.io(o,{"arguments":{note:H,zpid:J},context:this,data:I,on:{success:e.bind(B,this),failure:function(L,K){x(L,K);
}}});return true;},_onSubscribeAllClick:function(I){I.preventDefault();var H=I.currentTarget.getData(),G=H["fm-sub"]==="true";
this.updateAllEmailSubscriptions(G);},_trackAlertSubscriptionChange:function(H,G){if(G){H=H+" Unsub";
}e.Z.Analytics.trackEvent({category:"Alerts",action:H,label:"MyZillow:Followed Homes"});},_updateSearchAppContent:function(){e.log("_hotelCaliforniaEnabled is set to "+this._hotelCaliforniaEnabled);
if(this._hotelCaliforniaEnabled){e.Global.fire("searchListView:needListUpdate");}if(this._dejaVuEnabled){e.Global.fire("dejaVu:updateSearchContent");
}},isFavorite:function(G){return r[G]||false;},getFavorites:function(){return e.Object.keys(r);},filteredFavoriteArray:null,setFavorite:function(G){this.favoriteArray.push(new p(G));
},removeFavorite:function(L,K,I){var O=null,G=[],J=null,M="",N="1",H="days";if(e.Z.SearchMain&&e.Z.SearchMain.getPageState()){J=e.all("#list-results #search-results article");
e.each(J,function(P){O=P.getAttribute("id");if(O.startsWith("zpid_")){G.push(P.getAttribute("id").substr(5));
}});M=e.Z.SearchMain.getPageState().getSearchRectangle().toJSON().join(",");N=e.Z.SearchMain.getPageState().getPageNumber();
H=e.Z.SearchMain.getDisplayState().getSort();}else{if(I==="resultListRemoveMyHomeSuccessHandler"){return;
}}if(this.acquireClickMutex(L,"fav","removeFavorite:"+I)){e.io(o,{"arguments":{fn:K,zpid:L},context:this,data:{zpid:L,operation:"remove",ajax:true,zpids:G.toString(),rect:M,p:N,sort:H,listonly:e.one("body").hasClass("list-only-mode")},on:{success:y,failure:function(Q,P){this.releaseClickMutex(L,"fav","removeFavorite");
x(Q,P);}}});}},addFavorite:function(N,M,G,O,L){e.log("adding favorite for zpid "+N,i,b);var I={zpid:N,operation:"add"};
if(!!L){I.operation=q;var K=e.one(m);var H=e.one("#oneClickSaveFavorite");if(K&&H){var J=K.get("value");
if(J.length>512){e.one(".favorite-note").addClass("error");e.one(".one-click-error-msg-container").set("text","Text exceeds the max limit of 512 characters.").show();
return false;}else{e.one(".favorite-note").removeClass("error");e.one(".one-click-error-msg-container").hide();
}}if(K){I.note=K.get("value")||"";}}if(!e.one("#login-block").hasClass("logged-in")){I.ajax=false;e.config.win.location=[o,e.QueryString.stringify(I)].join("?");
return true;}else{I.ajax=true;if(this.acquireClickMutex(N,"fav","addFavorite")){e.io(o,{"arguments":{fn:M,zpid:N},context:this,data:I,on:{success:function(R,Q,P){E(R,Q,P);
this.releaseClickMutex(N,"fav","addFavorite");},failure:function(Q,P){this.releaseClickMutex(N,"fav","addFavorite");
x(Q,P);}}});return false;}}},homeDetailsSaveFavoriteSuccessHandler:function(G){t(G);this._updateSearchAppContent();
},newHomeDetailsSaveFavoriteSuccessHandler:function(K){var H,G=e.one("#save-menu");if(G){G.addClass("saved");
H=e.Node.getDOMNode(G.one("#favoriteButton a"));var J=e.one(".saveOneClick");var I=e.one("#add-note-menu");
if((H||J)&&!I.hasClass("note-added")){I.show();}}this._updateSearchAppContent();e.fire("favoriteManager:addFavoriteEffects",K);
},newHomeDetailsRemoveFavoriteSuccessHandler:function(G){this._updateSearchAppContent();e.fire("favoriteManager:removeFavoriteEffects",G);
},saveNoteSuccessHandler:function(G){t(G);f(G);},homeDetailsSaveNoteSuccessHandler:function(I){var G=e.one(m),H=G.get("value");
e.Global.fire("favoriteManager:updateNoteSuccess",I,H);},_onHomeDetailsSaveNoteSuccess:function(N,P){var G,I,H,K,Q,J,M,O;
if(!e.one("#fav-note-text[data-zpid="+N+"]")){return;}P=e.Lang.trim(P);t(N);f(N);G=e.one("#save-menu");
if(G){I=e.one("#oneClickSaveFavorite");H=e.one("#add-note-code .close");K=e.one(z);Q=e.one(m);J=e.one(".delete-hdp-fav-note");
O=e.one("#home-description-fav-note");if(P.length>0){G.addClass("notes");if(I){var L=e.one("#add-note-menu");
L.hide();L.addClass("note-added");if(O){O.show();}if(K){e.log(K);K.setHTML("Edit a note");}if(J){J.show();
}if(H){H.simulate("click");}}}else{G.removeClass("notes").addClass("saved");if(I){if(O){O.hide();}e.one("#add-note-menu").show();
if(K){e.log(K);K.setHTML("Add a note");}if(J){J.hide();}if(H){H.simulate("click");}}}M=e.one("#fav-note-text");
if(M){M.set("text",P);}if(Q){Q.setContent(P);}}this._updateSearchAppContent();e.Z.Analytics.trackEvent({category:"Followed Homes",action:"Add Note",label:"HDP:Action bar"});
},removeHdpFavNoteBlock:function(I){var H=e.one("#oneClickSaveFavorite");var G=e.one("#home-description-fav-note");
if(H&&G){G.hide();e.one(".delete-hdp-fav-note").hide();}e.io(o,{"arguments":I,context:this,data:{ajax:true,note:"",operation:"saveNote",zpid:I},on:{success:e.bind(w,this),failure:x}});
},resetFormFields:function(){var H,G;var I=e.one(m),J=e.one(z);if(I){H=e.one("#fav-note-text").get("text");
G=e.one("#add-note-code .delete-hdp-fav-note");e.one(".one-click-error-msg-container").hide();I.removeClass("error");
I.set("text",H);if(!H){J.set("text",J.get("text").replace("Edit","Add"));G.hide();}else{J.set("text",J.get("text").replace("Add","Edit"));
G.show();}}},showAsSaved:function(I,G,K){if(!I){return;}var J=e.one(I),H;if(J){J.replaceClass("not-saved","saved").replaceClass("fm-save-event","fm-remove-event").setAttribute("title","Already saved").setAttribute("href",C);
if(G){J.setAttribute("data-fm-callback",G);}if(K){H=J.one("."+A);if(H){H.replaceClass(A,j);}H=J.one("."+c);
if(H){H.replaceClass(c,k);}}else{J.setContent("Saved");}}e.log("End Show as Saved");},addFavoriteEffects:function(G){e.log("Add Favorite Effects called for zpid: "+G);
this.showAsSaved(".selected-listing .property-listing .fm-save-event","resultListRemoveFavoriteSuccessHandler",true);
this.showAsSaved("#list-results #zpid_"+G+" .fm-save-event","resultListRemoveFavoriteSuccessHandler",true);
this.showAsSaved("#pp-save-favorites-"+G+" .fm-save-event","resultListRemoveFavoriteSuccessHandler");
t(G);this.updateFavoriteCount(1);this.animateMyHomesButton("fav-glow-add");this.animateImageMove(G);this.updatePropertyIcon(G,true);
this.releaseClickMutex(G,"fav","addFavoriteEffects");},removeFavoriteEffects:function(G){e.log("Remove Favorite Effects called for zpid: "+G);
this.showAsSave(".selected-listing .property-listing .fm-remove-event",G,"resultListSaveFavoriteSuccessHandler",true);
this.showAsSave("#list-results #zpid_"+G+" .fm-remove-event",G,"resultListSaveFavoriteSuccessHandler",true);
this.showAsSave("#pp-save-favorites-"+G+" .fm-remove-event",G,"resultListSaveFavoriteSuccessHandler");
this.updateFavoriteCount(-1);this.animateMyHomesButton("fav-glow-remove");this.updatePropertyIcon(G,false);
s(G);this.releaseClickMutex(G,"fav","removeFavoriteEffects");},updatePropertyIcon:function(M,L){var I=[e.one("#list-results #zpid_"+M),e.one("#list-results #zpid_"+M+"-terse"),e.one(".selected-listing .property-listing")];
for(var G=0;G<I.length;++G){var K=I[G];if(K){if(L){K.replaceClass("type-not-favorite","type-favorite");
}else{K.replaceClass("type-favorite","type-not-favorite");}}}var J=e.one("#listing-icon");if(J){var H=J.getAttribute("data-icon-class");
if(L){J.replaceClass(H,j);}else{J.replaceClass(j,H);}}},animateMyHomesButton:function(J){try{var G=e.one("#saved-homes-button");
if(G){G.addClass(J);var H=e.later(1000,window,function(){G.removeClass(J);},[],false);}}catch(I){e.log("Animate SavedHomes glow, "+I.message,"error","FavoriteManager");
}},animateImageMove:function(K){try{var G=e.one("#detail-container-column")!==null&&!e.one("#detail-container-column").hasClass("app-view-closedDetail");
if(!G&&!e.one("#list-results #zpid_"+K+" list-card-actions")){var N=e.one("#list-results #zpid_"+K+" figure img");
if(N){var M=N.getXY();if(M[0]===0&&M[1]===0){var L=e.one("#list-results #zpid_"+K+"-terse figure img");
if(L){N=L;}}var O=N.cloneNode(true);var H=e.one("#saved-homes-button");if(O&&H){var P=H.getXY();P[0]=P[0]+(H.get("offsetWidth")/2);
M=N.getXY();O.setXY(M);O.addClass("anim-image");e.one("body").append(O);var I=new e.Anim({node:O,duration:1,from:{width:"150",height:"112"},to:{width:"10",height:"10",xy:P,opacity:0}});
I.on("end",function(){O.remove(true);});I.set("from",{xy:M});I.run();}}}}catch(J){e.log("Animate image move, "+J.message,"error","FavoriteManager");
}},updateFavoriteCount:function(H){var I=e.one("#saved-homes-count");if(I){var J=I.getAttribute("data-count");
if(J!==null){var G=parseInt(J,10);G+=H;this.setSavedHomeCountHTML(G);}}},setSavedHomeCountHTML:function(G){var H=e.one("#saved-homes-count");
if(G!==null&&G>=0&&H){H.setAttribute("data-count",G);if(G>this.SAVED_HOMES_FORMAT_COUNT_THRESHOLD){H.setHTML(this.SAVED_HOMES_FORMAT_COUNT_THRESHOLD+"+");
}else{H.setHTML(G);}}},_onSavedCountUpdate:function(G){this.setSavedHomeCountHTML(G);},showAsSave:function(I,L,G,K){if(!I){return;
}var J=e.one(I),H;if(J){J.replaceClass("saved","not-saved").replaceClass("fm-remove-event","fm-save-event").setAttribute("title","Save this home").setAttribute("href",o+"?operation=add&ajax=true&zpid="+L);
if(G){J.setAttribute("data-fm-callback",G);}if(K){H=J.one("."+j);if(H){H.replaceClass(j,A);}H=J.one("."+k);
if(H){H.replaceClass(k,c);}}else{J.setContent("Save");}}},doneSaving:function(G){var H=this;return function(){H.showAsSaved(G);
};},resultListSaveFavoriteSuccessHandler:function(G){e.fire("favoriteManager:addFavoriteEffects",G);},resultListRemoveFavoriteSuccessHandler:function(H,G){if(e.one("body").hasClass("fav-view")){this.resultListRemoveMyHomeSuccessHandler(H,G);
}else{e.fire("favoriteManager:removeFavoriteEffects",H);}},resultListRemoveMyHomeSuccessHandler:function(H,G){e.Z.FavoriteManager.updateFavoriteCount(-1);
if(e.Z.AnimationManager){e.Z.AnimationManager.resultListRemoveSuccessHandler(H,G);}else{e.log("Y.Z.AnimationManager not defined","error",b);
}s(H);e.Z.SearchMain.getBubbleManager().closeActiveBubble();e.Z.SearchMain.getMiniBubbleManager().clear();
e.Z.FavoriteManager.releaseClickMutex(H,"fav","resultListRemoveMyHomeSuccessHandler");e.fire("favoriteManager:resultListRemoveMyHome");
},adminRemoveFavoriteSuccessHandler:function(N){var J,H,L,G=-1;try{delete r[N];for(J=0,H=this.favoriteArray.length;
J<H;J++){L=this.favoriteArray[J];if(L.zpid===N){G=J;break;}}if(G>=0){var K=this.favoriteArray.splice(G,1)[0];
this.fadeAndRemoveFavoriteFromUI(K.currentDivId);}if(this.favoriteArray.length===0){var M=e.one("#show-on-map");
if(M!=null){M.hide();}}s(N);e.Z.FavoriteManager.releaseClickMutex(N,"fav","resultListRemoveMyHomeSuccessHandler");
}catch(I){e.log(I);}},windowReloadSuccessHandler:function(){e.config.win.location.reload();},updateRecentFavoriteInformation:function(){e.io("/myzillow/RetrieveRecentFavorites.htm",{context:this,on:{success:function(I,G){var H=e.one("#recentFavoritesDiv");
if(H){H.setContent(G.responseText);}},failure:x}});},acquireClickMutex:function(L,I,H){var J=this.mutexWrapper();
var K=J.hasClass(I+L);var G=true;if(K){G=false;}else{J.addClass(I+L);}e.log(L+" acquire request for "+H+":"+G,"DEBUG","FavoriteManager");
return G;},releaseClickMutex:function(J,H,G){var I=this.mutexWrapper();I.removeClass(H+J);e.log(J+" release request for "+G+":"+!I.hasClass(H+J),"DEBUG","FavoriteManager");
},mutexWrapper:function(){var H="mutex";var G=e.one("#"+H);if(!G){G=e.Node.create("<div id="+H+">");e.one("body").append(G);
}return G;},applyFilter:function(H){var G=(v.typeCode.hasOwnProperty(H)?"typeCode":"priceTypeCode");var I=v[G][H];
this.filteredFavoriteArray=e.Array.filter(this.favoriteArray,function(J){if(J[G]===I){return J;}});e.log("applied filter: "+this.filteredFavoriteArray);
},applySort:function(G){if(this.filteredFavoriteArray.length>1){this.quickSort(this.filteredFavoriteArray,0,this.filteredFavoriteArray.length,G);
}this.saveSortOrder(G);e.log(this.filteredFavoriteArray);},quickSort:function(H,J,G,I){if(parseInt(H[0][I],10)===H[0][I]){this.favoriteArray.sort(function(L,K){return L[I]-K[I];
});}else{this.favoriteArray.sort(function(L,K){if(L[I]>K[I]){return 1;}if(L[I]<K[I]){return -1;}return 0;
});}},populateHTMLValues:function(){e.Array.each(this.favoriteArray,function(G){G.innerHTML=e.one("#"+G.currentDivId).getContent();
});},saveSortOrder:function(I){var H=new Date();H.setTime(H.getTime()+(365*24*60*60*1000));var G="; expires="+H.toGMTString();
var J="favoritesSort="+I+G;document.cookie=J;},initializeSortOrder:function(){this.populateHTMLValues();
var I=document.cookie.split(";");var G="",H,J;for(H=0;H<I.length;H++){J=I[H];if(J.indexOf("favoritesSort=")===0){G=J.substring("favoritesSort=".length,J.length);
e.one("#sortBySelect").set("value",G);break;}}},updateAllEmailSubscriptions:function(G){e.Array.each(this.favoriteArray,function(H){var I=H.homeReport,J=H.zpid;
if(G){if(I===false){this.updateHomeReportEmailSubscription(J,I);H.homeReport=!I;}else{e.one("#subscribed"+J).transition("fadeOut",{delay:4});
}}else{if(I===true){this.updateHomeReportEmailSubscription(J,I);H.homeReport=!I;}else{e.one("#unsubscribed"+J).transition("fadeOut",{delay:4});
}}},this);},updateHomeReportEmailSubscription:function(H,G){e.io("/myzillow/UpdateEmailSubscription.htm",{"arguments":{currentlySubscribed:G,favoriteArray:this.favoriteArray,handlerFnName:"updateHomeReportEmailSubscription",idPrefix:"homereport",zpid:H},data:{subscriptionType:"property",currentlySubscribed:G,zpid:H,zestimateAvailable:true},on:{success:F,failure:x}});
},updatePropertyAlertEmailSubscription:function(J,I,G){var H=G||F;e.io("/myzillow/UpdateEmailSubscription.htm",{"arguments":{currentlySubscribed:I,favoriteArray:this.favoriteArray,handlerFnName:"updatePropertyAlertEmailSubscription",idPrefix:"propertyAlert",zpid:J},data:{subscriptionType:"propertyAlerts",currentlySubscribed:I,zpid:J,zestimateAvailable:true},on:{success:H,failure:x}});
},fadeAndRemoveFavoriteFromUI:function(G){var H=this;try{e.one("#"+G).transition("fadeOut",function(){this.empty();
});}catch(I){e.log("failed fading, "+I.message,"error","FavoriteManager");}return false;},getFavoritesBounds:function(){var N=this.filteredFavoriteArray,O=N.length;
if(O===0){return null;}var I="latitude",K="longitude",L=N[0][I],J=N[0][I],H=N[0][K],G=N[0][K],M=0;for(;
M<O;M++){if(N[M][I]>L){L=N[M][I];}if(N[M][I]<J){J=N[M][I];}if(N[M][K]<H){H=N[M][K];}if(N[M][K]>G){G=N[M][K];
}}return new _MapInfo(L,H,J,G);},removeSubscription:function(G){this.removeFavorite(G.zpid);},addSubscription:function(I){var J=I.zpid,H=I.currentlySubscribed||false,G;
if(I.callback){G=this[I.callback];}this.updatePropertyAlertEmailSubscription(J,H,G);}});e.Z.FavoriteManager=new D();
},"3.3.0",{requires:["base-build","zillow-link-tracking","zillow-node-methods","io-base","querystring-stringify-simple","array-extras","z-managed-base","z-event-handle-manager","node-event-delegate","anim-xy","animation-manager"]});

YUI.add("z-bluekai-reporter",function(f){var e=f.namespace("Z"),a="BluekaiReporter",b="debug",c="error",d=f.config.win;
f.namespace("Z")[a]=f.Base.create("bluekaiReporter",f.Base,[],{BLUEKAI_JS:null,iframe:null,initializer:function(){this._createIframe();
},sendData:function(){this._loadJS();},_getJavascriptUrl:function(){var g=this.get("javascriptUrl");if(f.UA.secure){g=g.replace("http:","https:");
}return g;},_loadJS:function(){if(this.BLUEKAI_JS===null){f.log("loading BlueKai js from "+this._getJavascriptUrl(),b,a);
this.BLUEKAI_JS=e.Get.js(this._getJavascriptUrl(),{context:this,onSuccess:this._formatAndSendData,onFailure:this._logFailure});
}},_createIframe:function(){this.iframe=new f.Z.DeferredIframe({id:"bluekai",name:"__bkframe",height:"0",width:"0",url:"javascript:void(0)"});
},_formatAndSendData:function(){f.log("Successfully loaded "+this._getJavascriptUrl(),b,a);if(typeof d.bk_addPageCtx=="function"){this._createAddAttributesCalls();
this._sendData();}else{f.log("There was an error loading bluekai javascript, can't send data",c,a);}},_createAddAttributesCalls:function(){f.log("Formatting BlueKai data",b,a);
var i=this.get("bluekaiData"),h="";for(var g in i){d.bk_addPageCtx(g,i[g]);}},_sendData:function(){if(typeof d.bk_addPageCtx=="function"){f.log("Sending BlueKai data",b,a);
d.bk_addPageCtx("v1",f.config.doc.location.toString().substring(0,250));d.bk_addPageCtx("v2",f.config.doc.referrer.toString().substring(0,250));
d.bk_doJSTag(this.get("siteId"),this.get("maxPixels"),false);}else{f.log("There was an error loading bluekai javascript, can't send data",c,a);
}},_logFailure:function(){f.log("Could not load "+this._getJavascriptUrl(),b,a);}},{ATTRS:{javascriptUrl:{value:""},bluekaiData:{value:{}},maxPixels:{value:6},siteId:{value:null}}});
},"3.3.0",{requires:["base-build","z-get","deferred-iframe"]});
YUI.add("z-building-units",function(c){var a=c.namespace("Z"),g="buildingLat",d="buildingLong",e="buildingId",j="latLongKeyword",f="buildingUnits:",h=f+"ajaxStart",i=f+"ajaxComplete",l=f+"ajaxSuccess",b=f+"ajaxError";
function k(){}k.prototype={_ioRequest:null,initializer:function(){c.log("initializer","info","BuildingUnits");
var m={emitFacade:true};this.publish(h,m);this.publish(i,m);this.publish(l,m);this.publish(b,m);},_checkLatLong:function(){if(this.get(g)&&this.get(d)){return;
}else{this._getLatLongFromUrl(window.location);}},_getLatLongFromUrl:function(q){var n=decodeURIComponent(q.pathname),o=decodeURIComponent(q.hash),m,p;
if(c.UA.ie===9){p=this._getUrlSegmentsFromHash(o)||n.split("/");}else{p=n.split("/");}this.set(j,"_ll");
m=this._searchArrayForLatLong(p);if(!m){this.set(j,"_latlong");m=this._searchArrayForLatLong(p);}if(m){this._setLatLongFromString(m);
}else{c.log("LatLong could not be set from the URL","warn");}},_getUrlSegmentsFromHash:function(m){var n=m.replace("#","").split("/");
if(n[1]===this.get("buildingUrlIdentifier")){return n;}return null;},_searchArrayForLatLong:function(m){var n;
for(n=0;n<m.length;n+=1){if(m[n].indexOf(this.get(j))>0){return m[n];}}return null;},_setLatLongFromString:function(m){var n=m.replace(this.get(j),""),o=n.split(",");
this.set(g,o[0]);this.set(d,o[1]);},_getUnits:function(){var n=this,p={searchUrl:this.get("searchUrl")||"",lat:this.get(g),"long":this.get(d),id:(this.get(e)===null)?"":this.get(e),pageNumber:this.get("ajaxPageNumber"),pageSize:this.get("ajaxPageSize")},m=c.merge(p,this.get("customIoData")),o;
this._ioRequest=c.io(this.get("ajaxUrl"),{data:m,on:{start:function(){n.fire(h);},complete:function(){n.fire(i);
},success:function(s,r){try{n.fire(l,c.JSON.parse(r.responseText));n.set("units",c.JSON.parse(r.responseText).units);
}catch(q){c.log("Could not parse more units request - "+q);n.fire(b,r);}},failure:function(r,q){n.fire(b,q);
}}});}};k.ATTRS={buildingId:{validator:c.Lang.isString,writeOnce:true,value:null},ajaxPageNumber:{validator:c.Lang.isNumber,value:1},ajaxPageSize:{value:8},ajaxUrl:{validator:c.Lang.isString,value:"/ajax/buildings/GetAvailableUnits.htm",writeOnce:true},buildingLat:{writeOnce:true},buildingLong:{writeOnce:true},buildingUrlIdentifier:{validator:c.Lang.isString,value:"b",writeOnce:true},customIoData:{validator:c.Lang.isObject,value:{}},searchUrl:{validator:c.Lang.isString},latLongKeyword:{validator:c.Lang.isString},units:{}};
a.BuildingUnits=k;},"3.7.3",{requires:["io-base","json-parse","yui-base","yui-log"]});
YUI.add("z-building-list",function(d){d.namespace("Z");var c="BuildingList",f="info",e="debug",r="abTreatment",i="boundingBox",b="preBoundingBox",j="contentBox",m="totalUnitCount",h="showUnitsNumber",o="triggerNode",a="units",k="visible",g="seoList",l="ab-test-on",q="widget-hidden",p="widget-loading",n="widget-visible";
d.Z.BuildingList=d.Base.create("buildingList",d.Widget,[d.Z.EventHandleManager,d.Z.ManagedBase,d.Z.BuildingUnits],{TABLE_ROW_TEMPLATE:'<tr class="{listingTypeClass} grouped-result" data-zpid="{zpid}" title="{name}"><td class="grouped-result-label"><a href="{hdpLink}" class="no-deco routable hdp-link">{name}</a></td><td class="grouped-result-price"><a href="{hdpLink}" class="no-deco routable hdp-link">{formattedPrice}</a></td><td class="grouped-result-beds">{formattedBeds}</td><td class="grouped-result-baths">{formattedBaths}</td><td class="grouped-result-sqft">{formattedSqft}</td></tr>',SEO_TABLE_ROW_TEMPLATE:'<tr class="{listingTypeClass} grouped-result" data-zpid="{zpid}" title="{name}"><td class="grouped-result-price">{formattedPrice}</td><td class="grouped-result-beds">{formattedBeds}</td><td class="grouped-result-baths">{formattedBaths}</td><td class="grouped-result-sqft">{formattedSqft}</td><td class="grouped-result-label"><a href="{hdpLink}" class="no-deco routable hdp-link">{name}</a></td></tr>',BOUNDING_TEMPLATE:'<table class="zsg-table grouped-results" />',CONTENT_TEMPLATE:"<tbody />",initializer:function(){d.log("initializer",f,c);
this.get(o).addClass("widget-initialized");this._setUnitCount();this._setStringText();if(this.get(r)!="control"){this._setupAbTrial();
}if(this.get(g)){this.get("customIoData").labelType="none";}},destructor:function(){this.get(i).remove(true);
},renderUI:function(){this.get(o).setHTML("").append(this.get("strings.loading")).append(this.get("builderCommunity")?(this.get(h)==1?this.get("strings.showPlan"):this.get("strings.showPlans")):(this.get(h)==1?this.get("strings.showUnit"):this.get("strings.showUnits"))).append(this.get("strings.hideUnits"));
this._afterVisibleChange();this._setTableHeader();},bindUI:function(){this.addHandle(this.on("buildingUnits:ajaxStart",this._onAjaxStart,this));
this.addHandle(this.after("buildingUnits:ajaxComplete",this._afterAjaxComplete,this));this.addHandle(this.after("buildingUnits:ajaxSuccess",this._afterAjaxSuccess,this));
this.addHandle(this.after("unitsChange",this.syncUI,this));this.addHandle(this.after("visibleChange",this._afterVisibleChange,this));
this.addHandle(this.get(o).on("click",this._onTriggerNodeClick,this));},syncUI:function(){if(this.get(a)){this._addUnits(this.get(a));
}},_setUnitCount:function(s){var t;if(s){t=s;}else{t=this.get(o).getAttribute("data-unit-count");}if(t){this.set(m,t);
this.set("ajaxPageSize",t);}},_onTriggerNodeClick:function(s){s.preventDefault();if(this.get(k)){this.hide();
}else{this.show();}if(!this.get(a)){this._getUnits();}this._moveShowUnitsLink();},_onAjaxStart:function(){this.get(o).addClass(p);
this.get(i).addClass(p);},_afterAjaxComplete:function(){this.get(o).removeClass(p);this.get(i).removeClass(p);
},_afterAjaxSuccess:function(s){this._setUnitCount(s.total_count);},_afterVisibleChange:function(){if(this.get(k)){this.get(o).addClass(n).removeClass(q);
}else{this.get(o).addClass(q).removeClass(n);}},_addUnits:function(t){var s,u="--";d.each(t,function(w,v){if(this.get("abBucketOn")&&v>this.get("defaultVisibleUnits")){w.otherClasses="default-hidden";
}if(this.get(g)){s=d.Lang.sub(this.SEO_TABLE_ROW_TEMPLATE,w);}else{s=d.Lang.sub(this.TABLE_ROW_TEMPLATE,w);
}if(w.beds===u){s=s.replace("show-bd","hide");}if(w.baths===u){s=s.replace("show-ba","hide");}if(w.sqft===u){s=s.replace("show-sqft","hide");
}this.get(j).append(s);},this);d.some(t,function(v){if(!v.isCommunity){this._addBuildingPageLink();return true;
}},this);this._moveShowUnitsLink();},_moveShowUnitsLink:function(){if(this.get(k)){this.get(b).hide();
if(this.get(j).one(".grouped-result-links td")){this.get(j).one(".grouped-result-links td").prepend(this.get(o));
}}else{this.get(b).show().append(this.get(o));}},_addBuildingPageLink:function(){var s=4;if(this.get(g)){s=5;
}this.get(j).append('<tr class="grouped-result-links"><td colspan="'+s+'"></td></tr');},_setStringText:function(v){var s,u=this.get("strings"),t={totalUnits:this.get(h)};
d.each(u,function(x,w){s=d.Lang.sub(x,t);this.set("strings."+w,s);},this);},_setupAbTrial:function(){this.set("abBucketOn",true);
this._setAbClassNames();this._getUnits();},_setAbClassNames:function(){this.get(o).addClass(l);this.get(i).addClass(l).addClass(r);
},_getDefaultVisibleUnits:function(){var s;switch(this.get(r)){case"show_two":s=2;break;case"show_three":s=3;
break;default:s=null;}return s;},_setTableHeader:function(){var s;if(this.get(g)){s=this.get(b).one("thead").cloneNode(true);
this.get(i).prepend(s);}}},{ATTRS:{abBucketOn:{validator:d.Lang.isBoolean,value:false},abTreatment:{validator:d.Lang.isString,value:"control"},builderCommunity:{validator:d.Lang.isBoolean,value:false},defaultVisibleUnits:{valueFn:this._getDefaultVisibleUnits},maxVisibleUnits:{validator:d.Lang.isNumber,value:8},strings:{value:{loading:'<span class="loading">Loading...</span>',hideUnits:'<span class="hide-units">Hide <span class="zsg-icon-arrow-menu-down"></span></span>',showUnits:'<span class="show-units">Show {totalUnits} matching units <span class="zsg-icon-arrow-menu-down"></span></span>',showPlans:'<span class="show-units">Show {totalUnits} matching plans <span class="zsg-icon-arrow-menu-down"></span></span>',showUnit:'<span class="show-units">Show {totalUnits} matching unit <span class="zsg-icon-arrow-menu-down"></span></span>',showPlan:'<span class="show-units">Show {totalUnits} matching plan <span class="zsg-icon-arrow-menu-down"></span></span>'}},totalUnitCount:{writeOnce:true},showUnitsNumber:{writeOnce:true},triggerNode:{writeOnce:true},preBoundingBox:{writeOnce:true},seoList:{value:false}}});
},"3.7.3",{requires:["node-core","widget","z-building-units","z-event-handle-manager","z-managed-base"]});

YUI.add("z-building-search-list",function(e){var d=e.namespace("Z"),c="debug",a="BuildingSearchList";
var b={};d[a]=e.Base.create(a,e.Base,[],{init:function(f){e.log("init",c,a);this.set("isSEOListEnabled",f.isSEOListEnabled);
e.delegate("mousemove",this._onBuildingHover,"#c-column",".property-listing-grouped",this);e.delegate("click",this._onBuildingLinkClick,"#c-column",".trigger-units",this);
e.on("searchMain:setListHTML",function(g){e.each(b,function(h){},this);b={};});},_onBuildingHover:function(f){this.initUnitList(f.currentTarget);
},_onBuildingLinkClick:function(f){f.preventDefault();this.initUnitList(f.currentTarget.ancestor("article"),true);
},initUnitList:function(g,f){var h=g.get("id").replace("zpid_","");if(!b[h]){b[h]=new e.Z.BuildingList({triggerNode:g.all(".trigger-units"),preBoundingBox:g.one(".unit-list")||g.one(".static-grouped-results"),visible:false,seoList:this.get("isSEOListEnabled"),buildingLat:g.getAttribute("latitude")/1000000,buildingLong:g.getAttribute("longitude")/1000000,totalUnitCount:g.getAttribute("unitCount"),showUnitsNumber:g.getAttribute("showUnitsNumber"),searchUrl:window.location.pathname,builderCommunity:g.hasClass("builder-community"),customIoData:{labelType:"short"}}).render(this.get("isSEOListEnabled")?g.one(".pier-2"):(g.getAttribute("usefullwidthunittable")&&g.getAttribute("usefullwidthunittable")=="true"?g:g.one(".property-info")||g.one(".property-info-wide")));
if(f){b[h].set("visible",true);b[h]._getUnits();}}}},{ATTRS:{isSEOListEnabled:{value:false}}});},"3.3.0",{requires:["io-base"]});

YUI.add("z-hidden-property-manager",function(a){var h="debug",d="error",e="warn",b="info",c="HiddenPropertyManager";
var g="/myzillow/UpdateHiddenProperty.htm",k="#hidden-property-hdp-label",f="Hidden Homes",j=2;var i=a.Base.create("hiddenPropertyManager",a.Base,[a.Z.ManagedBase,a.Z.EventHandleManager],{_hotelCaliforniaEnabled:false,_dejaVuEnabled:false,initializer:function(){a.log("initialize",h,c);
this._attachHandlers();this._manageSeparator();a.publish("hiddenPropertyManager:hideProperty",{emitFacade:true});
a.Global.publish("hiddenPropertyManager:propertyHidden",{emitFacade:true});a.Global.publish("hiddenPropertyManager:propertyUnhidden",{emitFacade:true});
if(a.config.searchAppMode==="hotelCalifornia"||a.config.searchAppMode==="slidingSearchColumn"){this._hotelCaliforniaEnabled=true;
}else{if(a.config.searchAppMode==="dejavu"){this._dejaVuEnabled=true;}}this._hotelCaliforniaEnabled=a.config.searchAppMode==="hotelCalifornia";
},_attachHandlers:function(){a.log("_attachHandlers",h,c);var l=a.config.delegateClickSelector||"document",m=a.one(l),n;
if(m){this.addHandle(m.delegate("click",this._onHidePropertyClick,".hpm-hide-event",this));this.addHandle(m.delegate("click",this._onUnhidePropertyClick,".hpm-unhide-event",this));
}this.addHandle(a.on("hiddenPropertyManager:hideProperty",this._onHidePropertyClick,this));this.addHandle(a.Global.on("favoriteManager:favoriteAdded",this._onFavoriteAdded,this));
this.addHandle(a.Global.on("favoriteManager:favoriteRemoved",this._onFavoriteRemoved,this));},destructor:function(){a.log("destructor",b,c);
this.removeHandles();},freeze:function(){a.log("freeze",b,c);this.removeHandles();},thaw:function(){a.log("thaw",b,c);
this._attachHandlers();},_onHidePropertyClick:function(r){r.preventDefault();var o;if(r.opener){o=r.opener;
}else{if(r.currentTarget){o=r.currentTarget;}}if(o){var p=o.getData(),m=p["hpm-callback"],q=p["hpm-meta"],n=p["za-label"],l;
if(n){a.Z.Analytics.trackEvent({category:f,action:"Hide",label:n});}l=a.bind(this[m],this);this.hideProperty(p["hpm-zpid"],l,q);
}else{a.log("no node found for the hide event "+r,d,c);}},_onUnhidePropertyClick:function(r){r.preventDefault();
var o;if(r.opener){o=r.opener;}else{if(r.currentTarget){o=r.currentTarget;}}if(o){var p=o.getData(),m=p["hpm-callback"],q=p["hpm-meta"],n=p["za-label"],l;
if(n){a.Z.Analytics.trackEvent({category:f,action:"Unhide",label:n});}l=a.bind(this[m],this);this.unhideProperty(p["hpm-zpid"],l,q);
}else{a.log("no node found for the unhide event "+r,d,c);}},_onFavoriteAdded:function(l){a.log("Updating XOut controls after saving property "+l.zpid,b,c);
this._concealHideButtonsForZpid(l.zpid);},_onFavoriteRemoved:function(l){a.log("Updating XOut controls after unsaving property "+l.zpid,b,c);
this._revealHideButtonsForZpid(l.zpid);},_concealHiddenPropertyMessage:function(){var l=a.one(k);if(l){l.addClass("hide");
}},_revealHiddenPropertyMessage:function(){var l=a.one(k);if(l){l.removeClass("hide");}},_concealHideButtonsForZpid:function(n){var m=a.one("#list-results #zpid_"+n+" .list-card-actions"),l;
if(m&&m.one(".list-hide-button")){m.addClass("lh-hide");}if(this._shouldChangeHideButton(n)){l=a.one(".hideOneClick");
if(l){l.addClass("hide");}}},_revealHideButtonsForZpid:function(n){var m=a.one("#list-results #zpid_"+n+" .list-card-actions.lh-hide"),l;
if(m&&m.one(".list-hide-button")){m.removeClass("lh-hide");}if(this._shouldChangeHideButton(n)){l=a.one(".hideOneClick");
if(l){l.removeClass("hide");}}},_shouldChangeHideButton:function(m){var l=a.one("#oneClickHideButton .hide-button");
if(l&&l.hasAttribute("data-hpm-zpid")&&(l.getAttribute("data-hpm-zpid")==m)){return true;}return false;
},_concealHideStateDependentUI:function(l){a.log("Concealing hidden state-dependent buttons",b,c);a.all(".hide-when-property-hidden").each(function(m){if(m.getAttribute("data-zpid")===l){m.addClass("hpm-hide");
}},this);this._manageSeparator();},_manageSeparator:function(){var l,m=true,n=a.all("#hdp-action-bar-more li");
n.each(function(p){var o=p.hasClass("zsg-separator-narrow"),q=p.hasClass("hpm-hide");if(l&&!q&&!o){m=false;
}if(o){if(l&&m){l.addClass("hide");m=true;}l=p;}},this);if(m&&l){l.addClass("hide");}},_revealHideStateDependentUI:function(l){a.log("Revealing hidden state-dependent buttons",b,c);
a.all(".hide-when-property-hidden").each(function(m){if(m.getAttribute("data-zpid")===l){m.removeClass("hpm-hide");
}},this);a.all("#hdp-action-bar-more .zsg-separator-narrow").removeClass("hide");},hideProperty:function(q,l,n){a.log("hiding property for zpid "+q,h,c);
var o={hidezpid:q,hideop:"hide",updatelist:"false",meta:n};var p=null;if(a.Z.SearchMain){o.updatelist="true";
var m=a.Z.SearchMain.getListRequestParams();o=a.mix(o,m.GET);o=a.mix(o,m.POST);p=m.POST;}a.io(g,{method:"POST","arguments":{fn:l,zpid:q},context:this,data:o,on:{success:this._hidePropertySuccess,failure:this._logResponseFailure}});
},unhideProperty:function(o,l,m){a.log("unhiding property for zpid "+o,h,c);var n={hidezpid:o,hideop:"unhide",meta:m};
a.io(g,{method:"POST","arguments":{fn:l,zpid:o},context:this,data:n,on:{success:this._unhidePropertySuccess,failure:this._logResponseFailure}});
},hdpHidePropertySuccessHandler:function(l){this._setButtonAsHidden();this._revealHiddenPropertyMessage();
this._updateSearchAppContent();},hdpUnhidePropertySuccessHandler:function(l){this._setButtonAsHide();
this._concealHiddenPropertyMessage();this._updateSearchAppContent();},myzUnhidePropertySuccessHandler:function(o,m,n){a.Z.AnimationManager.fadeAndRemovePropertyFromList("div#zpid_"+o);
if(n&&n.replacementResult){var l=a.one("#hidelist");l.append(n.replacementResult);}},resultListHidePropertySuccessHandler:function(m,l){if(a.Z.AnimationManager){a.Z.AnimationManager.resultListRemoveSuccessHandler(m,l);
}else{a.log("Y.Z.AnimationManager not defined","error",c);}a.fire("z-hidden-property-manager:resultListHidePropertySuccess");
},windowReloadSuccessHandler:function(){a.config.win.location.reload();},_hidePropertySuccess:function(q,l,o){a.log("hidePropertySuccess handler called",h,c);
var n=o.fn,p=o.zpid,m=a.JSON.parse(l.responseText);switch(m.successCode){case"5":a.log("Property already hidden, considering the call a success.",e,c);
case"1":if(n){n(p,m.searchUpdates,m.myzUpdates);}this._concealHideStateDependentUI(p);break;case"2":a.log("You will need to login / register to hide a property",d,c);
break;case"3":a.log("Sorry, we were unable to hide the property at this time.  Please try again later.",d,c);
break;case"4":a.log("Sorry, you cannot hide a property that you have claimed.",e,c);break;}},_unhidePropertySuccess:function(q,l,o){a.log("unhidePropertySuccess handler called",h,c);
var n=o.fn,p=o.zpid,m=a.JSON.parse(l.responseText);switch(m.successCode){case"5":a.log("Property already unhidden, considering the call a success.",e,c);
case"1":if(n){n(p,m.searchUpdates,m.myzUpdates);}this._revealHideStateDependentUI(p);break;case"2":a.log("You will need to login / register to unhide a property",d,c);
break;case"3":a.log("Sorry, we were unable to unhide the property at this time.  Please try again later.",d,c);
break;}},_logResponseFailure:function(m,l){a.log("Ajax request failed",e,c);a.log(l);},_setButtonAsHidden:function(){a.log("_setButtonAsHidden handler called",h,c);
var l=a.one("#unhidePropertyButton").getContent();a.one("#oneClickHideButton").setAttribute("class","saved saveFavorite").setContent(l);
a.fire("z-hidden-property-manager:setButtonAsHidden");},_setButtonAsHide:function(){a.log("_setButtonAsHide handler called",h,c);
var l=a.one("#hidePropertyButton").getContent();a.one("#oneClickHideButton").setAttribute("class","saved saveFavorite").setContent(l);
a.fire("z-hidden-property-manager:setButtonAsHide");},_updateSearchAppContent:function(){if(this._hotelCaliforniaEnabled){a.fire("searchListView:needListUpdate");
a.fire("searchMain:doSearch",{mapSearch:true,listSearch:false});}else{if(this._dejaVuEnabled){a.Global.fire("dejaVu:updateSearchContent");
}}}});a.Z.HiddenPropertyManager=new i();},"3.3.0",{requires:["base-build","zillow-link-tracking","zillow-node-methods","io-base","json-parse","querystring-stringify-simple","array-extras","z-managed-base","z-event-handle-manager","node-event-delegate","animation-manager"]});

YUI.add("z-plugin-comma-format",function(a){var d="CommaFormat",h="debug",f="value",i="currency",g=a.Z.Formatters,e=a.config.doc,b=a.config.win;
function c(){c.superclass.constructor.apply(this,arguments);}a.extend(c,a.Plugin.Base,{initializer:function(j){var k=a.UA.android&&!a.UA.chrome;
if(!k){this.onHostEvent("keyup",this._onCommaInputKeyup);this.onHostEvent("blur",this._onCommaInputBlur);
}a.log("initialized",h,d);},destructor:function(){a.log("destructor",h,d);},_onCommaInputKeyup:function(o){var j=o.currentTarget,n=j.hasClass(i),m=o.keyCode||o.which,l,k;
if(b.getSelection){k=j.get(f);l=String(b.getSelection());if(k===l){return;}}else{if(e.selection){k=j.get(f);
l=String(e.selection.createRange().text);if(k===l){return;}}}switch(m){case 8:case 16:case 17:case 18:case 19:case 20:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 46:case 91:case 92:case 93:case 144:case 145:break;
default:g.formatNumberField(j.getDOMNode(),g.getCaretPosition(j.getDOMNode(),n),n);break;}},_onCommaInputBlur:function(k){var j=k.currentTarget;
if(j){if(isNaN(this._numberFromString(j.get(f)))){j.set(f,"");return;}g.formatNumberField(j,null,j.hasClass(i));
}},_numberFromString:function(m){var l,k,j;if(!m&&m!==0){return NaN;}m+="";l=(/(-?(?:(?:\d|\.)+))\s*([bmk])?/i).exec(m.replace(/,/g,""));
if(!l){return NaN;}k=parseFloat(l[1]);j=l[2];if(isNaN(k)){return NaN;}switch(j){case"T":case"t":return k*1000000000000;
case"B":case"b":return k*1000000000;case"M":case"m":return k*1000000;case"K":case"k":return k*1000;default:return k;
}}},{NAME:d,NS:"cf",SELECTOR:".commaFormat",plugAll:function(){a.all(c.SELECTOR).plug(c);}});a.namespace("Z.Plugin")[d]=c;
},"3.1.1",{requires:["plugin","node-pluginhost","zillow-formatters"]});
YUI.add("z-search-list-view",function(d){var c=d.namespace("Z"),a="SearchListView",b="debug";c[a]=d.Base.create("searchListView",d.View,[c.ViewBase,c.CssManager,c.SearchViewAnalytics,c.EventHandleManager],{_firstLoad:true,_requiredCss:null,_needListUpdate:false,initializer:function(){d.log("initializer",b,a);
this.set("disableLoadedCss",false);d.one("html").addClass("z-app-search");d.Global.publish("searchListView:needListUpdate",{emitFacade:true,defaultFn:d.bind(this._defNeedListUpdate,this)});
d.on("searchTypeAppMethods:titleChange",this._defNeedSetup,this);d.publish("searchListView:loadAds",{broadcast:1,});
d.publish("searchListView:unloadAds",{broadcast:1,});},render:function(){d.log("render",b,a);var e=this.getAttrs();
if(e){d.config.win.SearchMain.initializePage(e);}return this;},_defNeedListUpdate:function(){d.log("_defNeedListUpdate",b,a);
this._needListUpdate=true;},_defNeedSetup:function(){this._windowTitle=d.config.doc.title;},_updateList:function(){if(this._needListUpdate){d.fire("searchMain:doSearch",{mapSearch:false,listSearch:true});
this._needListUpdate=false;}},_refreshAds:function(){d.later(500,d,function(){d.Z.IFrameRefresh.exec();
});},setUp:function(){d.log("setUp",b,a);var e=d.config.win.SearchMain.getMiniBubbleManager();if(!this._firstLoad){this.ensureCss(this._requiredCss,this.get("app"),null);
}this._setGlobalRequestId(d,"search");this._updateList();if(!this._firstLoad){d.config.doc.title=this._windowTitle;
this._ensureAnalytics(true);this._refreshAds();e.clear();d.fire("mapList:restoreScroll");d.fire("searchListView:loadAds");
}else{this._windowTitle=d.config.doc.title;this._storeCustomVars();this._storeRequiredCss();}this._firstLoad=false;
},tearDown:function(){d.log("tearDown",b,a);d.fire("searchListView:unloadAds");}});},"3.4.1",{requires:["base-build","io-form","json-parse","node-base","z-view-base","zillow-search-main","z-iframe-refresh","z-css-manager","z-search-view-analytics","z-event-handle-manager"]});

YUI.add("z-plugin-navad-manager",function(e){var b="NavAdManager",a="host",c="debug",d="error";e.namespace("Z.Plugin")[b]=e.Base.create("navAdManager",e.Plugin.Base,[e.Z.ManagedBase],{_lastUpdate:null,_lastZipcodeIds:null,_pendingSearch:null,_feedbackTimer:null,_feedbackRetries:null,_mapManager:null,_eventHandles:[],_mapEventHandles:null,_initialized:false,initializer:function(f){e.log("initializer",c,b);
e.log("Agent nav ad enabled: "+this.get("agentNavAdEnabled"),c,b);e.log("Standard nav ad enabled: "+this.get("standardNavAdEnabled"),c,b);
e.log("Agent nav ads ON: "+this.get("agentNavAdOn"),c,b);e.log("Map events enabled: "+this.get("mapEventsEnabled"),c,b);
this._mapManager=e.Z.SearchMain.getMapManager();var g=e.on("searchListView:loadAds",this.loadAds,this);
this._eventHandles.push(g);g=e.on("searchListView:unloadAds",this.unloadAds,this);this._eventHandles.push(g);
this._init();},destructor:function(){e.log("destructor",c,b);this._cleanup();this._detachEvents();},thaw:function(){e.log("thaw",c,b);
this._init();},freeze:function(){e.log("freeze",c,b);this._cleanup();},loadAds:function(){e.log("loadAds",c,b);
this._init();},unloadAds:function(){e.log("unloadAds",c,b);this._cleanup();},_init:function(){if(this._initialized===false){e.log("init",c,b);
var i=this.get("enabledZipcodeIds")||"",f=this.get("relatedZipcodeIds")||"",h=i.split(","),g=f.split(",");
if(this.get("mapEventsEnabled")){this._attachMapEvents();}if(this.get("agentNavAdEnabled")){this._renderAgentAd(h,g);
}else{if(this.get("standardNavAdEnabled")){this._renderStandardNavAd();}else{if(this.get("enableTrackingCall")){this._updateNavAd("tracking",g);
}}}this._initialized=true;}},_cleanup:function(){if(this._initialized===true){e.log("cleanup",c,b);this._detachMapEvents();
this._cleanupPictellaAd();this._initialized=false;}},_attachMapEvents:function(){e.log("Enabling map events",c,b);
this._eventHandles=[];var f;if(this.get("mapPanEvent")){f=this._mapManager.on(this.get("mapPanEvent"),this._doSearch,this);
this._eventHandles.push(f);}if(this.get("mapZoomEvent")){f=this._mapManager.on(this.get("mapZoomEvent"),this._doSearch,this);
this._eventHandles.push(f);}},_detachMapEvents:function(){if(this._mapEventHandles){for(var f=0;f<this._mapEventHandles.length;
f++){this._mapEventHandles[f].detach();}this._mapEventHandles=null;}},_detachEvents:function(){if(this._eventHandles){for(var f=0;
f<this._eventHandles.length;f++){this._eventHandles[f].detach();}this._eventHandles=null;}},_doSearch:function(){e.log("doSearch",c,b);
e.log("Waiting "+this.get("debounceMS")+"ms...",c,b);window.clearTimeout(this._pendingSearch);this._pendingSearch=window.setTimeout(e.bind(this._checkForUpdate,this),this.get("debounceMS"));
},_checkForUpdate:function(){e.log("checkForUpdate",c,b);var f=this._shouldUpdate(new Date().getTime());
if(f){e.io(this.get("getZipsUrl"),{context:this,data:{},on:{success:this._onRequestSuccess,failure:function(){e.log("GetAdRequest failure",d,b);
}}});}},_shouldUpdate:function(h){var g=this.get("refreshDelayMS");var f=!this._lastUpdate||h-this._lastUpdate>=g;
e.log("shouldUpdate: "+f,c,b);return f;},_onRequestSuccess:function(g,h){e.log("GetEnabledZipcodeIds success",c,b);
e.log("GetEnabledZipcodeIds response: "+h.responseText,c,b);var f=null;var n=null;var i=null;var l=null;
try{var m=e.JSON.parse(h.responseText);e.log("GetEnabledZipcodeIds status: "+m.status,c,b);if(m.status=="error"){l=m.error;
}else{if(m.status=="update"){f=e.JSON.parse(m.enabledZipcodeIds);n=e.JSON.parse(m.relatedZipcodeIds);
}else{if(m.status=="noneEnabled"){n=e.JSON.parse(m.relatedZipcodeIds);}}}i=m.status;}catch(k){e.log("Unable to parse JSON: "+k,d,b);
}if(i){if(i=="error"){e.log(l,d,b);}else{if(i=="update"){var j=this._updateRequired(this._lastZipcodeIds,f);
e.log("isAgentNavAdEnabled: "+j,c,b);if(j){this._renderAgentAd(f,n);}}else{if(i=="noneEnabled"&&this.get("enableTrackingCall")){this._updateNavAd("tracking",n);
}}}}},_updateRequired:function(j,h){if(h===null||h.length===0){return false;}if(j===null){return true;
}if(h.length<j.length){return true;}for(var g=0,f=h.length;g<f;g++){if(j.indexOf(h[g])==-1){return true;
}}return false;},_renderAgentAd:function(g,f){if(this.get("agentNavAdOn")){this._updateNavAd("agent",g);
}else{this._updateNavAd("tracking",f);}},_renderStandardNavAd:function(){e.log("Rendering standard nav ad",c,b);
this._updateNavAd("standard",[]);},_updateNavAd:function(h,i){e.log("update",c,b);var k=h=="tracking";
if(!k||this._lastUpdate===null){var g=this._getIFrameSrc(this.get("iFrameBaseUrl"),i,h),j="100%",l=this.get("iFrameHeight");
this._emptyContainer();var f=this._insertIframe(g,h,j,l);if(!k){f.show();this._showNavAdContainer();this._lastUpdate=new Date().getTime();
this._lastZipcodeIds=i;if(this.get("hideStickyAd")){this._hideStickyAd();}}if(this.get("verifyNavAd")){this._startCheckForNavAd();
}}},_emptyContainer:function(){var f=this.get(a);f.empty();},_insertIframe:function(h,i,k,g){var j=this.get(a),f=this._configureIFrame(j.create("<iframe></iframe>"),h,i,k,g);
j.appendChild(f);return f;},_getIFrameSrc:function(l,j,f){var m=this.get("targetRegion"),g=this.get("navAdRegion");
var h=l+"?";var n=[];if(g){n.push("navAdRegionId="+g);}if(m){n.push("targetRegionId="+m);}if(j){for(var k=0;
k<j.length;k++){n.push("zipcodeId"+(k+1)+"="+j[k]);}}if(f){n.push("navAdType="+f);}return h+n.join("&");
},_configureIFrame:function(i,j,g,h,f){var k=this.get("iFrameHeight");i.setAttribute("id",this.get("navAdIFrameId"));
i.setAttribute("class",g);i.setAttribute("width",h);i.setAttribute("height",f);i.setAttribute("frameborder","0");
i.setAttribute("scrolling","no");i.setAttribute("position","absolute");i.setAttribute("src",j);return i;
},_cleanupPictellaAd:function(){var f=this._getPictellaNodes();for(var g=0;g<f.length;g++){f[g].remove();
}},_hasPictellaAd:function(){var f=this._getPictellaNodes();return f.length>0;},_getPictellaNodes:function(){var g=/^adtechAdContainer/,f=this.get(a);
var h=[];f.all("div").each(function(i){var j=i.getAttribute("id");if(j!==null&&g.test(j)){h.push(i);}});
return h;},_hideStickyAd:function(){var f=e.one(this.get("stickyAdSelector"));if(f){f.hide();}},_showNavAdContainer:function(){var f=e.one(this.get("navAdContainerSelector"));
if(f){f.show();}},_startCheckForNavAd:function(){e.log("Verifying nav ad",c,b);window.clearTimeout(this._feedbackTimer);
this._pendingSearch=window.setTimeout(e.bind(this._checkForNavAd,this,this.get("feedbackRetries")),this.get("feedbackDelayMS"));
},_checkForNavAd:function(g){var i=false,h=false,k=this.get(a),n="#"+this.get("navAdIFrameId"),m=k.one(n),l=this._getIFrameBody(m);
if(l){if(m){if(this._isNavAdPresent(l)){h=true;i=true;}else{if(g===0){h=true;i=false;}}}if(h){var j=this.get("standardNavAdEnabled")||this.get("agentNavAdEnabled");
var f=i&&this._isNavAdValid(l);this._updateVisibility(f);this._logFeedback(j,i,f,{standardNavAdEnabled:this.get("standardNavAdEnabled"),agentNavAdEnabled:this.get("agentNavAdEnabled"),navAdRegion:this.get("navAdRegion"),targetRegion:this.get("targetRegion"),enabledZipcodeIds:this.get("enabledZipcodeIds"),relatedZipcodeIds:this.get("relatedZipcodeIds"),timedout:(g===0)});
}else{this._pendingSearch=window.setTimeout(e.bind(this._checkForNavAd,this,--g),this.get("feedbackDelayMS"));
}}},_isNavAdPresent:function(g){var f=false;if(g){if(g.one(".GoogleActiveViewClass")){return true;}g.all("iframe").some(function(i){if(this._isGptIFrame(i)){var h=this._getIFrameBody(i);
if(h&&h.hasChildNodes()){f=true;}else{f=false;}return true;}},this);}return f;},_isNavAdValid:function(g){var f=true;
if(g){g.all("iframe").some(function(j){if(this._isNavContentIFrame(j)){var i=this._getIFrameBody(j);if(i&&!i.one(".property-listing")){f=false;
return true;}}else{if(this._isGptIFrame(j)){var h=this._getIFrameBody(j);f=h&&this._isNavAdValid(h);return true;
}}},this);}return f;},_logFeedback:function(f,i,g,h){e.log("Log feedback: enabled="+f+" present="+i+", valid="+g,c,b);
if(f!=i){e.io(this.get("feedbackUrl"),{data:{enabled:f,present:i,valid:g,params:JSON.stringify(h)}});
}},_updateVisibility:function(h){var i=this.get(a),g=i.ancestor("#nav-ad-container");if(g){var f=g.one("#list-nav-ad-loading");
if(f){f.hide();}if(h){g.show();}else{g.hide();}}},_getIFrameBody:function(g){var i=e.Node.getDOMNode(g.get("contentWindow")),h=i.document,f=h.body;
return f?e.Node(f):null;},_isGptIFrame:function(g){var h="google_ads_iframe_/6619";var f=g.get("id");
return(f&&f.search(h)===0);},_isNavContentIFrame:function(g){var h="/search/NavigationContent.htm";var f=g.get("src");
return(f&&f.search(h)>0);}},{NS:"navAdManager",ATTRS:{getZipsUrl:{value:"/search/GetEnabledZipcodeIds.htm"},iFrameBaseUrl:{value:"/search/NavigationContentFrame.htm"},feedbackUrl:{value:"/search/NavAdPacingFeedback.htm"},mapPanEvent:{value:"map:boundsChange"},mapZoomEvent:{value:"map:zoomChange"},refreshDelayMS:{value:10000},debounceMS:{value:1000},feedbackDelayMS:{value:1000},feedbackRetries:{value:4},standardNavAdEnabled:{value:false},agentNavAdEnabled:{value:false},agentNavAdOn:{value:false},mapEventsEnabled:{value:false},enableTrackingCall:{value:true},enabledZipcodeIds:{value:null},relatedZipcodeIds:{value:null},navAdRegion:{value:null},targetRegion:{value:null},iFrameHeight:{value:"128px"},trackingCategory:{value:"AgentNavAds"},hideStickyAd:{value:true},stickyAdSelector:{value:"#sticky-ad"},navAdContainerSelector:{value:"#nav-ad-container"},navAdIFrameId:{value:"nav-ad-iframe"},verifyNavAd:{value:false}}});
},"3.1.1",{requires:["json-parse","node-pluginhost","zillow-search-main","z-analytics","z-managed-base","z-search-list-view"]});

YUI.add("z-mortgage-calc-base",function(b){var a=b.namespace("ZMM.Calc");a.LOAN_TYPE={FIXED:"fixed",ARM:"arm"};
a.PMI={};a.PMI[a.LOAN_TYPE.FIXED]={80:0,85:0.0044,90:0.0059,95:0.0076,100:0.0098};a.PMI[a.LOAN_TYPE.ARM]={80:0,85:0.0068,90:0.0081,95:0.0101,100:0.0117};
a.getPMIBucket=function(c){if(c>95){return 100;}else{if(c>90){return 95;}else{if(c>85){return 90;}else{if(c>80){return 85;
}else{return 80;}}}}};a.monthlyPI=function(d,f,c,h){var g,i,e;if(f===0){return a.$$(d/c);}g=f/1200;i=Math.pow(1+g,c);
e=d*g*i/(i-1);if(!h){return a.$$(e);}return e;};a.monthlyPropertyTaxes=function(c,d){return c*d/12;};
a.monthlyPMI=function(f,e,d){var c=f/e*100,g=a.PMI[d?a.LOAN_TYPE.ARM:a.LOAN_TYPE.FIXED][a.getPMIBucket(c)];
return g*f/12;};a.amountByPayment=function(f,e,d,h){var g,i,c;if(e>0){g=e/1200;i=Math.pow(1+g,d);c=f*(i-1)/(g*i);
}else{c=d*f;}if(!h){return a.$$(c);}return c;};a.amountByLTV=function(d,c){return a.$$(d*(1/(1-c/100)));
};a.amortization=function(k,n,g){var p=n/1200,o=a.monthlyPI(k,n,g),q=k,j=0,m=0,l=[],h,f,d,c=0,e=0;for(h=0;
h<g;h+=1){f=a.$$(q*p);j=a.$$(j+f);if(h===g-1){o=a.$$(q+f);d=q;q=0;}else{d=a.$$(o-f);q=a.$$(q-d);}c+=f;
e+=d;if(h-12>=0){c-=l[h-12].monthlyInterest;e-=l[h-12].monthlyPrincipal;}l.push({month:h+1,monthlyInterest:f,totalInterest:j,monthlyPrincipal:d,totalPrincipal:a.$$(k-q),remainingBalance:q,twelveMonthsInterest:c,twelveMonthsPrincipal:e});
}return l;};a.paymentsRemaining=function(g,e){var d=new Date().getFullYear()-g,c=d*12,f=e-c;if(f<0){f=0;
}return f;};a.$$=function(c){return +c.toFixed(2);};},"3.11.0");
YUI.add("z-mortgage-calc-affordability",function(c){var b=c.namespace("ZMM.Calc");function a(){a.superclass.constructor.apply(this,arguments);
}b.Affordability=c.extend(a,c.Base,{initializer:function(){this.after(["downPaymentChange","ltvChange"],function(){this._calculateByLTV();
},this);this.after(["annualIncomeChange","monthlyPaymentChange","customPaymentChange","annualHomeownersInsuranceChange","includeHomeownersInsuranceChange","monthlyHOAChange","includeHOAChange","monthlyDebtsChange","dtiChange","rateChange","termChange","downPaymentChange","includePropertyTaxChange","propertyTaxRateChange","includePMIChange","loanTypeChange"],function(){this._calculateByDTI();
},this);this.after(["downPaymentChange","out_affordabilityByLTVChange","out_affordabilityByDTIChange"],function(){this._calculate();
},this);this._calculateByLTV();this._calculateByDTI();},_calculate:function(){var d=Math.min(this.get("out_affordabilityByDTI"),this.get("out_affordabilityByLTV")),e=d-this.get("downPayment");
this._set("out_affordability",d);this._set("out_loanAmount",e);},_calculateByLTV:function(){var e=this.get("downPayment"),d=b.amountByLTV(e,this.get("ltv")),f=d-e;
if(f>this.get("jumboLimit")){d=Math.max(this.get("jumboLimit")+e,b.amountByLTV(e,this.get("ltvJumbo")));
f=d-e;}this._set("out_affordabilityByLTV",d);this._set("out_loanAmountByLTV",f);},_calculateByDTI:function(){var d=this.get("dti"),h=5,f=[],g,e;
for(e=0;e<h;e++){f.push(this._affordabilityByDTI(Math.max(d-e,0)));}g=Math.max.apply(Math,f);this._set("out_ltv",this._ltv(g));
this._set("out_affordabilityByDTI",b.$$(g));this._set("out_annualPropertyTax",b.$$(this._annualPropertyTax(g)));
},_affordabilityByDTI:function(m){var g,f=0,e=0,h=this.get("monthlyDebts"),i,l,k,d=0,j=0,n;if(this.get("includeHomeownersInsurance")){f=this.get("annualHomeownersInsurance")/12;
}if(this.get("includeHOA")){e=this.get("monthlyHOA");}if(this.get("customPayment")){i=this.get("monthlyPayment")-f-e;
}else{g=this.get("annualIncome")/12;i=g*m/100-f-e-h;}if(i<=0){return this.get("downPayment");}l=b.amountByPayment(i,this.get("rate"),this.get("term"),true)+this.get("downPayment");
k=l;if(this.get("includePropertyTax")){d=this.get("propertyTaxRate")/1200;k=this._affordabilityWith(l,d);
}if(this.get("includePMI")){n=this._ltv(k);d+=b.PMI[this.get("loanType")][b.getPMIBucket(n)]/12;k=this._affordabilityWith(l,d);
}return Math.max(k,this.get("downPayment"));},_ltv:function(d){return(d-this.get("downPayment"))/d*100;
},_annualPropertyTax:function(d){if(this.get("includePropertyTax")){return d*this.get("propertyTaxRate")/100;
}return 0;},_affordabilityWith:function(d,e){return d/(1+b.amountByPayment(e,this.get("rate"),this.get("term"),true));
}},{NAME:"affordability",ATTRS:{annualIncome:{value:70000},monthlyPayment:{value:1850},customPayment:{value:false},monthlyDebts:{value:0},downPayment:{value:20000,validator:function(d){return d>=0;
}},rate:{value:3.875},term:{value:360},propertyTaxRate:{value:0},includePropertyTax:{value:false},includePMI:{value:true},annualHomeownersInsurance:{value:0},includeHomeownersInsurance:{value:true},monthlyHOA:{value:0},includeHOA:{value:true},ltv:{value:80,validator:function(d){return d<100&&d>=0;
}},ltvJumbo:{value:80,validator:function(d){return d<100&&d>=0;}},jumboLimit:{value:417000},dti:{value:36},loanType:{value:b.LOAN_TYPE.FIXED},out_annualPropertyTax:{readOnly:true},out_ltv:{readOnly:true},out_loanAmount:{readOnly:true},out_affordability:{readOnly:true},out_affordabilityByDTI:{readOnly:true},out_loanAmountByLTV:{readOnly:true},out_affordabilityByLTV:{readOnly:true}}});
},"3.11.0",{requires:["base-base","z-mortgage-calc-base"]});
YUI.add("z-search-affordability-filter-exposed",function(c){var a=12;function b(d){b.superclass.constructor.apply(this,arguments);
}c.Z.SearchAffordabilityFilterExposed=c.Base.create(b,c.Plugin.Base,[c.Z.EventHandleManager],{initializer:function(d){this.set("calculator",new c.ZMM.Calc.Affordability({program:"30-year-fixed",rate:c.one(".saf-rate").get("value"),dti:36,includePropertyTax:true,propertyTaxRate:1.2,includePMI:true,annualHomeownersInsurance:800,monthlyHOA:0}));
this._bind();this._updateMaxValue();},destructor:function(){this.removeHandles();},_bind:function(){var e=this.get("rootNode"),d=e.ancestor(".filter-pane");
this.addHandle(c.one(this.get("annualIncomeInputSelector")).on("change",this._onAnnualIncomeChange,this));
this.addHandle(c.one(this.get("monthlyPaymentInputSelector")).on("change",this._onMonthlyPaymentChange,this));
this.addHandle(c.one(this.get("downPaymentInputSelector")).on("change",this._onDownPaymentChange,this));
this.addHandle(c.one(this.get("monthlyDebtsInputSelector")).on("change",this._onMonthlyDebtsChange,this));
this.addHandle(c.all(this.get("applyLinkSelector")).on("click",this._onApplyLinkClick,this));this.addHandle(d.delegate("click",this._onPreapprovalClick,this.get("preapprovalLinkSelector"),this));
this.addHandle(e.delegate("click",this._onModeClick,this.get("modeLinkSelector"),this));this.addHandle(c.one(this.get("affordabilityFilterEntryClass")).on("click",this._onAffordabilityFilterShow,this));
this.addHandle(c.all(this.get("affordabilityFilterCloseClass")).on("click",this._onAffordabilityFilterClose,this));
c.publish("SearchAffordabilityFilterExposed:applyLinkClicked");this.addHandle(c.on("SearchExposedFilterControl:onMaxPriceInputEnter",this._onMaxPriceInputEnter,this));
},_showAffordabilityFilter:function(d){var e=c.one(this.get("priceFilterClass")),f=c.one(this.get("affordabilityPriceFilterClass"));
if(d){e.hide();f.show();}else{e.show();f.hide();}},_onAffordabilityFilterShow:function(d){this._showAffordabilityFilter(true);
this._ga("Affordability open");},_onAffordabilityFilterClose:function(d){this._showAffordabilityFilter(false);
this._ga("Affordability close");},_onMaxPriceInputEnter:function(d){this._showAffordabilityFilter(false);
},_onModeClick:function(h){h.preventDefault();var f=h.currentTarget.getAttribute("href"),g=(f==="#payment"),d=this.get("rootNode");
this.get("calculator").set("customPayment",g);d.toggleClass(this.get("annualIncomeModeClass"),!g);d.toggleClass(this.get("monthlyPaymentModeClass"),g);
this._updateMaxValue();this._ga("Income toggle");},_updateMaxValue:function(g){var d={annualIncome:this.get("annualIncome"),monthlyPayment:this.get("monthlyPayment"),downPayment:this.get("downPayment"),monthlyDebts:this.get("monthlyDebts")},f=this.get("calculator");
if(f.get("customPayment")){delete d.annualIncome;}else{delete d.monthlyPayment;}f.setAttrs(d);c.one(this.get("maxValueNodeSelector")).set("text",c.Z.Formatters.comma(Math.round(f.get("out_affordabilityByDTI"))));
},_onPreapprovalClick:function(f){var d={annualIncome:this.get("annualIncome"),downPayment:this.get("downPayment"),monthlyDebts:this.get("monthlyDebts")};
this._ga("Upsell click",this.get("preapprovalBaseURL").concat("#",c.QueryString.stringify(d)));f.halt(true);
},_onAnnualIncomeChange:function(g){var d=c.one(this.get("annualIncomeInputSelector")),f=c.Z.Formatters.fromString(d.get("value"))||0;
d.set("value",c.Z.Formatters.comma(f));this._updateMaxValue();this._ga("Annual income edit");},_onMonthlyPaymentChange:function(g){var f=c.one(this.get("monthlyPaymentInputSelector")),d=c.Z.Formatters.fromString(f.get("value"))||0;
f.set("value",c.Z.Formatters.comma(d));this._updateMaxValue();this._ga("Monthly income edit");},_onDownPaymentChange:function(g){var f=c.one(this.get("downPaymentInputSelector")),d=this.get("downPayment");
f.set("value",c.Z.Formatters.comma(d));this._updateMaxValue();this._ga("Down payment edit");},_onMonthlyDebtsChange:function(g){var d=c.one(this.get("monthlyDebtsInputSelector")),f=c.Z.Formatters.fromString(d.get("value"))||0;
d.set("value",c.Z.Formatters.comma(f));this._updateMaxValue();this._ga("Monthly debt edit");},_onApplyLinkClick:function(i){var d,g=c.one("#price-min");
this._updateMaxValue();d=c.one(this.get("maxValueNodeSelector")).get("text");c.one("#price-max").set("value",d==="0"?"":d);
if(c.Z.Formatters.fromString(g.get("value"))>=c.Z.Formatters.fromString(d)){g.set("value","");}if(!this.get("preapprovalHighLighted")){var h=c.one(".filter-price-affordability"),f=h.all(this.get("preapprovalSectionSelector"));
f.each(function(k,e,j){k.toggleView();});this.set("preapprovalHighLighted",true);}this._ga("See all results click");
c.fire("SearchAffordabilityFilterExposed:applyLinkClicked");i.halt(true);},_ga:function(e,d){c.Z.Analytics.trackEvent({category:"Mortgages",action:"Search Affordability Calculator",label:e,href:d});
}},{NS:"searchAffordabilityFilterExposed",ATTRS:{affordabilityFilterEntryClass:{value:".saf-entry-link"},affordabilityFilterCloseClass:{value:".saf-close"},priceFilterClass:{value:".filter-price"},affordabilityPriceFilterClass:{value:".filter-price-affordability"},preapprovalBaseURL:{value:"/pre-approval/"},calculator:{value:null},annualIncomeInputSelector:{value:"#saf-annual-income-input"},annualIncome:{value:0,getter:function(){var d=c.Z.Formatters.fromString(c.one(this.get("annualIncomeInputSelector")).get("value"));
return isNaN(d)||d<0?0:d;}},monthlyPaymentInputSelector:{value:"#saf-monthly-payment-input"},monthlyPayment:{value:0,getter:function(){var d=c.Z.Formatters.fromString(c.one(this.get("monthlyPaymentInputSelector")).get("value"));
return isNaN(d)||d<0?0:d;}},downPaymentInputSelector:{value:"#saf-down-payment-input"},downPayment:{value:0,getter:function(){var d=c.Z.Formatters.fromString(c.one(this.get("downPaymentInputSelector")).get("value"));
return isNaN(d)||d<0?0:d;}},monthlyDebtsInputSelector:{value:"#saf-monthly-debts-input"},monthlyDebts:{value:0,getter:function(){var d=c.Z.Formatters.fromString(c.one(this.get("monthlyDebtsInputSelector")).get("value"));
return isNaN(d)||d<0?0:d;}},rootNode:{value:".saf-root",setter:c.one},annualIncomeModeClass:{value:"saf-annual-income"},monthlyPaymentModeClass:{value:"saf-monthly-payment"},maxValueNodeSelector:{value:".saf-max-price-value"},applyLinkSelector:{value:".saf-apply"},preapprovalHighLighted:{value:false},preapprovalSectionSelector:{value:".saf-bottom-entry"},preapprovalLinkSelector:{value:".saf-pre-approval-link"},annualIncomeOptionSelector:{value:".saf-dropdown-annual-income"},monthlyPaymentOptionSelector:{value:".saf-dropdown-monthly-payment"},monthlyDebtsSectionSelector:{value:".saf-section-monthly-debts"},modeLinkSelector:{value:".saf-mode-link"}}});
},"3.3.0",{requires:["base-base","z-event-handle-manager","z-mortgage-calc-affordability","zillow-formatters","zillow-link-tracking"]});

YUI.add("z-search-map-upsells",function(e){e.namespace("Z");var b="SearchMapUpsells",d=1000,c=10000,a="drawSearchShape";
e.Z.SearchMapUpsells={init:function(){e.on("searchMain:showSaveUpsellMessage",e.bind(function(f){this._showSaveUpsellMessage(f.node);
},this));e.on("searchMain:hideSaveUpsellMessage",e.bind(function(f){this._hideSaveUpsellMessage(f.node);
},this));},_showSaveUpsellMessage:function(f){if(f){this._hideSaveUpsellMessage(f);f.removeClass("hide");
e.later(d,null,function(){f.transition({duration:0.5,opacity:1,top:"24px"});});e.later(c,null,this._hideSaveUpsellMessage,[f]);
}},_hideSaveUpsellMessage:function(f){if(f){f.transition({duration:0.3,opacity:0,top:"38px",on:{end:function(){f.addClass("hide");
}}});}}};},"1.0.0",{requires:["event-custom-base","node-base","zillow-search-main"]});
YUI.add("zsg-responsive-subnav",function(a){a.namespace("ZSG").ResponsiveSubnav=a.Base.create("responsiveSubnav",a.Base,[a.Z.ManagedBase,a.Z.EventHandleManager],{_subnavWrapper:null,_secondaryNav:null,_tertiaryNav:null,_secondaryNavWrapper:null,_tertiaryNavWrapper:null,_secondaryNavHeight:"0px",_tertiaryNavHeight:"0px",_hellipNode:'<span class="zsg-nav-sub-hellip">&hellip;</span>',_expandoNode:'<a class="zsg-nav-sub-expando"><span class="zsg-icon-expando-up"></span><span class="zsg-icon-expando-down"></span></a>',initializer:function(){this._subnavWrapper=a.one(".zsg-nav-sub-wrapper");
if(this._subnavWrapper&&!this._subnavWrapper.getAttribute("data-disable-responsive")){this._subnavWrapper.addClass("zsg-nav-sub_responsive");
this.renderUI();}else{this.destroy();}a.log("initializer","info",this.constructor.NAME);},destructor:function(){a.log("destructor","info",this.constructor.NAME);
this.freeze();},renderUI:function(){this._secondaryNav=this._subnavWrapper.one(".zsg-nav-secondary");
this._tertiaryNav=this._subnavWrapper.one(".zsg-nav-tertiary");if(this._secondaryNav){this._renderSubnavUI(this._secondaryNav,"_secondaryNavWrapper","zsg-nav-secondary-wrapper","_secondaryNavHeight");
}if(this._tertiaryNav){this._renderSubnavUI(this._tertiaryNav,"_tertiaryNavWrapper","zsg-nav-tertiary-wrapper","_tertiaryNavHeight");
}if(this._secondaryNav||this._tertiaryNav){this._subnavWrapper.one(".zsg-nav-sub").append(this._expandoNode);
this.bindUI();}else{this.destroy();}},bindUI:function(){this.thaw();this.syncUI();},syncUI:function(){var c=this._secondaryNav?this._secondaryOverflowHeight():false,b=this._tertiaryNav?this._tertiaryOverflowHeight():false;
this.set("responsiveActive",c||b);},thaw:function(){if(!this._subnavWrapper){this.initializer();return;
}this.addHandle(a.on("windowresize",this.syncUI,null,this));this.addHandle(this.on("navOpenChange",this._onNavOpenChange,this));
this.addHandle(this.on("responsiveActiveChange",this._onResponsiveActiveChange,this));this.addHandle(this._subnavWrapper.delegate("click",this._onExpandoClick,".zsg-nav-sub-expando, .zsg-nav-sub-hellip",this));
},freeze:function(){this.removeHandles();if(this._subnavWrapper){this._subnavWrapper.removeClass("zsg-nav-sub_responsive");
this._subnavWrapper.all(".zsg-nav-sub-hellip").remove();this._subnavWrapper.all(".zsg-nav-sub-expando").remove();
this._subnavWrapper.all(".zsg-nav-sub_responsive-active").removeClass("zsg-nav-sub_responsive-active");
this._subnavWrapper.all(".zsg-nav-sub_responsive-opened").removeClass("zsg-nav-sub_responsive-opened");
this._subnavWrapper.all(".zsg-nav-sub_responsive-closed").removeClass("zsg-nav-sub_responsive-closed");
}if(this._secondaryNavWrapper){this._secondaryNavWrapper.remove();}if(this._tertiaryNavWrapper){this._tertiaryNavWrapper.remove();
}this._subnavWrapper=null;this._secondaryNav=null;this._secondaryNavWrapper=null;this._tertiaryNav=null;
this._tertiaryNavWrapper=null;},_renderSubnavUI:function(c,e,d,b){this[b]=c.getStyle("height");c.wrap('<div class="'+d+'" />');
this[e]=c.ancestor("."+d);this._setHeight(this[e],this[b]).append(this._hellipNode);},_secondaryOverflowHeight:function(){if(this._overflowHeight(this._secondaryNav.getStyle("height"),this._secondaryNavHeight)){this._secondaryNavWrapper.addClass("zsg-nav-sub_responsive-active");
return true;}else{this._secondaryNavWrapper.removeClass("zsg-nav-sub_responsive-active").removeClass("zsg-nav-sub_responsive-closed").removeClass("zsg-nav-sub_responsive-opened");
return false;}},_tertiaryOverflowHeight:function(){if(this._overflowHeight(this._tertiaryNav.getStyle("height"),this._tertiaryNavHeight)){this._tertiaryNavWrapper.addClass("zsg-nav-sub_responsive-active");
return true;}else{this._tertiaryNavWrapper.removeClass("zsg-nav-sub_responsive-active").removeClass("zsg-nav-sub_responsive-closed").removeClass("zsg-nav-sub_responsive-opened");
return false;}},_overflowHeight:function(c,b){if(parseInt(c,10)>parseInt(b,10)){return true;}else{return false;
}},_onResponsiveActiveChange:function(){if(this.get("navOpen")){this._openNav();}else{this.set("navOpen",false);
}},_onNavOpenChange:function(b){if(b.newVal){this._openNav();}else{this._closeNav();}},_onExpandoClick:function(b){b.preventDefault();
this.set("navOpen",!this.get("navOpen"));},_openNav:function(){this._subnavWrapper.all(".zsg-nav-sub_responsive-active").removeClass("zsg-nav-sub_responsive-closed").addClass("zsg-nav-sub_responsive-opened");
if(this._secondaryNavWrapper){this._setHeight(this._secondaryNavWrapper,this._secondaryNav.getStyle("height"));
}if(this._tertiaryNavWrapper){this._setHeight(this._tertiaryNavWrapper,this._tertiaryNav.getStyle("height"));
}},_closeNav:function(){this._subnavWrapper.all(".zsg-nav-sub_responsive-active").removeClass("zsg-nav-sub_responsive-opened").addClass("zsg-nav-sub_responsive-closed");
if(this._secondaryNavWrapper){this._setHeight(this._secondaryNavWrapper,this._secondaryNavHeight);}if(this._tertiaryNavWrapper){this._setHeight(this._tertiaryNavWrapper,this._tertiaryNavHeight);
}},_setHeight:function(c,b){return c.setStyle("height",b);}},{NAME:"zsgResponsiveSubnav",ATTRS:{navOpen:{value:false},responsiveActive:{value:null}}});
});
YUI.add("zsg-launcher-base",function(a){a.namespace("ZSG").LauncherBase=a.Base.create("launcherBase",a.Base,[a.Z.ManagedBase,a.Z.EventHandleManager],{initializer:function(){a.log("initializing","info",this.constructor.NAME);
this._attachHandles();this._publishEvents();},_publishEvents:function(){this.publish("hide",{emitFacade:true,broadcast:1,defaultFn:this._defaultFnHide});
this.publish("show",{emitFacade:true,broadcast:1,defaultFn:this._defaultFnShow});},destructor:function(){a.log("destructor","info",this.constructor.NAME);
this.removeHandles();},freeze:function(){a.log("freeze","info",this.constructor.NAME);this.removeHandles();
},thaw:function(){a.log("thaw","info",this.constructor.NAME);this._attachHandles();},_launchDelegate:function(f){if(f&&f._event&&f._event._launcherHandled){return;
}var d=f.currentTarget,c=d.get("hash")||d.getData("target-id"),g=c&&c.replace("#",""),b=a.one("#"+g)||d.next(this.get("contentSelector"));
f.preventDefault();this.stopLauncherEvent(f);if(b){this._showContent({target:f.target,currentTarget:f.currentTarget,launchNode:d,contentNode:b});
}else{a.log("No content found for id: "+g,"warn",this.constructor.NAME);}},show:function(c,b){if(c&&b&&(this.get("openLaunchNode")!==c||this.get("openContentNode")!==b)){this._showContent({launchNode:c,contentNode:b});
}},_showContent:function(b){if(b.contentNode.contains(b.target)){return;}if(b.launchNode===this.get("openLaunchNode")){this.fire("hide",b);
}else{this.fire("show",b);}},_defaultFnHide:function(b){b.contentNode.removeClass(this.get("contentShowClass"));
this._set("openLaunchNode",null);this._set("openContentNode",null);a.each(this.get("handles"),function(c){c.detach();
c=null;});},_defaultFnShow:function(g){var b=g.contentNode,d=g.launchNode,f=a.one("doc"),c=this.get("handles");
this._hideOpenContent();b.addClass(this.get("contentShowClass"));c.doc=b.on("clickoutside",this._onDocClick,this);
c.touch=f.on("touchstart",function(){var e=f.once("touchend",function(i){this._onDocClick(i);if(h){h.detach();
h=null;}},this),h=f.once("touchmove",function(){if(e){e.detach();e=null;}});},this);c.esc=f.on("keydown",this._onKeydown,this);
this._set("openLaunchNode",d);this._set("openContentNode",b);},_hideOpenContent:function(){var b={contentNode:this.get("openContentNode"),launchNode:this.get("openLaunchNode")};
if(b.contentNode){this.fire("hide",b);}},_closerDelegate:function(c){if(c&&c._event&&c._event._launcherHandled){return;
}var b=c.currentTarget.ancestor(this.get("contentSelector"));c.preventDefault();this.stopLauncherEvent(c);
if(b){this._hideOpenContent();}},_onDocClick:function(d){var b=this.get("openContentNode"),c=this.get("openLaunchNode");
if(b&&!b.contains(d.target)&&b.hasClass(this.get("contentShowClass"))&&c&&!c.contains(d.target)&&!d.target.ancestor(".zsg-tooltip",true)){this._hideOpenContent();
}},_onKeydown:function(b){if(b.keyCode===27){this._hideOpenContent();}},_attachHandles:function(){var b=a.config.delegateClickSelector||"document",c=a.one(b),d=this.get("closerSelector");
this.addHandle(c.delegate("tap",this._launchDelegate,this.get("launchSelector"),this));this.addHandle(c.delegate("click",function(f){f.preventDefault();
},this.get("launchSelector"),this));if(d){this.addHandle(c.delegate("tap",this._closerDelegate,this.get("closerSelector"),this));
}},stopLauncherEvent:function(b){b._event._launcherHandled=true;},},{NAME:"zsgLauncherBase",ATTRS:{launchSelector:{},closerSelector:{},contentSelector:{},contentShowClass:{getter:function(){return this.get("contentSelector").replace(/.|#/,"")+"_open";
},writeOnce:"initOnly"},openLaunchNode:{setter:a.one,readOnly:true},openContentNode:{setter:a.one,readOnly:true},handles:{value:{}}}});
});
YUI.add("zsg-tooltips",function(d){var c='<div class="zsg-tooltip-content"><a class="zsg-icon-x-thick zsg-tooltip-close"></a><span class="zsg-tooltip-arrow"></span>{content}</div>',b=20,a=150;
d.namespace("ZSG").Tooltips=d.Base.create("tooltips",d.ZSG.LauncherBase,[],{DEF_PARENT_NODE:d.one("#wrapper"),initializer:function(){this.contentNodes=[];
this.after("show",function(j){var f=j.contentNode,h=j.launchNode,g=this.get("handles"),k=d.bind(function(){if(h.get("display")!=="none"&&f&&f.getDOMNode()){this._positionContent(f,h);
}},this),i=d.ZSG.Tooltips._getScrollParent(h);if(i&&i!==f.ancestor()){i.insert(f);if(d.Array.indexOf(this.contentNodes,f)<0){this.contentNodes.push(f);
}}this._renderTooltip(f);if(!f.hasClass("css-position")){f.removeClass("zsg-tooltip_animating");this._positionContent(f,h);
f.addClass("zsg-tooltip_animating");g.orientation=d.on("orientationchange",k);g.resize=d.on("resize",k);
}this._uiAnimateShow(h,f);},this);this.on("hide",function(f){this._uiAnimateHide(f.launchNode,f.contentNode);
});},destructor:function(){d.each(this.contentNodes,function(e){e.remove(true);});},_renderTooltip:function(e){if(!e.one(".zsg-tooltip-content")){e.setHTML(d.Node.create(d.Lang.sub(c,{content:e.getHTML()})));
}},_uiAnimateShow:function(f,e){d.later(1,this,function(){if(e&&e.getDOMNode()){this._setTooltipClass(e,true);
}});},_uiAnimateHide:function(f,e){this._setTooltipClass(e,false);d.later(a,e,function(){if(this&&this.getDOMNode()){this.removeClass("zsg-tooltip_closing");
}});},_setTooltipClass:function(f,e){f.toggleClass("zsg-tooltip_opening",e);f.toggleClass("zsg-tooltip_closing",!e);
},_positionContent:function(e,f){var g=this._calculateOptimalPosition(e,f);if(g){e.addClass(this.get("contentPlacementClass")+g.placement);
e.setXY([g.x,g.y]);}},_calculateOptimalPosition:function(m,r){var n=r.ancestor(".zsg-tooltip-viewport"),g=(n)?this._getRegion(n):d.DOM.viewportRegion(),l=r.getData("placement"),e=this._getRegion(m),k=this._getRegion(r),p=this._calculateRightAlignedPosition(k,e),o=this._calculateLeftAlignedPosition(k,e),h=this._calculateBottomAlignedPosition(k,e,g),j=this._calculateTopAlignedPosition(k,e,g),i=this.get("contentPlacementClass"),q=m.one(".zsg-tooltip-arrow"),f;
if(k.bottom<g.top){this._hideOpenContent();return null;}m.removeClass(i+"right").removeClass(i+"left").removeClass(i+"bottom").removeClass(i+"top");
switch(l){case"right":f=p;break;case"left":f=o;break;case"bottom":f=h;break;case"top":f=j;break;default:if(p.x+e.width<g.right){f=p;
this._repositionVertical(g,e,f);}else{if(o.x-g.left>0){f=o;this._repositionVertical(g,e,f);}else{if(j.y>g.top){f=j;
this._repositionHorizontal(g,e,f);}else{f=h;this._repositionHorizontal(g,e,f);}}}}if(q){if((f.placement==="bottom"||f.placement==="top")){this._repositionArrowHorizontal(k,f,q,m);
}else{this._repositionArrowVertical(k,f,q,m);}}return f;},_getRegion:function(f){var g=f.get("region"),e;
if(isNaN(g.width)||isNaN(g.height)){e=f.getDOMNode().getBoundingClientRect();g.height=e.height;g.width=e.width;
g.right=g.left+g.width;g.bottom=g.top+g.height;}return g;},_repositionHorizontal:function(e,g,f){if(f.x+g.width>e.right){f.x=e.right-g.width;
}else{if(f.x<e.left){f.x=e.left;}}},_repositionVertical:function(e,g,f){var h=e.bottom||window.innerHeight;
if(f.y<e.top){f.y=e.top;}else{if(f.y+g.height>h){f.y=e.bottom-g.height;if(f.y<e.top){f.y=e.top;}}}},_calculateRightAlignedPosition:function(f,e){return{x:f.right+b,y:this._calculateVerticalPos(f,e),placement:"right"};
},_calculateLeftAlignedPosition:function(f,e){return{x:f.left-b-e.width,y:this._calculateVerticalPos(f,e),placement:"left"};
},_calculateBottomAlignedPosition:function(g,f,e){return{x:this._calculateHorizontalPos(g,f,e),y:g.bottom+b,placement:"bottom"};
},_calculateTopAlignedPosition:function(g,f,e){return{x:this._calculateHorizontalPos(g,f,e),y:g.top-b-f.height,placement:"top"};
},_calculateVerticalPos:function(f,e){return f.top+(f.height/2)-(e.height/2);},_calculateHorizontalPos:function(g,f,e){return e.width<481?0:Math.max(g.left+(g.width/2)-(f.width/2),0);
},_repositionArrowHorizontal:function(i,g,h,e){var j=i.width/2+i.left,f;f=j-g.x;h.setStyle("left",f);
h.setStyle("top",null);this._setTransformOrigin(e,f+(g.placement==="top"?"px bottom":"px top"));},_repositionArrowVertical:function(j,g,i,e){var h=j.height/2+j.top,f;
f=h-g.y;i.setStyle("top",f);i.setStyle("left",null);this._setTransformOrigin(e,(g.placement==="left"?" right ":" left ")+f+"px");
},_setTransformOrigin:function(f,e){f.setStyle("transform-origin",e);f.setStyle("-ms-transform-origin",e);
f.setStyle("-webkit-transform-origin",e);}},{ATTRS:{launchSelector:{value:".zsg-tooltip-launch"},closerSelector:{value:".zsg-tooltip-close"},contentSelector:{value:".zsg-tooltip"},contentPlacementClass:{getter:function(){return this.get("contentSelector").replace(/.|#/,"")+"_align-";
},writeOnce:"initOnly"}},_instance:null,_getInstance:function(){var e=this._instance;if(!e){e=this._instance=new d.ZSG.Tooltips();
}return e;},_getScrollParent:function(j){var f=j.getStyle("position"),e=f==="absolute",k=null,g=d.ZSG.Tooltips.prototype.DEF_PARENT_NODE,i=j.ancestors(),h;
if(f==="fixed"){return g;}while(!k&&!i.isEmpty()){h=i.pop();if(g===h||h.hasClass("zsg-tooltip-parent")||(!(e&&h.getStyle("position")==="static")&&(/(auto|scroll)/).test(h.getStyle("overflow")+h.getStyle("overflow-y")+h.getStyle("overflow-x")))){k=h;
}}return k||g;},init:function(){this._getInstance();},hide:function(){this._getInstance()._hideOpenContent();
},show:function(e,f){this._getInstance().show(e,f);}});},"3.15.0",{requires:["zsg-launcher-base","node-style"]});
